"use strict";(self.webpackChunkbrightplanet_ventures=self.webpackChunkbrightplanet_ventures||[]).push([[581],{4999:(e,t,a)=>{a.d(t,{A:()=>x});var s=a(9379),r=a(5043),o=(a(3792),a(987)),n=a(917),i=a(5897),l=a(1172),d=a(4009),c=a(579);const m=r.memo(e=>{let{onSubmit:t,onCancel:a,loading:m=!1,editingPromoter:x=null,availableParents:u=[],adminUsers:h=[]}=e;const[p,g]=(0,r.useState)({name:"",email:"",hasEmail:!1,password:"password123",confirmPassword:"password123",mobile:"",address:"",parentPromoter:""}),[b,f]=(0,r.useState)({}),[v,y]=(0,r.useState)(!1),[w,j]=(0,r.useState)(!1),[N,A]=(0,r.useState)({isValidating:!1,isValid:!1,message:""});(0,r.useEffect)(()=>{if(x){const e=x.email||"",t=e&&!e.includes("noemail+")&&!e.includes("@brightplanetventures.local");g({name:x.name||"",email:t?e:"",hasEmail:t,password:"password123",confirmPassword:"password123",mobile:x.mobile||x.phone||"",address:x.address||"",parentPromoter:x.parent_promoter_id||""}),A({isValidating:!1,isValid:!0,message:""}),f({})}},[x]);const k=(0,r.useMemo)(()=>[...(h||[]).map(e=>({id:e.id,label:"\ud83d\udc51 ".concat(e.name," (Admin)"),type:"admin"})),...(u||[]).map(e=>({id:e.id||e._id,label:e.isCurrentUser?"".concat(e.promoter_id||"CURRENT"," - ").concat(e.name," (You)"):"".concat(e.promoter_id||"N/A"," - ").concat(e.name||"Unknown"),type:"promoter"}))],[h,u]),C=(0,r.useCallback)(async(e,t)=>{let a=(0,s.A)({},b);switch(e){case"name":t&&t.trim()?t.trim().length<2?a.name="Name must be at least 2 characters":/^[a-zA-Z\s]+$/.test(t.trim())||(a.name="Name must contain only letters and spaces"):a.name="Name is required";break;case"email":if(p.hasEmail)if(t&&t.trim()){/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.trim())||(a.email="Please enter a valid email address")}else a.email="Email address is required";break;case"password":x||(t?t.length<8?a.password="Password must be at least 8 characters":/(?=.*[a-zA-Z])(?=.*\d)/.test(t)||(a.password="Password must contain both letters and numbers"):a.password="Password is required");break;case"confirmPassword":x||t===p.password||(a.confirmPassword="Passwords do not match");break;case"mobile":if(t){const e=d.A.validateMobileFormat(t);if(e.is_valid)try{const e=await d.A.validateMobileNumber(t,(null===x||void 0===x?void 0:x.id)||null,null,"promoter");e.success&&e.is_valid||(a.mobile=e.error||"Mobile number validation failed")}catch(r){a.mobile="Mobile number validation service unavailable"}else a.mobile=e.error}else a.mobile="Mobile number is required";break;case"parentPromoter":!t&&k.length>0&&(a.parentPromoter="Parent promoter selection is required")}return f(a),a},[p,b,x]),_=(0,r.useCallback)((e,t)=>{g(a=>(0,s.A)((0,s.A)({},a),{},{[e]:t}));const a=C(e,t);f(e=>(0,s.A)((0,s.A)({},e),a)),!a[e]&&b[e]&&f(t=>{const a=(0,s.A)({},t);return delete a[e],a})},[C,b]),P=(0,r.useCallback)(async e=>{if(!e)return f(e=>(0,s.A)((0,s.A)({},e),{},{mobile:"Mobile number is required"})),void A({isValidating:!1,isValid:!1,message:""});if(x)return A({isValidating:!1,isValid:!0,message:""}),void f(e=>{const t=(0,s.A)({},e);return delete t.mobile,t});const t=d.A.validateMobileFormat(e);if(!t.is_valid)return f(e=>(0,s.A)((0,s.A)({},e),{},{mobile:t.error})),void A({isValidating:!1,isValid:!1,message:""});A({isValidating:!0,isValid:!1,message:"Validating mobile number..."}),f(e=>{const t=(0,s.A)({},e);return delete t.mobile,t});try{const t=await d.A.validateMobileNumber(e,(null===x||void 0===x?void 0:x.id)||null,null,"promoter");if(t.success&&t.is_valid)f(e=>{const t=(0,s.A)({},e);return delete t.mobile,t}),A({isValidating:!1,isValid:!0,message:""});else{const e=t.error||"Mobile number validation failed";f(t=>(0,s.A)((0,s.A)({},t),{},{mobile:e})),A({isValidating:!1,isValid:!1,message:e})}}catch(a){const e="Mobile number validation service unavailable";f(t=>(0,s.A)((0,s.A)({},t),{},{mobile:e})),A({isValidating:!1,isValid:!1,message:e})}},[x]),S=((0,r.useCallback)(e=>{const t=setTimeout(()=>{P(e)},500);return()=>clearTimeout(t)},[P]),(0,r.useCallback)(()=>{const e={};return Object.keys(p).forEach(t=>{const a=C(t,p[t]);Object.assign(e,a)}),f(e),0===Object.keys(e).length},[p,C,x])),E=(0,r.useCallback)(async e=>{if(e.preventDefault(),!S())return;const a={name:p.name,email:p.hasEmail&&p.email?p.email:null,password:p.password,mobile:p.mobile,address:p.address||null,parentPromoter:p.parentPromoter||null,useNewSystem:!0};await t(a)},[p,S,t]);return(0,c.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-700 pb-4 mb-6",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h3",{className:"text-xl font-semibold text-white",children:x?"Edit Promoter":"Create New Promoter"}),x&&(0,c.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Update promoter information and hierarchy"})]}),(0,c.jsx)("button",{type:"button",onClick:a,className:"text-gray-400 hover:text-white transition-colors",disabled:m,children:(0,c.jsx)(l.A,{className:"w-5 h-5"})})]}),(0,c.jsxs)("form",{onSubmit:E,className:"space-y-5",children:[(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Full Name",(0,c.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,c.jsx)("input",{type:"text",value:p.name,onChange:e=>_("name",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(b.name?"border-red-500":"border-gray-600"),placeholder:"Enter full name (letters and spaces only)"}),b.name&&(0,c.jsx)("p",{className:"text-red-400 text-sm mt-1",children:b.name})]}),(0,c.jsxs)("div",{className:"mb-4",children:[(0,c.jsxs)("div",{className:"flex items-center mb-2",children:[(0,c.jsx)("input",{type:"checkbox",id:"hasEmail",checked:p.hasEmail,onChange:e=>{const t=e.target.checked;g(e=>(0,s.A)((0,s.A)({},e),{},{hasEmail:t,email:t?e.email:""})),t||f(e=>{const t=(0,s.A)({},e);return delete t.email,t})},className:"mr-2 h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-600 rounded bg-gray-700"}),(0,c.jsx)("label",{htmlFor:"hasEmail",className:"text-sm font-medium text-gray-300",children:"Add Email Address"})]}),p.hasEmail&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("input",{type:"email",value:p.email,onChange:e=>_("email",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(b.email?"border-red-500":"border-gray-600"),placeholder:"Enter email address (can be shared with others)"}),b.email&&(0,c.jsx)("p",{className:"text-red-400 text-sm mt-1",children:b.email})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Mobile Number",(0,c.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,c.jsx)("p",{className:"text-xs text-gray-400 mb-2",children:"Mobile number is mandatory and must be unique. SMS will be sent to this number."}),(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)("input",{type:"tel",value:p.mobile,onChange:e=>{const t=e.target.value.replace(/\D/g,"").slice(0,10);if(g(e=>(0,s.A)((0,s.A)({},e),{},{mobile:t})),A({isValidating:!1,isValid:!1,message:""}),f(e=>{const t=(0,s.A)({},e);return delete t.mobile,t}),10===t.length){const e=setTimeout(()=>{P(t)},500);return()=>clearTimeout(e)}},className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 pr-12 ".concat(b.mobile?"border-red-500":N.isValid?"border-green-500":N.isValidating?"border-blue-500":"border-gray-600"),placeholder:"Enter 10-digit mobile number",maxLength:10}),(0,c.jsxs)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:[N.isValidating&&(0,c.jsx)(i.A,{className:"w-5 h-5 text-blue-400 animate-spin"}),N.isValid&&(0,c.jsx)(n.A,{className:"w-5 h-5 text-green-400"}),b.mobile&&(0,c.jsx)(o.A,{className:"w-5 h-5 text-red-400"})]})]}),b.mobile&&(0,c.jsx)("div",{className:"mt-2 p-2 bg-red-900 border border-red-700 rounded-lg",children:(0,c.jsxs)("p",{className:"text-red-400 text-sm flex items-center",children:[(0,c.jsx)(o.A,{className:"w-4 h-4 mr-2"}),b.mobile]})}),N.isValidating&&(0,c.jsx)("div",{className:"mt-2 p-2 bg-blue-900 border border-blue-700 rounded-lg",children:(0,c.jsxs)("p",{className:"text-blue-400 text-sm flex items-center",children:[(0,c.jsx)(i.A,{className:"w-4 h-4 mr-2 animate-spin"}),N.message]})})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Address",(0,c.jsx)("span",{className:"text-gray-500 text-xs ml-2",children:"(Optional)"})]}),(0,c.jsx)("textarea",{value:p.address,onChange:e=>_("address",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Enter full postal address (optional)",rows:3})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Parent Promoter",(0,c.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,c.jsx)("p",{className:"text-xs text-gray-400 mb-2",children:"Parent promoter is mandatory for hierarchy management."}),(0,c.jsxs)("select",{value:p.parentPromoter,onChange:e=>_("parentPromoter",e.target.value),disabled:1===k.length||x,className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(b.parentPromoter?"border-red-500":"border-gray-600"," ").concat(1===k.length||x?"opacity-75 cursor-not-allowed":""),children:[(0,c.jsx)("option",{value:"",disabled:!0,children:"Select parent promoter *"}),k.map(e=>(0,c.jsx)("option",{value:e.id,children:e.label},e.id))]}),b.parentPromoter&&(0,c.jsx)("p",{className:"text-red-400 text-sm mt-1",children:b.parentPromoter})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-700",children:[(0,c.jsx)("button",{type:"button",onClick:a,className:"px-6 py-3 text-gray-300 hover:text-white transition-colors",disabled:m,children:"Cancel"}),(0,c.jsx)("button",{type:"submit",disabled:m||Object.keys(b).length>0||!x&&(!p.mobile||10!==p.mobile.length||!p.parentPromoter||N.isValidating||10===p.mobile.length&&!N.isValid),className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:m?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.A,{className:"w-4 h-4 animate-spin"}),(0,c.jsx)("span",{children:x?"Updating...":"Creating..."})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.A,{className:"w-4 h-4"}),(0,c.jsx)("span",{children:x?"Update Promoter":"Create Promoter"})]})})]})]})]})});m.displayName="UnifiedPromoterForm";const x=m},7581:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_});var s=a(9379),r=a(5043),o=a(7950),n=a(6621),i=a(4999),l=a(2129),d=a(3959),c=a(3792),m=a(4725),x=a(8432),u=a(7008),h=a(5897),p=a(9589),g=a(6787),b=a(5680),f=a(2380),v=a(2699),y=a(6339),w=a(8112),j=a(1172),N=a(1754),A=a(8279),k=a(45),C=a(579);const _=function(){const{user:e}=(0,n.As)(),{showSuccess:t,showError:a,showWarning:_,handleApiError:P}=(0,A.dj)();(0,d.r9)();const[S,E]=(0,r.useState)([]),[M,V]=(0,r.useState)([]),[F,D]=(0,r.useState)(""),[q,L]=(0,r.useState)(""),[U,I]=(0,r.useState)("created_at"),[O,T]=(0,r.useState)(!1),z=(0,r.useRef)(null),[B,R]=(0,r.useState)({top:0,right:0}),[W,J]=(0,r.useState)(!1),[X,Z]=(0,r.useState)(!1),[$,G]=(0,r.useState)(null),[Q,Y]=(0,r.useState)(null),[H,K]=(0,r.useState)(!0),[ee,te]=(0,r.useState)(!1),[ae,se]=(0,r.useState)(!1),[re,oe]=(0,r.useState)(null),[ne,ie]=(0,r.useState)(!1),[le,de]=(0,r.useState)(null),[ce,me]=(0,r.useState)({amount:"",notes:""}),[xe]=(0,r.useState)([]),[ue,he]=(0,r.useState)(1),[pe,ge]=(0,r.useState)(10),be=async()=>{try{K(!0);const{data:e,error:t}=await c.ND.from("profiles").select("\n          id,\n          name,\n          email,\n          mobile,\n          phone,\n          promoter_id,\n          parent_promoter_id,\n          status,\n          address,\n          created_at\n        ").eq("role","promoter").order("created_at",{ascending:!1}).limit(100);if(t)throw t;E(e||[]),K(!1),console.log("Promoter data loaded with all fields:",{count:(null===e||void 0===e?void 0:e.length)||0,sample:null===e||void 0===e?void 0:e.slice(0,2),loadingStopped:!0}),setTimeout(async()=>{try{const{data:e}=await c.ND.from("profiles").select("\n              id,\n              name,\n              email,\n              mobile,\n              phone,\n              promoter_id,\n              parent_promoter_id,\n              status,\n              address,\n              created_at,\n              updated_at\n            ").eq("role","promoter").order("created_at",{ascending:!1}).limit(1e3);e&&E(e)}catch(t){console.error("Error loading more promoter data:",t)}},300)}catch(e){E([]),K(!1)}};(0,r.useEffect)(()=>{be()},[]),(0,r.useEffect)(()=>{let e=S||[];F&&(e=e.filter(e=>{const t=((null===e||void 0===e?void 0:e.name)||"").toLowerCase(),a=((null===e||void 0===e?void 0:e.email)||"").toLowerCase(),s=((null===e||void 0===e?void 0:e.promoter_id)||"").toLowerCase(),r=((null===e||void 0===e?void 0:e.phone)||"").toLowerCase(),o=(F||"").toLowerCase();return t.includes(o)||a.includes(o)||s.includes(o)||r.includes(o)})),q&&(e=e.filter(e=>((null===e||void 0===e?void 0:e.status)||"active").toLowerCase()===q.toLowerCase())),V(e),he(1)},[S,F,q]);const fe=()=>{J(!1),G(null)},ve=()=>{Z(!1),Y(null)},ye=()=>{ie(!1),de(null),me({amount:"",notes:""})},we=e=>{const t=null===e||void 0===e?void 0:e.parent_promoter_id;if(!t)return null;const a=(xe||[]).find(e=>e.id===t);if(a)return{name:a.name||"Admin",id:"Admin",isAdmin:!0};const s=(S||[]).find(e=>(null===e||void 0===e?void 0:e.id)===t);return s?{name:s.name||"Unknown",id:s.promoter_id||"N/A",isAdmin:!1}:{name:"Unknown Parent",id:"N/A",isAdmin:!1}};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(d.wE,{}),(0,C.jsxs)(d.dQ,{children:[(0,C.jsx)("div",{className:"min-h-screen pt-40 px-8 pb-8",children:(0,C.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,C.jsxs)("div",{className:"flex justify-between items-center mb-8","data-animate":!0,children:[(0,C.jsxs)("div",{children:[(0,C.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:"Promoter Management"}),(0,C.jsx)("p",{className:"text-gray-400",children:"Manage promoters, hierarchies, and performance"})]}),(0,C.jsxs)("div",{className:"flex items-center gap-3",children:[(0,C.jsxs)(d.Rq,{onClick:()=>{G(null),J(!0)},className:"flex items-center space-x-2 px-3 py-2 text-sm",children:[(0,C.jsx)(f.A,{className:"w-4 h-4"}),(0,C.jsx)("span",{children:"Create Promoter"})]}),(0,C.jsxs)("div",{className:"relative",ref:z,children:[(0,C.jsxs)(d.Rq,{onClick:()=>{if(z.current){const e=z.current.getBoundingClientRect();R({top:e.bottom+8,right:window.innerWidth-e.right})}T(!O)},className:"flex items-center space-x-2 px-3 py-2 text-sm bg-blue-600 hover:bg-blue-500 border border-blue-500",children:[(0,C.jsx)(u.A,{className:"w-4 h-4"}),(0,C.jsx)("span",{children:"Export"})]}),O&&(0,o.createPortal)((0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("div",{className:"fixed inset-0 z-[9998]",onClick:()=>T(!1)}),(0,C.jsxs)("div",{className:"fixed w-48 bg-gray-800 border-2 border-gray-600 rounded-lg shadow-2xl z-[9999]",style:{top:"".concat(B.top,"px"),right:"".concat(B.right,"px"),minWidth:"12rem"},children:[(0,C.jsx)("button",{onClick:async()=>{try{const e=M.map(e=>{const t=we(e);return(0,s.A)((0,s.A)({},e),{},{parent_promoter_name:(null===t||void 0===t?void 0:t.name)||"N/A"})});await k.Pq(e,"promoters"),T(!1)}catch(e){a("Failed to export PDF: "+e.message)}},className:"w-full text-left px-4 py-3 text-white hover:bg-gray-700 rounded-t-lg flex items-center space-x-2 transition-colors",children:(0,C.jsx)("span",{children:"\ud83d\udcc4 PDF"})}),(0,C.jsx)("button",{onClick:()=>{try{const e=M.map(e=>{const t=we(e);return(0,s.A)((0,s.A)({},e),{},{parent_promoter_name:(null===t||void 0===t?void 0:t.name)||"N/A"})});k.Jg(e,"promoters"),T(!1)}catch(e){a("Failed to export CSV: "+e.message)}},className:"w-full text-left px-4 py-3 text-white hover:bg-gray-700 rounded-b-lg flex items-center space-x-2 transition-colors",children:(0,C.jsx)("span",{children:"\ud83d\udcca CSV"})})]})]}),document.body)]})]})]}),(0,C.jsx)(d.Xg,{className:"mb-6","data-animate":!0,style:{overflow:"visible"},children:(0,C.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,C.jsx)("div",{className:"flex-1 min-w-[300px]",children:(0,C.jsxs)("div",{className:"relative",children:[(0,C.jsx)("input",{type:"text",placeholder:"Search by name, email, ID, or phone...",value:F,onChange:e=>D(e.target.value),className:"w-full h-10 px-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all text-sm"}),(0,C.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,C.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,C.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})}),(0,C.jsxs)("div",{className:"relative",children:[(0,C.jsxs)("select",{value:q,onChange:e=>L(e.target.value),className:"appearance-none h-10 bg-gray-700 border border-gray-600 rounded-lg text-white px-3 pr-8 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all cursor-pointer hover:bg-gray-650 text-sm",children:[(0,C.jsx)("option",{value:"",children:"All Status"}),(0,C.jsx)("option",{value:"active",children:"Active"}),(0,C.jsx)("option",{value:"inactive",children:"Inactive"})]}),(0,C.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,C.jsx)("svg",{className:"w-3 h-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,C.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,C.jsxs)("div",{className:"flex items-center gap-1 h-10 px-3 bg-gray-700/30 rounded-lg border border-gray-600/50",children:[(0,C.jsx)("button",{onClick:()=>I("created_at"),className:"px-2 py-2 text-sm rounded-md transition-all font-medium whitespace-nowrap ".concat("created_at"===U?"bg-orange-500 text-white shadow-md":"text-gray-300 bg-gray-700/50 hover:bg-gray-600/50 hover:text-white"),title:"Sort by Newest",children:"Newest"}),(0,C.jsx)("button",{onClick:()=>I("customer_id"),className:"px-2 py-2 text-sm rounded-md transition-all font-medium whitespace-nowrap ".concat("customer_id"===U?"bg-orange-500 text-white shadow-md":"text-gray-300 bg-gray-700/50 hover:bg-gray-600/50 hover:text-white"),title:"Sort by Customer ID",children:"By ID"})]}),(0,C.jsxs)("div",{className:"flex items-center gap-2 h-10 px-3 bg-gray-700/30 rounded-lg border border-gray-600/50",children:[(0,C.jsx)("span",{className:"text-gray-300 text-xs font-medium whitespace-nowrap",children:"Show"}),(0,C.jsx)("div",{className:"relative",children:(0,C.jsx)("input",{type:"number",min:"1",max:"100",value:pe,onChange:e=>{const t=Math.min(100,Math.max(1,parseInt(e.target.value)||10));ge(t),he(1)},className:"w-12 h-6 bg-gray-600 border border-gray-500 rounded text-white text-xs pl-2 pr-1 py-1 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 hover:bg-gray-500 transition-all text-center",placeholder:"10"})}),(0,C.jsx)("span",{className:"text-gray-300 text-xs font-medium whitespace-nowrap",children:"per page"})]}),M.length>0&&(0,C.jsxs)("div",{className:"flex items-center gap-2 h-10 px-3 bg-gray-700/30 rounded-lg border border-gray-600/50",children:[(0,C.jsx)("div",{className:"w-2 h-2 bg-orange-400 rounded-full animate-pulse"}),(0,C.jsxs)("span",{className:"text-gray-300 text-sm font-medium",children:["Showing ",(0,C.jsx)("span",{className:"text-orange-300 font-bold",children:(ue-1)*pe+1})," to ",(0,C.jsx)("span",{className:"text-orange-300 font-bold",children:Math.min(ue*pe,M.length)})," of ",(0,C.jsx)("span",{className:"text-orange-300 font-bold",children:M.length})," promoters"]})]})]})}),(0,C.jsxs)(d.Xg,{className:"overflow-hidden","data-animate":!0,children:[H?(0,C.jsx)(N.cU,{rows:8,columns:6}):(0,C.jsx)("div",{className:"overflow-x-auto",children:(0,C.jsxs)("table",{className:"w-full",children:[(0,C.jsx)("thead",{className:"bg-gray-700",children:(0,C.jsxs)("tr",{children:[(0,C.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Promoter Details"}),(0,C.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Contact Details"}),(0,C.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Parent Promoter"}),(0,C.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Status"}),(0,C.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Pins"}),(0,C.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,C.jsx)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:0===M.length?(0,C.jsx)("tr",{children:(0,C.jsx)("td",{colSpan:"6",className:"px-6 py-12 text-center text-gray-400",children:"No promoters found"})}):(()=>{const e=ue*pe,a=e-pe;return M.slice(a,e).map(e=>{const a=null===e||void 0===e?void 0:e.id,s=(null===e||void 0===e?void 0:e.name)||"Unknown",r=(null===e||void 0===e?void 0:e.email)||"N/A",o=(null===e||void 0===e?void 0:e.phone)||(null===e||void 0===e?void 0:e.mobile)||"N/A",n=(null===e||void 0===e?void 0:e.promoter_id)||"N/A",i=((null===e||void 0===e?void 0:e.status)||"Active").toLowerCase();return(0,C.jsxs)("tr",{className:"hover:bg-gray-700",children:[(0,C.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,C.jsxs)("div",{className:"flex items-center",children:[(0,C.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-400 to-yellow-500 rounded-full flex items-center justify-center mr-3",children:(0,C.jsx)(w.A,{className:"w-4 h-4 text-white"})}),(0,C.jsxs)("div",{className:"flex flex-col",children:[(0,C.jsx)("span",{className:"text-white font-medium",children:s}),(0,C.jsx)("span",{className:"text-xs text-gray-400",children:n})]})]})}),(0,C.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,C.jsxs)("div",{className:"space-y-1",children:[(0,C.jsxs)("div",{className:"flex items-center",children:[(0,C.jsx)(p.A,{className:"w-3 h-3 mr-2 text-gray-400"}),"N/A"===r?"No email":r]}),(0,C.jsxs)("div",{className:"flex items-center",children:[(0,C.jsx)(b.A,{className:"w-3 h-3 mr-2 text-gray-400"}),o||"No mobile"]})]})}),(0,C.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(()=>{const t=we(e);return t?(0,C.jsx)("div",{className:"flex items-center",children:t.isAdmin?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)("span",{className:"text-yellow-400 mr-2",children:"\ud83d\udc51"}),(0,C.jsx)("span",{className:"text-white font-medium",children:t.name})]}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(w.A,{className:"w-4 h-4 mr-2 text-blue-400"}),(0,C.jsxs)("div",{className:"flex flex-col",children:[(0,C.jsx)("span",{className:"text-white font-medium",children:t.name}),(0,C.jsx)("span",{className:"text-xs text-gray-400",children:t.id})]})]})}):"-"})()}),(0,C.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,C.jsxs)("button",{onClick:()=>(async e=>{try{var a;const s=null===(a=e.status)||void 0===a?void 0:a.toLowerCase(),r="active"===s?"Inactive":"Active",{error:o}=await c.ND.from("profiles").update({status:r}).eq("id",e.id);if(o)throw o;await be(),t("Promoter status updated from ".concat(s," to ").concat(r))}catch(s){P(s,"Failed to update promoter status")}})(e),className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium capitalize border transition-all hover:opacity-80 ".concat("active"===(i||"active").toLowerCase()?"bg-green-500/10 text-green-400 border-green-500/20":"bg-red-500/10 text-red-400 border-red-500/20"),title:"Click to toggle status",children:[(0,C.jsx)("div",{className:"w-1.5 h-1.5 rounded-full mr-2 ".concat("active"===(i||"active").toLowerCase()?"bg-green-400":"bg-red-400")}),i]})}),(0,C.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,C.jsxs)("span",{className:"text-sm font-medium text-white",children:["\ud83d\udccc ",(null===e||void 0===e?void 0:e.pins)||0]})}),(0,C.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,C.jsxs)("div",{className:"flex space-x-2",children:[(0,C.jsx)("button",{onClick:()=>(e=>{G(e),J(!0)})(e),className:"text-orange-400 hover:text-orange-300 transition-colors",children:(0,C.jsx)(g.A,{className:"w-4 h-4"})}),(0,C.jsx)("button",{onClick:()=>(e=>{Y(e),Z(!0)})(e),className:"text-red-400 hover:text-red-300 transition-colors",children:(0,C.jsx)(y.A,{className:"w-4 h-4"})})]})})]},a)})})()})]})}),M.length>0&&(0,C.jsx)("div",{className:"px-6 py-4 border-t border-gray-700/50 bg-gray-800/30",children:(0,C.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,C.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-700/50 rounded-lg border border-gray-600/50",children:[(0,C.jsx)("div",{className:"w-2 h-2 bg-orange-400 rounded-full animate-pulse"}),(0,C.jsxs)("span",{className:"text-gray-300 text-sm font-medium",children:["Page ",(0,C.jsx)("span",{className:"text-orange-400 font-bold",children:ue})," of ",(0,C.jsx)("span",{className:"text-orange-400 font-bold",children:Math.ceil(M.length/pe)})]})]}),(0,C.jsxs)("div",{className:"flex items-center gap-2",children:[(0,C.jsxs)("button",{onClick:()=>he(e=>Math.max(e-1,1)),disabled:1===ue,className:"group relative p-2.5 rounded-lg transition-all duration-200 ".concat(1===ue?"bg-gray-700/50 text-gray-500 cursor-not-allowed border border-gray-600/30":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white border border-gray-600/50 hover:border-gray-500 hover:shadow-lg hover:shadow-orange-400/10"),title:"Previous Page",children:[(0,C.jsx)(m.A,{className:"w-4 h-4"}),(0,C.jsx)("span",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:"Previous"})]}),(0,C.jsx)("div",{className:"flex items-center gap-1 px-2 py-1 bg-gray-700/30 rounded-lg border border-gray-600/30",children:Array.from({length:Math.min(5,Math.ceil(M.length/pe))},(e,t)=>{const a=Math.ceil(M.length/pe);let s;return s=a<=5||ue<=3?t+1:ue>=a-2?a-4+t:ue-2+t,(0,C.jsx)("button",{onClick:()=>he(s),className:"w-8 h-8 rounded-md text-sm font-medium transition-all duration-200 ".concat(ue===s?"bg-gradient-to-r from-orange-500 to-orange-600 text-white shadow-lg shadow-orange-400/20 border border-orange-400/50":"bg-gray-600/50 text-gray-300 hover:bg-gray-600 hover:text-white border border-gray-500/30 hover:border-gray-400/50"),title:"Go to page ".concat(s),children:s},s)})}),(0,C.jsxs)("button",{onClick:()=>he(e=>Math.min(e+1,Math.ceil(M.length/pe))),disabled:ue===Math.ceil(M.length/pe),className:"group relative p-2.5 rounded-lg transition-all duration-200 ".concat(ue===Math.ceil(M.length/pe)?"bg-gray-700/50 text-gray-500 cursor-not-allowed border border-gray-600/30":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white border border-gray-600/50 hover:border-gray-500 hover:shadow-lg hover:shadow-orange-400/10"),title:"Next Page",children:[(0,C.jsx)(x.A,{className:"w-4 h-4"}),(0,C.jsx)("span",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:"Next"})]})]})]})})]})]})}),W&&(0,C.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,C.jsx)(i.A,{onSubmit:async e=>{var a;te(!0);null===(a=(await c.ND.auth.getSession()).data.session)||void 0===a||a.user;try{if($){console.log("Updating promoter with data:",{promoter_id:$.promoter_id,name:e.name,email:e.email,mobile:e.mobile,address:e.address,status:e.status});const{data:a,error:s}=await c.ND.rpc("update_promoter_profile",{p_promoter_id:$.promoter_id,p_name:e.name,p_email:e.email,p_phone:e.mobile,p_address:e.address,p_status:e.status,p_parent_promoter_id:$.parent_promoter_id});if(s)throw s;if(await c.ND.from("profiles").update({mobile:e.mobile,phone:e.mobile,updated_at:(new Date).toISOString()}).eq("id",$.id),!a.success)throw new Error(a.error||"Failed to update promoter");t("Promoter updated successfully")}else{if(!e.name||""===e.name.trim())throw new Error("Name is required for promoter creation.");if(!e.password||""===e.password.trim())throw new Error("Password is required for promoter creation.");if(!e.mobile||""===e.mobile.trim())throw new Error("Mobile number is required for promoter creation.");const t=e.hasEmail&&e.email?e.email:null;let a;try{const s="https://api.brightplanetventures.com/api",r=await fetch("".concat(s,"/create-promoter-auth"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:e.password,userData:{role:"promoter",name:e.name,mobile:e.mobile,address:e.address,parent_promoter_id:e.parentPromoter}})});if(!r.ok){const e=await r.json();throw new Error(e.error||"Backend service not available")}a=await r.json()}catch(r){throw console.error("Backend service error:",r),new Error("Failed to create promoter: "+r.message)}var s;if(!a||!a.success)throw new Error("Failed to create promoter: "+((null===(s=a)||void 0===s?void 0:s.error)||"Unknown error"));oe({title:"Success!",message:"Promoter created successfully and is ready to use.",details:"Promoter ID: ".concat(a.promoterId,"\nName: ").concat(e.name,"\nLogin: Use Promoter ID + Password")}),se(!0)}await be(),setTimeout(()=>{be()},500),fe()}catch(o){P(o,"Failed to save promoter")}finally{te(!1)}},onCancel:fe,loading:ee,editingPromoter:$,availableParents:(()=>{const e=S||[],t=[...e];if(!$)return t;const a=(e,t)=>{const s=[];return t.filter(t=>(null===t||void 0===t?void 0:t.parent_promoter_id)===e).forEach(e=>{const r=null===e||void 0===e?void 0:e.id;r&&(s.push(r),s.push(...a(r,t)))}),s},s=null===$||void 0===$?void 0:$.id;if(!s)return t;const r=[s,...a(s,e)];return t.filter(e=>{const t=null===e||void 0===e?void 0:e.id;return t&&((null===e||void 0===e?void 0:e.isAdmin)||!r.includes(t))})})(),adminUsers:xe})}),X&&Q&&(0,C.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,C.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4",children:[(0,C.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,C.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Confirm Delete"}),(0,C.jsx)("button",{onClick:ve,className:"text-gray-400 hover:text-white transition-colors",children:(0,C.jsx)(j.A,{className:"w-5 h-5"})})]}),(0,C.jsxs)("div",{className:"mb-6",children:[(0,C.jsxs)("p",{className:"text-gray-300",children:["Are you sure you want to delete promoter ",(0,C.jsx)("strong",{children:Q.name}),"?"]}),(0,C.jsx)("p",{className:"text-red-400 text-sm mt-2",children:"This action cannot be undone."})]}),(0,C.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,C.jsx)("button",{onClick:ve,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"Cancel"}),(0,C.jsx)("button",{onClick:async()=>{if(Q)try{const{error:e}=await c.ND.from("profiles").delete().eq("id",Q.id);if(e)throw e;await be(),ve()}catch(e){P(e,"Failed to delete promoter")}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete"})]})]})}),ne&&le&&(0,C.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,C.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md border border-gray-700",children:[(0,C.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,C.jsx)("h3",{className:"text-xl font-semibold text-white",children:"Allocate Pins"}),(0,C.jsx)("button",{onClick:ye,className:"text-gray-400 hover:text-white transition-colors",children:(0,C.jsx)(j.A,{className:"w-5 h-5"})})]}),(0,C.jsxs)("div",{className:"space-y-4",children:[(0,C.jsxs)("div",{children:[(0,C.jsxs)("p",{className:"text-gray-300 mb-2",children:["Promoter: ",(0,C.jsx)("span",{className:"font-semibold text-white",children:le.name})]}),(0,C.jsxs)("p",{className:"text-gray-300 mb-4",children:["Current Pins: ",(0,C.jsx)("span",{className:"font-bold ".concat(((null===le||void 0===le?void 0:le.pins)||0)>0?"text-green-400":"text-red-400"),children:(null===le||void 0===le?void 0:le.pins)||0})]})]}),(0,C.jsxs)("div",{children:[(0,C.jsxs)("label",{className:"block text-gray-300 text-sm mb-2",children:["Number of Pins to Allocate ",(0,C.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,C.jsx)("input",{type:"number",min:"1",max:"1000",value:ce.amount,onChange:e=>me(t=>(0,s.A)((0,s.A)({},t),{},{amount:e.target.value})),placeholder:"Enter number of pins",className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20"})]}),(0,C.jsxs)("div",{children:[(0,C.jsx)("label",{className:"block text-gray-300 text-sm mb-2",children:"Notes (Optional)"}),(0,C.jsx)("textarea",{value:ce.notes,onChange:e=>me(t=>(0,s.A)((0,s.A)({},t),{},{notes:e.target.value})),placeholder:"Add notes about this allocation...",rows:"3",className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20"})]}),(0,C.jsx)("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:(0,C.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,C.jsx)(v.A,{className:"w-5 h-5 text-blue-400 mt-0.5"}),(0,C.jsxs)("div",{children:[(0,C.jsx)("p",{className:"text-blue-300 text-sm font-medium",children:"Pin Allocation Info"}),(0,C.jsx)("p",{className:"text-gray-300 text-sm mt-1",children:"Each customer creation requires 1 pin. Allocate pins to enable promoters to create customers."})]})]})})]}),(0,C.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,C.jsx)("button",{onClick:ye,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",disabled:ee,children:"Cancel"}),(0,C.jsx)("button",{onClick:async()=>{if(!le||!ce.amount)return void _("Please enter a valid pin amount");const e=parseInt(ce.amount);if(e<=0)_("Pin amount must be greater than 0");else try{te(!0);const{data:a,error:s}=await c.ND.rpc("add_promoter_pins",{p_promoter_id:le.id,p_pins_to_add:e});if(s)throw new Error(s.message);await c.ND.from("pin_usage_log").insert({promoter_id:le.id,pins_used:-e,action_type:"admin_allocation",notes:ce.notes||"Admin allocated ".concat(e," pins")}),t("".concat(e," pins allocated to ").concat(le.name," successfully")),await be(),ye()}catch(a){P(a,"Failed to allocate pins")}finally{te(!1)}},disabled:ee||!ce.amount,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:ee?(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(h.A,{className:"w-4 h-4 animate-spin"}),(0,C.jsx)("span",{children:"Allocating..."})]}):(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(v.A,{className:"w-4 h-4"}),(0,C.jsx)("span",{children:"Allocate Pins"})]})})]})]})}),(0,C.jsx)(l.A,{isOpen:ae,onClose:()=>{se(!1),oe(null)},title:null===re||void 0===re?void 0:re.title,message:null===re||void 0===re?void 0:re.message,details:null===re||void 0===re?void 0:re.details})]})]})}}}]);
//# sourceMappingURL=581.6b70e979.chunk.js.map