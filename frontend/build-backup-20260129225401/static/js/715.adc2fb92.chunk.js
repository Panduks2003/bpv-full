"use strict";(self.webpackChunkbrightplanet_ventures=self.webpackChunkbrightplanet_ventures||[]).push([[715],{974:(e,t,s)=>{s.d(t,{A:()=>o});var r=s(9379),a=s(4847);const o=class{static async createCustomer(e,t){try{const s=await fetch("".concat(a.H,"/customer/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,r.A)((0,r.A)({},e),{},{parentPromoterId:t}))}),o=await s.json();if(!s.ok||!o.success)throw new Error(o.message||"Failed to create customer");return o}catch(s){throw console.error("Customer creation error:",s),s}}static async updateCustomer(e,t){try{const s=await fetch("".concat(a.H,"/customer/update"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,r.A)({customerId:e},t))}),o=await s.json();if(!s.ok||!o.success)throw new Error(o.message||"Failed to update customer");return o}catch(s){throw console.error("Customer update error:",s),s}}static async deleteCustomer(e){try{const t=await fetch("".concat(a.H,"/customer/delete"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:e})}),s=await t.json();if(!t.ok||!s.success)throw new Error(s.message||"Failed to delete customer");return s}catch(t){throw console.error("Customer deletion error:",t),t}}static async getCustomerById(e){try{const t=await fetch("".concat(a.H,"/customer/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}}),s=await t.json();if(!t.ok||!s.success)throw new Error(s.message||"Failed to get customer");return s}catch(t){throw console.error("Get customer error:",t),t}}static async getAllCustomers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const t=e?"".concat(a.H,"/customer/list?promoterId=").concat(e):"".concat(a.H,"/customer/list"),s=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}}),r=await s.json();if(!s.ok||!r.success)throw new Error(r.message||"Failed to get customers");return r}catch(t){throw console.error("Get customers error:",t),t}}}},2380:(e,t,s)=>{s.d(t,{A:()=>r});const r=(0,s(3797).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},3715:(e,t,s)=>{s.r(t),s.d(t,{default:()=>A});var r=s(9379),a=s(5043),o=s(7950),n=s(6621),l=s(4823),i=s(3792),c=s(8480);const d="https://ubokvxgxszhpzmjonuss.supabase.co",m="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InVib2t2eGd4c3pocHptam9udXNzIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1ODk1MTgzMSwiZXhwIjoyMDc0NTI3ODMxfQ.LqPZl8a2-oxPtWowjwosGiYzgMfwYQFSbCRZ3tTcA4";m&&(0,c.UU)(d,m,{auth:{autoRefreshToken:!1,persistSession:!1}});var u=s(974),h=s(8112),x=s(5722),p=s(917),g=s(987),v=s(7772),f=(s(3458),s(2380)),b=s(7008),j=s(9589),w=s(5680),N=s(45),y=(s(2631),s(1761)),C=s(5852),_=s(3216),k=s(579);const S=e=>{let{stage:t}=e;const s=(()=>{switch(t){case"customers":return{icon:(0,k.jsx)(h.A,{className:"w-8 h-8 text-blue-400 animate-pulse"}),title:"Loading Customers...",description:"Fetching customer data from database"};case"payments":return{icon:(0,k.jsx)(x.A,{className:"w-8 h-8 text-green-400 animate-pulse"}),title:"Loading Payment Data...",description:"Analyzing payment information"};case"complete":return{icon:(0,k.jsx)(p.A,{className:"w-8 h-8 text-orange-400 animate-bounce"}),title:"Almost Done...",description:"Finalizing data loading"};case"error":return{icon:(0,k.jsx)(g.A,{className:"w-8 h-8 text-red-400"}),title:"Error Loading Data",description:"Please refresh the page and try again"};default:return{icon:(0,k.jsx)(v.A,{className:"w-8 h-8 text-orange-400 animate-spin"}),title:"Initializing...",description:"Preparing to load your data"}}})();return(0,k.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 space-y-4",children:[(0,k.jsxs)("div",{className:"relative",children:[s.icon,(0,k.jsx)("div",{className:"absolute inset-0 rounded-full bg-blue-400/20 animate-ping"})]}),(0,k.jsxs)("div",{className:"text-center",children:[(0,k.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:s.title}),(0,k.jsx)("p",{className:"text-sm text-slate-400",children:s.description}),(0,k.jsxs)("div",{className:"flex items-center justify-center space-x-2 mt-4",children:[(0,k.jsx)("div",{className:"w-2 h-2 rounded-full transition-colors duration-300 ".concat("customers"===t||"payments"===t||"complete"===t?"bg-blue-400":"bg-slate-600")}),(0,k.jsx)("div",{className:"w-2 h-2 rounded-full transition-colors duration-300 ".concat("payments"===t||"complete"===t?"bg-blue-400":"bg-slate-600")}),(0,k.jsx)("div",{className:"w-2 h-2 rounded-full transition-colors duration-300 ".concat("complete"===t?"bg-blue-400":"bg-slate-600")})]})]})]})};const A=function(){var e,t;const{user:s}=(0,n.As)(),{showSuccess:c,showError:d}=((0,_.Zp)(),(0,l.L5)()),[m,x]=(0,a.useState)([]),[p,g]=(0,a.useState)([]),[A,I]=(0,a.useState)(""),[P,M]=(0,a.useState)(""),[D,R]=(0,a.useState)(""),[E,L]=(0,a.useState)(""),[T,O]=(0,a.useState)("created_at"),[q,B]=(0,a.useState)(!0),[z,F]=(0,a.useState)("initial"),[H,W]=(0,a.useState)(!1),[G,Y]=(0,a.useState)(null),[J,U]=(0,a.useState)(!1),[V,Z]=(0,a.useState)({}),X=(0,a.useRef)(null),[Q,K]=(0,a.useState)({top:0,right:0}),[$,ee]=(0,a.useState)(0),[te,se]=(0,a.useState)(!1),[re,ae]=(0,a.useState)(null),[oe,ne]=(0,a.useState)(!1),[le,ie]=(0,a.useState)(null),[ce,de]=(0,a.useState)(1),[me,ue]=(0,a.useState)((new Date).getFullYear()),[he,xe]=(0,a.useState)(""),[pe,ge]=(0,a.useState)(!1),[ve,fe]=(0,a.useState)({}),[be,je]=(0,a.useState)({}),[we,Ne]=(0,a.useState)(null),[ye,Ce]=(0,a.useState)(null),[_e,ke]=(0,a.useState)([]),[Se,Ae]=(0,a.useState)(!1);(0,a.useEffect)(()=>{let e=m||[];if(A&&(e=e.filter(e=>{const t=((null===e||void 0===e?void 0:e.name)||"").toLowerCase(),s=null===e||void 0===e?void 0:e.email,r=(null===e||void 0===e?void 0:e.phone)||(null===e||void 0===e?void 0:e.mobile),a=s&&""!==String(s).trim()?String(s).toLowerCase():"",o=null!==r&&void 0!==r&&""!==String(r).trim()?String(r).toLowerCase():"",n=((null===e||void 0===e?void 0:e.customer_id)||"").toLowerCase(),l=(A||"").toLowerCase();return t.includes(l)||a.includes(l)||o.includes(l)||n.includes(l)})),P&&(e=e.filter(e=>((null===e||void 0===e?void 0:e.status)||"active")===P)),E){const t=parseInt(E);e=e.filter(e=>{const s=(V[e.id]||[]).find(e=>e.month_number===t);return s&&"paid"===s.status})}D&&(e=e.filter(e=>((null===e||void 0===e?void 0:e.batch)||"")===D)),e="customer_id"===T?[...e].sort((e,t)=>{const s=e=>{if(!e)return 0;const t=e.match(/\d+/);return t?parseInt(t[0],10):0};return s(e.customer_id)-s(t.customer_id)}):[...e].sort((e,t)=>{const s=e.created_at?new Date(e.created_at).getTime():0;return(t.created_at?new Date(t.created_at).getTime():0)-s}),g(e)},[m,A,P,D,E,T,V]);const Ie=(0,a.useCallback)(async()=>{if(null!==s&&void 0!==s&&s.id)try{const{data:e,error:t}=await i.ND.from("profiles").select("pins").eq("id",s.id).single();if(t&&"PGRST116"!==t.code)return;ee((null===e||void 0===e?void 0:e.pins)||0)}catch(e){}},[s.id]),Pe=(0,a.useCallback)(async()=>{if(null!==s&&void 0!==s&&s.id)try{B(!0),F("customers");const{data:e,error:t}=await i.ND.from("profiles").select("\n          id,\n          name,\n          email,\n          phone,\n          mobile,\n          customer_id,\n          status,\n          created_at,\n          updated_at,\n          created_at,\n          updated_at,\n          parent_promoter_id,\n          batch\n        ").eq("parent_promoter_id",s.id).eq("role","customer").order("created_at",{ascending:!1});if(t)throw t;x(e||[]),g(e||[]),F("payments"),await Me(e||[]),F("complete")}catch(e){d("Failed to load customers"),F("error")}finally{B(!1)}},[s.id,d]),Me=async e=>{try{console.log("Fetching payments and requests via RPC for promoter:",s.id);const[e,t]=await Promise.all([i.ND.rpc("get_promoter_customer_repayments",{p_promoter_id:s.id}),i.ND.rpc("get_promoter_pending_requests",{p_promoter_id:s.id})]);e.error&&console.error("RPC payments error:",e.error),t.error&&console.error("RPC requests error:",t.error);const r=e.data||[],a=t.data||[];console.log("PROMOTER: Total payments loaded via RPC: ".concat(r.length)),console.log("PROMOTER: Total requests loaded via RPC: ".concat(a.length));const o={},n={},l={};null===r||void 0===r||r.forEach(e=>{o[e.customer_id]||(o[e.customer_id]=[]),o[e.customer_id].push(e),e.month_number===ce&&(n[e.customer_id]="paid"===e.status?"paid":"unpaid")}),null===a||void 0===a||a.forEach(e=>{l["".concat(e.customer_id,"-").concat(e.month,"-").concat(e.year)]=!0}),Z(o),je(n),fe(l),console.log("PROMOTER: Payment status for Month ".concat(ce,":"),n),console.log("PROMOTER: Customers with paid status: ".concat(Object.values(n).filter(e=>"paid"===e).length)),console.log("PROMOTER: Customers with unpaid status: ".concat(Object.values(n).filter(e=>"unpaid"===e).length))}catch(t){console.error("PROMOTER: Error loading customer payments:",t)}};(0,a.useEffect)(()=>{null!==s&&void 0!==s&&s.id&&(Pe(),Ie())},[null===s||void 0===s?void 0:s.id,Pe,Ie]);const De=()=>{se(!1)},Re=async e=>{if(e){Ae(!0);try{const{data:t,error:s}=await i.ND.rpc("get_customer_repayment_details",{p_customer_id:e});if(s)throw s;if(!t)throw new Error("No data returned from secure bridge");const{profile:r,payments:a}=t;if(Ne(r),null!==r&&void 0!==r&&r.saving_plan){const e=r.saving_plan.match(/\u20b9(\d+).*?(\d+)\s+months?/i);if(e){const t=parseInt(e[1]),s=parseInt(e[2]);Ce({monthly_amount:t,duration_months:s,maturity_amount:t*s,description:r.saving_plan})}}if(!a||0===a.length)return console.warn("No payment records found"),void ke([]);const o=a.filter(e=>{var t;return"paid"===(null===(t=e.status)||void 0===t?void 0:t.toLowerCase())}).map(e=>e.month_number),n=Array.from({length:20},(e,t)=>t+1).filter(e=>!o.includes(e));ke(n),n.length>0&&de(n[0].toString())}catch(t){console.error("Detailed fetch error:",t),d("Failed to load customer repayment info. Please retry."),ke([])}finally{Ae(!1)}}},Ee=e=>{const t=null===e||void 0===e?void 0:e.parent_promoter_id;return t?t===(null===s||void 0===s?void 0:s.id)?(null===s||void 0===s?void 0:s.name)||"You":"Other Promoter":"Unassigned"};return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:(0,k.jsxs)("div",{className:"container mx-auto px-4 py-6 pt-40",children:[(0,k.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between mb-6",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("h1",{className:"text-2xl font-bold text-white",children:"Customer Management"}),(0,k.jsx)("p",{className:"text-slate-400",children:"Manage customer accounts and assignments"})]}),(0,k.jsxs)("div",{className:"mt-4 md:mt-0 flex items-center space-x-4",children:[(0,k.jsx)("div",{className:"flex items-center space-x-2",children:(0,k.jsxs)("button",{onClick:()=>{0!==p.length?document.getElementById("request_modal").showModal():d("No customers available to request repayment")},className:"bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-orange-500/25 flex items-center space-x-2",children:[(0,k.jsx)(f.A,{className:"w-4 h-4"}),(0,k.jsx)("span",{children:"Request Repayment"})]})}),(0,k.jsxs)("button",{onClick:()=>{se(!0)},disabled:$<1,className:"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-blue-500/25 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none flex items-center space-x-2",children:[(0,k.jsx)(f.A,{className:"w-4 h-4"}),(0,k.jsx)("span",{children:"Create Customer"})]}),(0,k.jsx)("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700/50 min-w-[200px]",children:(0,k.jsxs)("div",{className:"flex items-center justify-between",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{className:"text-sm font-medium text-slate-300",children:"Available Pins"}),(0,k.jsx)("p",{className:"text-2xl font-bold ".concat($>0?"text-white":"text-red-400"),children:$}),(0,k.jsx)("p",{className:"text-xs text-slate-400 mt-1",children:0===$?"No pins available - contact admin":"Required: 1 pin per customer"})]}),(0,k.jsx)("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center ".concat($>0?"bg-orange-500":"bg-red-500"),children:(0,k.jsx)("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:(0,k.jsx)("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})})})]})})]})]}),(0,k.jsx)("div",{className:"bg-slate-800/50 rounded-xl p-4 mb-6 border border-slate-700/50",style:{overflow:"visible"},children:(0,k.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,k.jsx)("div",{className:"flex-1 min-w-[300px]",children:(0,k.jsxs)("div",{className:"relative",children:[(0,k.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,k.jsx)("svg",{className:"w-4 h-4 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),(0,k.jsx)("input",{type:"text",placeholder:"Search by name, ID, phone, or email...",value:A,onChange:e=>I(e.target.value),className:"w-full h-10 pl-10 pr-3 bg-slate-700/50 border border-slate-600 rounded-lg text-white placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all text-sm"})]})}),(0,k.jsxs)("div",{className:"relative",children:[(0,k.jsxs)("select",{value:P,onChange:e=>M(e.target.value),className:"appearance-none h-10 bg-slate-700/50 border border-slate-600 rounded-lg text-white px-3 pr-8 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all cursor-pointer hover:bg-slate-600/50 text-sm",children:[(0,k.jsx)("option",{value:"",children:"All Status"}),(0,k.jsx)("option",{value:"active",children:"Active"}),(0,k.jsx)("option",{value:"inactive",children:"Inactive"})]}),(0,k.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,k.jsx)("svg",{className:"w-3 h-3 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,k.jsxs)("div",{className:"relative",children:[(0,k.jsxs)("select",{value:D,onChange:e=>R(e.target.value),className:"appearance-none h-10 bg-slate-700/50 border border-slate-600 rounded-lg text-white px-3 pr-8 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all cursor-pointer hover:bg-slate-600/50 text-sm",children:[(0,k.jsx)("option",{value:"",children:"All Batches"}),(0,k.jsx)("option",{value:"Batch 1",children:"Batch 1"}),(0,k.jsx)("option",{value:"Batch 2",children:"Batch 2"})]}),(0,k.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,k.jsx)("svg",{className:"w-3 h-3 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,k.jsxs)("div",{className:"relative",children:[(0,k.jsxs)("select",{value:E,onChange:e=>L(e.target.value),className:"appearance-none h-10 bg-slate-700/50 border border-slate-600 rounded-lg text-white px-3 pr-8 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all cursor-pointer hover:bg-slate-600/50 text-sm",children:[(0,k.jsx)("option",{value:"",children:"All Payments"}),Array.from({length:20},(e,t)=>t+1).map(e=>(0,k.jsxs)("option",{value:e.toString(),children:["Paid - Month ",e]},e))]}),(0,k.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,k.jsx)("svg",{className:"w-3 h-3 text-slate-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,k.jsxs)("div",{className:"flex items-center bg-slate-700/50 rounded-lg p-1 border border-slate-600 h-10",children:[(0,k.jsx)("button",{onClick:()=>O("created_at"),className:"px-3 h-full flex items-center text-sm rounded-md transition-all font-medium whitespace-nowrap ".concat("created_at"===T?"bg-orange-500 text-white shadow-md":"text-slate-300 hover:text-white"),title:"Sort by Newest",children:"Newest"}),(0,k.jsx)("button",{onClick:()=>O("customer_id"),className:"px-3 h-full flex items-center text-sm rounded-md transition-all font-medium whitespace-nowrap ".concat("customer_id"===T?"bg-orange-500 text-white shadow-md":"text-slate-300 hover:text-white"),title:"Sort by Customer ID",children:"By ID"})]}),(0,k.jsxs)("div",{className:"relative",ref:X,children:[(0,k.jsxs)("button",{onClick:()=>{if(X.current){const e=X.current.getBoundingClientRect();K({top:e.bottom+8,right:window.innerWidth-e.right})}U(!J)},className:"h-10 px-4 bg-blue-600 hover:bg-blue-500 border border-blue-500 rounded-lg text-white font-medium transition-all flex items-center space-x-2 text-sm",title:"Download options",children:[(0,k.jsx)(b.A,{className:"w-4 h-4"}),(0,k.jsx)("span",{children:"Export"})]}),J&&(0,o.createPortal)((0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("div",{className:"fixed inset-0 z-[9998]",onClick:()=>U(!1)}),(0,k.jsxs)("div",{className:"fixed w-48 bg-slate-800 border-2 border-slate-600 rounded-lg shadow-2xl z-[9999]",style:{top:"".concat(Q.top,"px"),right:"".concat(Q.right,"px"),minWidth:"12rem"},children:[(0,k.jsx)("button",{onClick:()=>{const e=p.map(e=>({"Customer Name":e.name||"N/A","Customer ID":e.customer_id||"N/A","Assigned Promoter":Ee(e),Email:e.email||"N/A",Phone:e.phone||"N/A",Status:e.status||"active","Created At":e.created_at?new Date(e.created_at).toLocaleDateString():"N/A"}));(0,N.Q7)(e,"Customers List","customers_".concat((new Date).toISOString().split("T")[0],".pdf")),U(!1)},className:"w-full text-left px-4 py-3 text-white hover:bg-slate-700 rounded-t-lg flex items-center space-x-2 transition-colors",children:(0,k.jsx)("span",{children:"\ud83d\udcc4 PDF"})}),(0,k.jsx)("button",{onClick:()=>{const e=p.map(e=>({"Customer Name":e.name||"N/A","Customer ID":e.customer_id||"N/A","Assigned Promoter":Ee(e),Email:e.email||"N/A",Phone:e.phone||"N/A",Status:e.status||"active","Created At":e.created_at?new Date(e.created_at).toLocaleDateString():"N/A"}));(0,N.GF)(e,"customers_".concat((new Date).toISOString().split("T")[0],".csv")),U(!1)},className:"w-full text-left px-4 py-3 text-white hover:bg-slate-700 rounded-b-lg flex items-center space-x-2 transition-colors",children:(0,k.jsx)("span",{children:"\ud83d\udcca CSV"})})]})]}),document.body)]})]})}),(0,k.jsx)("div",{className:"bg-slate-800/50 rounded-xl border border-slate-700/50 overflow-hidden",children:q?(0,k.jsx)(S,{stage:z}):0===p.length?(0,k.jsxs)("div",{className:"text-center p-12",children:[(0,k.jsx)(h.A,{className:"mx-auto h-12 w-12 text-slate-500"}),(0,k.jsx)("h3",{className:"mt-2 text-sm font-medium text-white",children:"No customers found"}),(0,k.jsx)("p",{className:"text-sm text-slate-400",children:A?"Try a different search term":"You have no customers assigned yet"})]}):(0,k.jsx)("div",{className:"overflow-x-auto",children:(0,k.jsxs)("table",{className:"w-full",children:[(0,k.jsx)("thead",{className:"bg-slate-700/50",children:(0,k.jsxs)("tr",{children:[(0,k.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider",children:"Customer Details"}),(0,k.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider",children:"Contact Details"}),(0,k.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider",children:"Batch & Saving Plan"}),(0,k.jsx)("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-slate-300 uppercase tracking-wider",children:"Status"}),(0,k.jsx)("th",{scope:"col",className:"px-6 py-3 text-right text-xs font-medium text-slate-300 uppercase tracking-wider",children:"Actions"})]})}),(0,k.jsx)("tbody",{className:"bg-slate-800/50 divide-y divide-slate-700",children:p.map(e=>(0,k.jsxs)("tr",{className:"hover:bg-slate-700/30",children:[(0,k.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center mr-3",children:(0,k.jsx)("span",{className:"text-white text-sm font-bold",children:((null===e||void 0===e?void 0:e.name)||"C").charAt(0)})}),(0,k.jsxs)("div",{className:"flex flex-col",children:[(0,k.jsx)("span",{className:"text-white font-medium",children:(null===e||void 0===e?void 0:e.name)||"Unnamed Customer"}),(0,k.jsx)("span",{className:"text-xs text-slate-400",children:(null===e||void 0===e?void 0:e.customer_id)||"N/A"})]})]})}),(0,k.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-slate-300",children:(0,k.jsxs)("div",{className:"space-y-1",children:[(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)(j.A,{className:"w-3 h-3 mr-2 text-slate-400"}),(null===e||void 0===e?void 0:e.email)||"No email"]}),(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)(w.A,{className:"w-3 h-3 mr-2 text-slate-400"}),(null===e||void 0===e?void 0:e.phone)||(null===e||void 0===e?void 0:e.mobile)||"No phone"]})]})}),(0,k.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,k.jsxs)("div",{className:"flex flex-col space-y-1.5",children:[(null===e||void 0===e?void 0:e.batch)&&(0,k.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border w-fit ".concat("Batch 1"===e.batch?"bg-emerald-500/10 text-emerald-400 border-emerald-500/20":"bg-purple-500/10 text-purple-400 border-purple-500/20"),children:[(0,k.jsx)("div",{className:"w-1 h-1 rounded-full mr-1.5 ".concat("Batch 1"===e.batch?"bg-emerald-400":"bg-purple-400")}),e.batch]}),(0,k.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-500/10 text-blue-400 border border-blue-500/20 w-fit",children:[(0,k.jsx)("div",{className:"w-1 h-1 rounded-full mr-1.5 bg-blue-400"}),"\u20b91000 \xd7 20 Months"]})]})}),(0,k.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,k.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium capitalize border ".concat("active"===(e.status||"active")?"bg-green-500/10 text-green-400 border-green-500/20":"bg-red-500/10 text-red-400 border-red-500/20"),children:[(0,k.jsx)("span",{className:"w-1.5 h-1.5 rounded-full mr-2 ".concat("active"===(e.status||"active")?"bg-green-400":"bg-red-400")}),e.status||"Active"]})}),(0,k.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:(0,k.jsxs)("div",{className:"flex items-center justify-end space-x-2",children:[(0,k.jsx)("button",{onClick:()=>(e=>{Y(e),W(!0)})(e),className:"text-green-400 hover:text-green-300 transition-colors p-2 hover:bg-green-500/10 rounded cursor-pointer",title:"Manage Payments",children:(0,k.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})})}),(0,k.jsx)("button",{onClick:()=>{Ne(null),Ce(null),ke([]),ie(e),Re(e.id),xe(""),document.getElementById("request_modal").showModal()},className:"text-orange-400 hover:text-orange-300 transition-colors p-2 hover:bg-orange-500/10 rounded cursor-pointer",title:"Request Repayment",children:(0,k.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H8m8 8l-4-4m0 0l4 4"})})})]})})]},e.id))})]})})}),te&&(0,k.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,k.jsxs)("div",{className:"bg-gradient-to-br from-slate-800 to-slate-900 rounded-2xl border border-orange-400/30 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl",children:[(0,k.jsx)("div",{className:"bg-gradient-to-r from-orange-500/20 to-red-500/20 p-6 border-b border-orange-400/30",children:(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-orange-400 to-red-500 rounded-full flex items-center justify-center shadow-lg",children:(0,k.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 00-4-4H4a4 4 0 00-4 4v8a4 4 0 004 4h8a4 4 0 004-4v8a4 4 0 004-4z"})})}),(0,k.jsxs)("div",{className:"ml-4",children:[(0,k.jsx)("h2",{className:"text-2xl font-bold text-white",children:"Create New Customer"}),(0,k.jsx)("p",{className:"text-orange-100 text-sm",children:"Add a new customer to your network (1 PIN required)"})]})]})}),(0,k.jsx)("div",{className:"p-6",children:(0,k.jsx)(y.A,{isOpen:te,onClose:De,onSubmit:async e=>{try{if($<1)throw new Error("You have insufficient pins (".concat($," available). Please request more pins from admin to create customers."));const t=await u.A.createCustomer(e,s.id);if(!t.success)throw new Error(t.error||t.message||"Failed to create customer");c(t.message||"Customer Created Successfully!\n\nCard No: ".concat(e.cardNo,"\nName: ").concat(e.name,"\nLogin: Use Card No + Password")),await Pe(),await Ie(),De()}catch(t){d("Failed to create customer: ".concat(t.message))}},onCancel:De,promoters:[{id:s.id,name:s.name,promoter_id:s.promoter_id,role:s.role}],availablePins:$,currentUserRole:"promoter",isEditing:!!re,initialData:re})})]})}),H&&(null===G||void 0===G?void 0:G.id)&&(0,k.jsx)(C.A,{customerId:G.id,customerName:G.name,isOpen:H,onClose:()=>{W(!1),Y(null)},currentUser:s}),(0,k.jsx)("dialog",{id:"request_modal",className:"modal backdrop-blur-sm",onClick:e=>{e.target===e.currentTarget&&(e.currentTarget.close(),ie(null),Ne(null),Ce(null),ke([]),de(1),xe(""))},children:(0,k.jsxs)("div",{className:"modal-box bg-gradient-to-br from-slate-800 to-slate-900 border border-orange-400/30 max-w-2xl shadow-2xl transform transition-all duration-300 scale-95 hover:scale-100",onClick:e=>e.stopPropagation(),children:[(0,k.jsx)("div",{className:"bg-gradient-to-r from-orange-600/90 to-red-600/90 p-6 border-b border-orange-400/30 rounded-t-xl",children:(0,k.jsxs)("div",{className:"flex items-center",children:[(0,k.jsx)("div",{className:"w-14 h-14 bg-gradient-to-br from-orange-400 to-red-500 rounded-xl flex items-center justify-center shadow-lg transform transition-transform hover:rotate-6",children:(0,k.jsx)("svg",{className:"w-7 h-7 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,k.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,k.jsxs)("div",{className:"ml-4",children:[(0,k.jsx)("h3",{className:"text-2xl font-bold text-white",children:"Request Repayment"}),(0,k.jsx)("p",{className:"text-orange-100 text-sm",children:"Submit repayment request for customer"})]})]})}),(0,k.jsxs)("div",{className:"p-6 space-y-6",children:[(0,k.jsxs)("div",{className:"space-y-2",children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-slate-300",children:"Select Customer"}),(0,k.jsxs)("select",{className:"select select-bordered w-full bg-slate-800/50 border-slate-700/50 text-white focus:border-orange-500 focus:ring-orange-500",value:(null===le||void 0===le?void 0:le.id)||"",onChange:e=>{const t=p.find(t=>t.id===e.target.value);Ne(null),Ce(null),ke([]),ie(t),t&&Re(t.id)},disabled:Se,children:[(0,k.jsx)("option",{value:"",children:"Select a customer"}),p.map(e=>(0,k.jsxs)("option",{value:e.id,children:[e.name," (",e.customer_id||"No ID",")"]},e.id))]})]}),Se&&(0,k.jsx)("div",{className:"flex items-center justify-center p-4",children:(0,k.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-orange-500"})}),le&&(0,k.jsx)("div",{className:"bg-slate-800/50 rounded-xl p-4 border border-slate-700/50",children:(0,k.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{className:"text-sm text-slate-400",children:"Customer Name"}),(0,k.jsx)("p",{className:"text-white font-medium",children:le.name})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{className:"text-sm text-slate-400",children:"Customer ID"}),(0,k.jsxs)("p",{className:"text-blue-400 font-mono",children:["#",le.customer_id||"N/A"]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{className:"text-sm text-slate-400",children:"Phone"}),(0,k.jsx)("p",{className:"text-white",children:le.phone||"N/A"})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{className:"text-sm text-slate-400",children:"KYC Status"}),(0,k.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat("approved"===le.kyc_status?"bg-green-500/20 text-green-300":"bg-yellow-500/20 text-yellow-300"),children:"approved"===le.kyc_status?"Verified":"Pending KYC"})]})]})}),ye&&(0,k.jsxs)("div",{className:"bg-gradient-to-br from-blue-900/20 to-purple-900/20 rounded-xl p-4 border border-blue-500/20",children:[(0,k.jsx)("h4",{className:"text-sm font-medium text-blue-300 mb-2",children:"SAVING PLAN"}),(0,k.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{className:"text-xs text-slate-400",children:"Monthly Amount"}),(0,k.jsxs)("p",{className:"text-white font-medium",children:["\u20b9",(null===(e=ye.monthly_amount)||void 0===e?void 0:e.toLocaleString())||"N/A"]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{className:"text-xs text-slate-400",children:"Duration"}),(0,k.jsxs)("p",{className:"text-white",children:[ye.duration_months||"N/A"," months"]})]}),(0,k.jsxs)("div",{children:[(0,k.jsx)("p",{className:"text-xs text-slate-400",children:"Maturity Amount"}),(0,k.jsxs)("p",{className:"text-white font-medium",children:["\u20b9",(null===(t=ye.maturity_amount)||void 0===t?void 0:t.toLocaleString())||"N/A"]})]})]}),ye.description&&(0,k.jsx)("p",{className:"text-xs text-slate-400 mt-2",children:ye.description})]}),_e.length>0&&(0,k.jsxs)("div",{className:"space-y-2",children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-slate-300",children:"Select Month for Repayment"}),(0,k.jsx)("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-6 gap-2",children:_e.map(e=>(0,k.jsxs)("button",{type:"button",onClick:()=>de(e.toString()),className:"py-2 px-3 rounded-lg text-center border transition-colors ".concat(ce===e.toString()?"bg-orange-600 border-orange-500 text-white":"bg-slate-800/50 border-slate-700/50 text-slate-300 hover:border-orange-500/50"),children:["Month ",e]},e))})]}),le&&!Se&&0===_e.length&&(0,k.jsxs)("div",{className:"bg-yellow-900/20 border border-yellow-800/50 text-yellow-400 p-4 rounded-lg text-center",children:[(0,k.jsx)("p",{className:"font-medium",children:"No pending repayments found."}),(0,k.jsx)("p",{className:"text-xs mt-1 opacity-80",children:"This customer either has no payment schedule or all 20 months are marked as paid."})]}),(0,k.jsxs)("div",{className:"space-y-2",children:[(0,k.jsx)("label",{className:"block text-sm font-medium text-slate-300",children:"Additional Notes (Optional)"}),(0,k.jsx)("textarea",{className:"w-full bg-slate-800/50 border border-slate-700/50 rounded-lg p-3 text-white placeholder-slate-400 focus:ring-2 focus:ring-orange-500 focus:border-transparent",rows:3,placeholder:"Add any additional information about this payment...",value:he,onChange:e=>xe(e.target.value)})]}),(0,k.jsxs)("div",{className:"flex justify-end pt-4 space-x-3",children:[(0,k.jsx)("button",{type:"button",onClick:()=>{document.getElementById("request_modal").close(),ie(null),Ne(null),Ce(null),ke([]),de(1),xe("")},className:"px-4 py-2 bg-slate-700 hover:bg-slate-600 text-white rounded-lg transition-colors",disabled:pe,children:"Cancel"}),(0,k.jsx)("button",{type:"button",onClick:async()=>{if(!le||!ce)return void d("Please select a customer and month");const e=parseInt(ce);if(_e.includes(e))if(ve["".concat(le.id,"-").concat(ce,"-").concat(me)])d("A pending request for Month ".concat(ce," already exists."));else try{ge(!0);const{data:e,error:t}=await i.ND.rpc("submit_repayment_request_secure",{p_promoter_id:s.id,p_customer_id:le.id,p_month:parseInt(ce),p_year:parseInt(me),p_remarks:he.trim()||null});if(t||null===e||void 0===e||!e.success)throw new Error((null===t||void 0===t?void 0:t.message)||(null===e||void 0===e?void 0:e.error)||"Failed to submit request via secure bridge");const a="".concat(le.id,"-").concat(ce,"-").concat(me);fe(e=>(0,r.A)((0,r.A)({},e),{},{[a]:!0})),c("Repayment request submitted for approval"),document.getElementById("request_modal").close(),ie(null),Ne(null),Ce(null),ke([]),de(1),xe(""),ne(!1)}catch(t){console.error("Submission error:",t),d(t.message||"Failed to submit repayment request")}finally{ge(!1)}else d("Month ".concat(e," is already marked as paid for this customer."))},disabled:pe||!(null!==le&&void 0!==le&&le.id)||!ce||0===_e.length,className:"px-6 py-2 bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 text-white rounded-lg transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:pe?(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)(v.A,{className:"animate-spin -ml-1 mr-2 h-4 w-4"}),"Submitting..."]}):"Submit Request"})]})]})]})})]})})})}},4847:(e,t,s)=>{s.d(t,{H:()=>r});const r="https://api.brightplanetventures.com/api"},5722:(e,t,s)=>{s.d(t,{A:()=>r});const r=(0,s(3797).A)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])}}]);
//# sourceMappingURL=715.adc2fb92.chunk.js.map