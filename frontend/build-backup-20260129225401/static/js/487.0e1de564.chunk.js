"use strict";(self.webpackChunkbrightplanet_ventures=self.webpackChunkbrightplanet_ventures||[]).push([[487],{974:(e,t,o)=>{o.d(t,{A:()=>n});var s=o(9379),a=o(4847);const n=class{static async createCustomer(e,t){try{const o=await fetch("".concat(a.H,"/customer/create"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,s.A)((0,s.A)({},e),{},{parentPromoterId:t}))}),n=await o.json();if(!o.ok||!n.success)throw new Error(n.message||"Failed to create customer");return n}catch(o){throw console.error("Customer creation error:",o),o}}static async updateCustomer(e,t){try{const o=await fetch("".concat(a.H,"/customer/update"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify((0,s.A)({customerId:e},t))}),n=await o.json();if(!o.ok||!n.success)throw new Error(n.message||"Failed to update customer");return n}catch(o){throw console.error("Customer update error:",o),o}}static async deleteCustomer(e){try{const t=await fetch("".concat(a.H,"/customer/delete"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({customerId:e})}),o=await t.json();if(!t.ok||!o.success)throw new Error(o.message||"Failed to delete customer");return o}catch(t){throw console.error("Customer deletion error:",t),t}}static async getCustomerById(e){try{const t=await fetch("".concat(a.H,"/customer/").concat(e),{method:"GET",headers:{"Content-Type":"application/json"}}),o=await t.json();if(!t.ok||!o.success)throw new Error(o.message||"Failed to get customer");return o}catch(t){throw console.error("Get customer error:",t),t}}static async getAllCustomers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const t=e?"".concat(a.H,"/customer/list?promoterId=").concat(e):"".concat(a.H,"/customer/list"),o=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}}),s=await o.json();if(!o.ok||!s.success)throw new Error(s.message||"Failed to get customers");return s}catch(t){throw console.error("Get customers error:",t),t}}}},2487:(e,t,o)=>{o.r(t),o.d(t,{default:()=>k});var s=o(9379),a=o(5043),n=o(7950),r=o(6621),l=o(1921),c=o(1761),i=o(5852),d=o(3959),m=o(3792),h=o(974),u=o(4725),x=o(8432),g=o(5722),p=o(7008),y=o(9589),v=o(6787),b=o(5680),f=o(2380),w=o(6339),j=o(8112),N=o(1754),C=o(45),E=o(579);const k=function(){const{user:e}=(0,r.As)(),{showSuccess:t,showError:o}=(0,l.L5)();(0,d.r9)();const[k,S]=(0,a.useState)([]),[_,A]=(0,a.useState)([]),[M,P]=(0,a.useState)([]),[D,L]=(0,a.useState)(""),[T,B]=(0,a.useState)(""),[I,F]=(0,a.useState)(""),[G,U]=(0,a.useState)(""),[O,R]=(0,a.useState)(""),[H,q]=(0,a.useState)(!1),[z,W]=(0,a.useState)(!1),[V,Y]=(0,a.useState)({}),[K,J]=(0,a.useState)("created_at"),Q=(0,a.useRef)(null),[X,Z]=(0,a.useState)({top:0,right:0}),[$,ee]=(0,a.useState)(!1),[te,oe]=(0,a.useState)(null),[se,ae]=(0,a.useState)(null),[ne,re]=(0,a.useState)(!0),[le,ce]=(0,a.useState)(!1),[ie,de]=(0,a.useState)(null),[me,he]=(0,a.useState)(1),[ue,xe]=(0,a.useState)(1e4);(0,a.useEffect)(()=>{let e=!0;return(async()=>{e&&await ge()})(),()=>{e=!1}},[]);const ge=async()=>{try{re(!0);const[e,t]=await Promise.all([m.ND.from("profiles").select("\n            id,\n            name,\n            email,\n            phone,\n            mobile,\n            customer_id,\n            parent_promoter_id,\n            status,\n            created_at,\n            state,\n            city,\n            pincode,\n            address,\n            saving_plan,\n            promoter_id,\n            role_level,\n            pins,\n            wallet_balance,\n            kyc_status,\n            batch\n          ").eq("role","customer").order("created_at",{ascending:!1}),m.ND.from("profiles").select("id, name, promoter_id").eq("role","promoter").order("created_at",{ascending:!1}).limit(50)]),{data:o,error:s}=e,{data:a,error:n}=t;if(s)throw s;if(n)throw n;S(o||[]),A(a||[]),P(o||[]),console.log("=== CUSTOMER BATCH DEBUG ===");const r={};(o||[]).forEach(e=>{const t=e.batch||"NULL";r[t]=(r[t]||0)+1}),console.log("Batch distribution:",r),console.log("Sample customers:"),(o||[]).slice(0,5).forEach(e=>{console.log("  ".concat(e.name," (").concat(e.customer_id,'): batch="').concat(e.batch,'"'))}),console.log("=== END BATCH DEBUG ==="),re(!1),setTimeout(async()=>{try{const{data:e}=await m.ND.from("profiles").select("id, name, promoter_id").eq("role","promoter").order("created_at",{ascending:!1}).limit(500);e&&A(e)}catch(e){console.error("Error loading more promoters:",e)}},200)}catch(e){S([]),A([]),P([]),re(!1)}};(0,a.useEffect)(()=>{if(k.length>0&&0===Object.keys(V).length){const e=setTimeout(()=>{!async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const t=e||k.map(e=>e.id);if(0===t.length)return;console.log("=== LOADING PAYMENTS ==="),console.log("Loading payments for ".concat(t.length," customers in ").concat(Math.ceil(t.length/100)," batches"));const o=100,a=[],n=Math.ceil(t.length/o);for(let e=0;e<n;e++){const s=t.slice(e*o,(e+1)*o);console.log("Processing batch ".concat(e+1,"/").concat(n," with ").concat(s.length," customers"));const{data:r,error:l}=await m.ND.from("customer_payments").select("customer_id, month_number, status, payment_amount").in("customer_id",s);l?console.error("Batch ".concat(e+1," error:"),l):r&&(a.push(...r),console.log("Batch ".concat(e+1,"/").concat(n,": Loaded ").concat(r.length," payments")))}const r={};a.forEach(e=>{r[e.customer_id]||(r[e.customer_id]=[]),r[e.customer_id].push(e)}),Y(e=>(0,s.A)((0,s.A)({},e),r)),console.log("=== PAYMENT LOADING COMPLETE ==="),console.log("Total payments loaded: ".concat(a.length)),console.log("Customers with payment data: ".concat(Object.keys(r).length)),console.log("Expected customers: ".concat(t.length)),console.log("Missing payment data for: ".concat(t.length-Object.keys(r).length," customers"));const l=t.filter(e=>!r[e]);l.length>0&&console.log("Customers without payment data (first 5):",l.slice(0,5))}catch(t){console.error("Error loading customer payments:",t)}}()},500);return()=>clearTimeout(e)}},[k]),(0,a.useEffect)(()=>{let e=[...k];if(T){const t=T.trim().toLowerCase();e=e.filter(e=>((null===e||void 0===e?void 0:e.customer_id)||"").toLowerCase().includes(t))}if(D&&(e=e.filter(e=>{const t=((null===e||void 0===e?void 0:e.name)||"").toLowerCase(),o=null===e||void 0===e?void 0:e.email,s=(null===e||void 0===e?void 0:e.phone)||(null===e||void 0===e?void 0:e.mobile),a=((null===e||void 0===e?void 0:e.customer_id)||"").toLowerCase(),n=o&&""!==String(o).trim()?String(o).toLowerCase():"",r=null!==s&&void 0!==s&&""!==String(s).trim()?String(s).toLowerCase():"",l=(D||"").toLowerCase();return t.includes(l)||n.includes(l)||r.includes(l)||a.includes(l)})),I&&(e=e.filter(e=>((null===e||void 0===e?void 0:e.status)||"active").toLowerCase()===I.toLowerCase())),G){console.log("=== BATCH FILTER DEBUG ==="),console.log('Filtering for: "'.concat(G,'"'));const t=e.length,o=e.slice(0,3).map(e=>({name:e.name,batch:null===e||void 0===e?void 0:e.batch,batchType:typeof(null===e||void 0===e?void 0:e.batch)}));console.log("Sample batch values:",o),e=e.filter(e=>{const o=null===e||void 0===e?void 0:e.batch,s=o&&o.toString().toLowerCase()===G.toLowerCase();return!s&&t<=10&&console.log('NO MATCH: "'.concat(o,'" != "').concat(G,'"')),s}),console.log("Batch filter result: ".concat(e.length," customers (from ").concat(t,")")),console.log("=== END BATCH FILTER DEBUG ===")}if(e="customer_id"===K?[...e].sort((e,t)=>{const o=e=>{if(!e)return 0;const t=e.match(/\d+/);return t?parseInt(t[0],10):0};return o(e.customer_id)-o(t.customer_id)}):[...e].sort((e,t)=>{const o=new Date(e.created_at||0);return new Date(t.created_at||0).getTime()-o.getTime()}),O){const t=parseInt(O);console.log("=== PAYMENT FILTER DEBUG ==="),console.log("Applying payment filter for month ".concat(t)),console.log("Total customers before filter:",e.length),console.log("Customer payments loaded:",Object.keys(V).length),console.log("Payment filter month:",t);const o=e.slice(0,3).map(e=>{const o=V[e.id]||[],s=o.find(e=>e.month_number===t);return{name:e.name,customerId:e.id,hasPayments:o.length>0,monthPayment:s,monthPaymentStatus:null===s||void 0===s?void 0:s.status,allPaymentStatuses:o.map(e=>({month:e.month_number,status:e.status}))}});console.log("Sample payment data:",o);let s=0,a=0,n=0,r=0;const l=e.length;e=e.filter(e=>{const o=V[e.id]||[],l=o.find(e=>e.month_number===t);return l?"paid"===l.status?(s++,console.log("\u2705 KEEPING: ".concat(e.name," - Month ").concat(t," status: ").concat(l.status)),!0):("unpaid"===l.status?(a++,console.log("\u274c REMOVING: ".concat(e.name," - Month ").concat(t," status: ").concat(l.status))):(n++,console.log("\u274c REMOVING: ".concat(e.name," - Month ").concat(t," status: ").concat(l.status))),!1):(r++,r<=5&&(console.log("\u274c REMOVING: ".concat(e.name," (ID: ").concat(e.id,") has no payment record for month ").concat(t)),console.log("Available payments for this customer:",o.map(e=>({month:e.month_number,status:e.status})))),!1)}),console.log("Payment filter ".concat(t,": ").concat(e.length," customers have paid month ").concat(t," (from ").concat(l,")")),console.log("Summary: ".concat(s," paid, ").concat(a," unpaid, ").concat(n," other status, ").concat(r," no payment records")),console.log("=== END PAYMENT FILTER DEBUG ===")}P(e),he(1)},[k,D,I,G,O,V,K]);const pe=()=>{console.log("=== PAYMENT DATA DEBUG ==="),console.log("Total customers:",k.length),console.log("Customer payments loaded:",Object.keys(V).length);const e=k.filter(e=>!V[e.id]||0===V[e.id].length);console.log("Customers without payment data:",e.length),e.length>0&&(console.log("Sample customers without payments:"),e.slice(0,5).forEach(e=>{console.log("- ".concat(e.name," (").concat(e.id,"): customer_id=").concat(e.customer_id))}));let t=0,o=0,s=0;k.forEach(e=>{const a=(V[e.id]||[]).find(e=>1===e.month_number);a&&"paid"===a.status?t++:a?o++:s++}),console.log("Month 1 Summary: ".concat(t," paid, ").concat(o," unpaid, ").concat(s," no payment records")),console.log("Expected: 658 paid customers"),console.log("=== END DEBUG ===")};(0,a.useEffect)(()=>{Object.keys(V).length>0&&pe()},[V]),(0,a.useEffect)(()=>{const e=e=>{(e.metaKey||e.ctrlKey)&&e.shiftKey&&"D"===e.key&&(e.preventDefault(),console.log("=== MANUAL DEBUG TRIGGERED ==="),pe())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[k,V]);const ye=()=>{q(!1),oe(null)},ve=()=>{ee(!1),ae(null)};return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(d.wE,{}),(0,E.jsxs)(d.dQ,{children:[(0,E.jsx)("div",{className:"min-h-screen pt-40 px-8 pb-8",children:(0,E.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,E.jsxs)("div",{className:"flex justify-between items-center mb-8","data-animate":!0,children:[(0,E.jsxs)("div",{children:[(0,E.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:"Customer Management"}),(0,E.jsx)("p",{className:"text-gray-300",children:"Manage customer accounts and assignments"})]}),(0,E.jsxs)("div",{className:"flex items-center gap-3",children:[(0,E.jsxs)(d.Rq,{onClick:()=>{oe(null),q(!0)},className:"flex items-center space-x-2 px-3 py-2 text-sm",children:[(0,E.jsx)(f.A,{className:"w-4 h-4"}),(0,E.jsx)("span",{children:"Create Customer"})]}),(0,E.jsxs)("div",{className:"relative",ref:Q,children:[(0,E.jsxs)(d.Rq,{onClick:()=>{if(Q.current){const e=Q.current.getBoundingClientRect();Z({top:e.bottom+8,right:window.innerWidth-e.right})}W(!z)},className:"flex items-center space-x-2 px-3 py-2 text-sm bg-blue-600 hover:bg-blue-500 border border-blue-500",children:[(0,E.jsx)(p.A,{className:"w-4 h-4"}),(0,E.jsx)("span",{children:"Export"})]}),z&&(0,n.createPortal)((0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{className:"fixed inset-0 z-[9998]",onClick:()=>W(!1)}),(0,E.jsxs)("div",{className:"fixed w-48 bg-gray-800 border-2 border-gray-600 rounded-lg shadow-2xl z-[9999]",style:{top:"".concat(X.top,"px"),right:"".concat(X.right,"px"),minWidth:"12rem"},children:[(0,E.jsx)("button",{onClick:async()=>{try{const e=M.map(e=>{const t=_.find(t=>t.id===e.parent_promoter_id);return(0,s.A)((0,s.A)({},e),{},{promoter_name:(null===t||void 0===t?void 0:t.name)||"Unassigned"})});await C.Q7(e,"customers"),W(!1)}catch(e){o("Failed to export PDF: "+e.message)}},className:"w-full text-left px-4 py-3 text-white hover:bg-gray-700 rounded-t-lg flex items-center space-x-2 transition-colors",children:(0,E.jsx)("span",{children:"\ud83d\udcc4 PDF"})}),(0,E.jsx)("button",{onClick:()=>{try{const e=M.map(e=>{const t=_.find(t=>t.id===e.parent_promoter_id);return(0,s.A)((0,s.A)({},e),{},{promoter_name:(null===t||void 0===t?void 0:t.name)||"Unassigned"})});C.GF(e,"customers"),W(!1)}catch(e){o("Failed to export CSV: "+e.message)}},className:"w-full text-left px-4 py-3 text-white hover:bg-gray-700 rounded-b-lg flex items-center space-x-2 transition-colors",children:(0,E.jsx)("span",{children:"\ud83d\udcca CSV"})})]})]}),document.body)]})]})]}),(0,E.jsx)(d.Xg,{className:"mb-6","data-animate":!0,style:{overflow:"visible"},children:(0,E.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,E.jsx)("div",{className:"flex-1 min-w-[300px]",children:(0,E.jsxs)("div",{className:"relative",children:[(0,E.jsx)("input",{type:"text",placeholder:"Search by name, ID, phone, or email...",value:D,onChange:e=>L(e.target.value),className:"w-full h-10 px-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all text-sm"}),(0,E.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,E.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,E.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})}),(0,E.jsxs)("div",{className:"relative",children:[(0,E.jsxs)("select",{value:I,onChange:e=>F(e.target.value),className:"appearance-none h-10 bg-gray-700 border border-gray-600 rounded-lg text-white px-3 pr-8 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all cursor-pointer hover:bg-gray-650 text-sm",children:[(0,E.jsx)("option",{value:"",children:"All Status"}),(0,E.jsx)("option",{value:"active",children:"Active"}),(0,E.jsx)("option",{value:"inactive",children:"Inactive"}),(0,E.jsx)("option",{value:"pending",children:"Pending"})]}),(0,E.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,E.jsx)("svg",{className:"w-3 h-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,E.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,E.jsxs)("div",{className:"relative",children:[(0,E.jsxs)("select",{value:G,onChange:e=>U(e.target.value),className:"appearance-none h-10 bg-gray-700 border border-gray-600 rounded-lg text-white px-3 pr-8 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all cursor-pointer hover:bg-gray-650 text-sm",children:[(0,E.jsx)("option",{value:"",children:"All Batches"}),(0,E.jsx)("option",{value:"Batch 1",children:"Batch 1"}),(0,E.jsx)("option",{value:"Batch 2",children:"Batch 2"})]}),(0,E.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,E.jsx)("svg",{className:"w-3 h-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,E.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,E.jsxs)("div",{className:"relative",children:[(0,E.jsxs)("select",{value:O,onChange:e=>R(e.target.value?parseInt(e.target.value):""),className:"appearance-none h-10 bg-gray-700 border border-gray-600 rounded-lg text-white px-3 pr-8 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all cursor-pointer hover:bg-gray-650 text-sm",children:[(0,E.jsx)("option",{value:"",children:"All Payments"}),(0,E.jsx)("option",{value:"1",children:"Paid - Month 1"}),(0,E.jsx)("option",{value:"2",children:"Paid - Month 2"}),(0,E.jsx)("option",{value:"3",children:"Paid - Month 3"}),(0,E.jsx)("option",{value:"4",children:"Paid - Month 4"}),(0,E.jsx)("option",{value:"5",children:"Paid - Month 5"}),(0,E.jsx)("option",{value:"6",children:"Paid - Month 6"}),(0,E.jsx)("option",{value:"7",children:"Paid - Month 7"}),(0,E.jsx)("option",{value:"8",children:"Paid - Month 8"}),(0,E.jsx)("option",{value:"9",children:"Paid - Month 9"}),(0,E.jsx)("option",{value:"10",children:"Paid - Month 10"}),(0,E.jsx)("option",{value:"11",children:"Paid - Month 11"}),(0,E.jsx)("option",{value:"12",children:"Paid - Month 12"}),(0,E.jsx)("option",{value:"13",children:"Paid - Month 13"}),(0,E.jsx)("option",{value:"14",children:"Paid - Month 14"}),(0,E.jsx)("option",{value:"15",children:"Paid - Month 15"}),(0,E.jsx)("option",{value:"16",children:"Paid - Month 16"}),(0,E.jsx)("option",{value:"17",children:"Paid - Month 17"}),(0,E.jsx)("option",{value:"18",children:"Paid - Month 18"}),(0,E.jsx)("option",{value:"19",children:"Paid - Month 19"}),(0,E.jsx)("option",{value:"20",children:"Paid - Month 20"})]}),(0,E.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,E.jsx)("svg",{className:"w-3 h-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,E.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,E.jsxs)("div",{className:"flex items-center gap-1 h-10 px-3 bg-gray-700/30 rounded-lg border border-gray-600/50",children:[(0,E.jsx)("button",{onClick:()=>J("created_at"),className:"px-2 py-2 text-sm rounded-md transition-all font-medium whitespace-nowrap ".concat("created_at"===K?"bg-orange-500 text-white shadow-md":"text-gray-300 bg-gray-700/50 hover:bg-gray-600/50 hover:text-white"),title:"Sort by Newest",children:"Newest"}),(0,E.jsx)("button",{onClick:()=>J("customer_id"),className:"px-2 py-2 text-sm rounded-md transition-all font-medium whitespace-nowrap ".concat("customer_id"===K?"bg-orange-500 text-white shadow-md":"text-gray-300 bg-gray-700/50 hover:bg-gray-600/50 hover:text-white"),title:"Sort by Customer ID",children:"By ID"})]}),M.length>0&&(0,E.jsxs)("div",{className:"flex items-center gap-2 h-10 px-3 bg-gray-700/30 rounded-lg border border-gray-600/50",children:[(0,E.jsx)("div",{className:"w-2 h-2 bg-amber-400 rounded-full animate-pulse"}),(0,E.jsx)("span",{className:"text-gray-300 text-sm font-medium",children:D||I||G||O||ue>=1e3?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("span",{className:"text-amber-300 font-bold",children:M.length})," customers"]}):(0,E.jsxs)(E.Fragment,{children:["Showing ",(0,E.jsx)("span",{className:"text-amber-300 font-bold",children:(me-1)*ue+1})," to ",(0,E.jsx)("span",{className:"text-amber-300 font-bold",children:Math.min(me*ue,M.length)})," of ",(0,E.jsx)("span",{className:"text-amber-300 font-bold",children:M.length})," customers"]})})]})]})}),(0,E.jsxs)(d.Xg,{className:"overflow-hidden","data-animate":!0,children:[ne?(0,E.jsx)(N.cU,{rows:8,columns:6}):(0,E.jsx)("div",{className:"overflow-x-auto",children:(0,E.jsxs)("table",{className:"w-full",children:[(0,E.jsx)("thead",{className:"bg-gray-700",children:(0,E.jsxs)("tr",{children:[(0,E.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Customer Details"}),(0,E.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Contact Details"}),(0,E.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Batch & Saving Plan"}),(0,E.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Assigned Promoter"}),(0,E.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Status"}),(0,E.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,E.jsx)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:0===M.length?(0,E.jsx)("tr",{children:(0,E.jsx)("td",{colSpan:"6",className:"px-6 py-12 text-center text-gray-400",children:"No customers found"})}):M.map(e=>{const s=null===e||void 0===e?void 0:e.id,a=(null===e||void 0===e?void 0:e.name)||"Unknown",n=null===e||void 0===e?void 0:e.email,r=(null===e||void 0===e?void 0:e.phone)||(null===e||void 0===e?void 0:e.mobile),l=n&&""!==String(n).trim()?String(n):null,c=null!==r&&void 0!==r&&""!==String(r).trim()?String(r):null,i=(null===e||void 0===e?void 0:e.customer_id)||"N/A",d=(null===e||void 0===e?void 0:e.status)||"active",h=(e=>{const t=null===e||void 0===e?void 0:e.parent_promoter_id;if(!t)return"Unassigned";const o=(_||[]).find(e=>(null===e||void 0===e?void 0:e.id)===t);return(null===o||void 0===o?void 0:o.name)||"Unknown Promoter"})(e),u=(e=>{const t=null===e||void 0===e?void 0:e.parent_promoter_id;if(!t)return"";const o=(_||[]).find(e=>(null===e||void 0===e?void 0:e.id)===t);return(null===o||void 0===o?void 0:o.promoter_id)||""})(e);return(0,E.jsxs)("tr",{className:"hover:bg-gray-700",children:[(0,E.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,E.jsxs)("div",{className:"flex items-center",children:[(0,E.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-green-400 to-blue-500 rounded-full flex items-center justify-center mr-3",children:(0,E.jsx)(j.A,{className:"w-4 h-4 text-white"})}),(0,E.jsxs)("div",{className:"flex flex-col",children:[(0,E.jsx)("span",{className:"text-white font-medium",children:a}),(0,E.jsx)("span",{className:"text-xs text-gray-400",children:i})]})]})}),(0,E.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,E.jsxs)("div",{className:"space-y-1",children:[(0,E.jsxs)("div",{className:"flex items-center",children:[(0,E.jsx)(y.A,{className:"w-3 h-3 mr-2 text-gray-400"}),l||"no gmail"]}),(0,E.jsxs)("div",{className:"flex items-center",children:[(0,E.jsx)(b.A,{className:"w-3 h-3 mr-2 text-gray-400"}),c||"no phone"]})]})}),(0,E.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,E.jsxs)("div",{className:"flex flex-col space-y-1.5",children:[(null===e||void 0===e?void 0:e.batch)&&(0,E.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border w-fit ".concat("Batch 1"===e.batch?"bg-emerald-500/10 text-emerald-400 border-emerald-500/20":"bg-purple-500/10 text-purple-400 border-purple-500/20"),children:[(0,E.jsx)("div",{className:"w-1 h-1 rounded-full mr-1.5 ".concat("Batch 1"===e.batch?"bg-emerald-400":"bg-purple-400")}),e.batch]}),(0,E.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-500/10 text-blue-400 border border-blue-500/20 w-fit",children:[(0,E.jsx)("div",{className:"w-1 h-1 rounded-full mr-1.5 bg-blue-400"}),(null===e||void 0===e?void 0:e.saving_plan)||"\u20b91000 \xd7 20 Months"]})]})}),(0,E.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,E.jsx)("div",{className:"flex items-center",children:"Admin"===h||"System"===h?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("span",{className:"text-yellow-400 mr-2",children:"\ud83d\udc51"}),(0,E.jsx)("span",{className:"text-white font-medium",children:h})]}):"Unassigned"!==h?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(j.A,{className:"w-4 h-4 mr-2 text-blue-400"}),(0,E.jsxs)("div",{className:"flex flex-col",children:[(0,E.jsx)("span",{className:"text-white font-medium",children:h}),(0,E.jsx)("span",{className:"text-xs text-gray-400",children:u})]})]}):(0,E.jsx)("span",{className:"text-gray-500",children:"-"})})}),(0,E.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,E.jsxs)("button",{onClick:()=>(async e=>{try{const o="active"===(e.status||"active")?"inactive":"active",{error:s}=await m.ND.from("profiles").update({status:o}).eq("id",e.id);if(s)throw s;t("Customer status updated successfully.\n\n".concat(e.name," is now ").concat(o,".")),await ge()}catch(s){o("Failed to update customer status. Please try again.")}})(e),className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium capitalize border transition-all hover:opacity-80 ".concat("active"===(d||"active").toLowerCase()?"bg-green-500/10 text-green-400 border-green-500/20":"inactive"===d.toLowerCase()?"bg-red-500/10 text-red-400 border-red-500/20":"bg-yellow-500/10 text-yellow-400 border-yellow-500/20"),title:"Click to change status (currently: ".concat(d,")"),children:[(0,E.jsx)("div",{className:"w-1.5 h-1.5 rounded-full mr-2 ".concat("active"===(d||"active").toLowerCase()?"bg-green-400":"inactive"===d.toLowerCase()?"bg-red-400":"bg-yellow-400")}),d]})}),(0,E.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,E.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,E.jsx)("button",{onClick:()=>(e=>{oe(e),q(!0)})(e),className:"text-blue-400 hover:text-blue-300 transition-colors",title:"Edit customer",children:(0,E.jsx)(v.A,{className:"w-4 h-4"})}),(0,E.jsx)("button",{onClick:()=>(e=>{ae(e),ee(!0)})(e),className:"text-red-400 hover:text-red-300 transition-colors",title:"Delete customer",children:(0,E.jsx)(w.A,{className:"w-4 h-4"})}),(0,E.jsx)("button",{onClick:()=>(e=>{de(e),ce(!0)})(e),className:"text-green-400 hover:text-green-300 transition-colors",title:"Manage payments",children:(0,E.jsx)(g.A,{className:"w-4 h-4"})})]})})]},s)})})]})}),M.length>0&&(0,E.jsx)("div",{className:"px-6 py-4 border-t border-gray-700/50 bg-gray-800/30",children:(0,E.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[(0,E.jsxs)("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-gray-700/50 rounded-lg border border-gray-600/50",children:[(0,E.jsx)("div",{className:"w-2 h-2 bg-amber-400 rounded-full animate-pulse"}),(0,E.jsx)("span",{className:"text-gray-300 text-sm font-medium",children:D||I||G||O||ue>=1e3?(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("span",{className:"text-amber-400 font-bold",children:M.length})," customers"]}):(0,E.jsxs)(E.Fragment,{children:["Showing ",(0,E.jsx)("span",{className:"text-amber-400 font-bold",children:(me-1)*ue+1})," to ",(0,E.jsx)("span",{className:"text-amber-400 font-bold",children:Math.min(me*ue,M.length)})," of ",(0,E.jsx)("span",{className:"text-amber-400 font-bold",children:M.length})," customers"]})})]}),ue<1e3&&!(D||I||G||O)&&(0,E.jsxs)("div",{className:"flex items-center gap-4",children:[(0,E.jsx)("button",{onClick:()=>{console.log("=== MANUAL DEBUG TRIGGERED ==="),pe()},className:"px-3 py-1.5 bg-amber-600 hover:bg-amber-700 text-white text-xs font-medium rounded-lg border border-amber-500 transition-colors",children:"Debug Payments"}),(0,E.jsxs)("button",{onClick:()=>he(e=>Math.max(e-1,1)),disabled:1===me,className:"group relative p-2.5 rounded-lg transition-all duration-200 ".concat(1===me?"bg-gray-700/50 text-gray-500 cursor-not-allowed border border-gray-600/30":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white border border-gray-600/50 hover:border-gray-500 hover:shadow-lg hover:shadow-amber-400/10"),title:"Previous Page",children:[(0,E.jsx)(u.A,{className:"w-4 h-4"}),(0,E.jsx)("span",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:"Previous"})]}),(0,E.jsx)("div",{className:"flex items-center gap-1 px-2 py-1 bg-gray-700/30 rounded-lg border border-gray-600/30",children:Array.from({length:Math.min(5,Math.ceil(M.length/ue))},(e,t)=>{const o=Math.ceil(M.length/ue);let s;return s=o<=5||me<=3?t+1:me>=o-2?o-4+t:me-2+t,(0,E.jsx)("button",{onClick:()=>he(s),className:"w-8 h-8 rounded-md text-sm font-medium transition-all duration-200 ".concat(me===s?"bg-gradient-to-r from-amber-500 to-amber-600 text-white shadow-lg shadow-amber-400/20 border border-amber-400/50":"bg-gray-600/50 text-gray-300 hover:bg-gray-600 hover:text-white border border-gray-500/30 hover:border-gray-400/50"),title:"Go to page ".concat(s),children:s},s)})}),(0,E.jsxs)("button",{onClick:()=>he(e=>Math.min(e+1,Math.ceil(M.length/ue))),disabled:me===Math.ceil(M.length/ue),className:"group relative p-2.5 rounded-lg transition-all duration-200 ".concat(me===Math.ceil(M.length/ue)?"bg-gray-700/50 text-gray-500 cursor-not-allowed border border-gray-600/30":"bg-gray-700 text-gray-300 hover:bg-gray-600 hover:text-white border border-gray-600/50 hover:border-gray-500 hover:shadow-lg hover:shadow-amber-400/10"),title:"Next Page",children:[(0,E.jsx)(x.A,{className:"w-4 h-4"}),(0,E.jsx)("span",{className:"absolute -bottom-8 left-1/2 transform -translate-x-1/2 text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap",children:"Next"})]})]})]})})]})]})}),(0,E.jsx)(c.A,{isOpen:H,onClose:ye,onSubmit:async e=>{try{if(te){var s;const o=null===(s=e.email)||void 0===s?void 0:s.trim(),{error:a}=await m.ND.from("profiles").update({name:e.name,saving_plan:e.savingPlan||"\u20b91000 per month for 20 months",phone:e.mobile,mobile:e.mobile,email:o&&""!==o?o:null,state:e.state,city:e.city,pincode:e.pincode,address:e.address,updated_at:(new Date).toISOString()}).eq("id",te.id);if(a)throw a;t("Customer updated successfully.\n\n".concat(e.name,"'s information has been saved.")),await ge(),ye()}else{const o=await h.A.createCustomer(e,e.parentPromoter);if(!o.success)throw new Error(o.error||o.message||"Failed to create customer");t(o.message||"Customer created successfully and is ready to use.\n\nCard No: ".concat(e.cardNo,"\nName: ").concat(e.name,"\nLogin: Use Card No + Password")),await ge(),ye()}}catch(a){o("Failed to ".concat(te?"update":"create"," customer: ").concat(a.message))}},promoters:_||[],isEditing:!!te,initialData:te,currentUserRole:"admin"}),$&&(0,E.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,E.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4",children:[(0,E.jsx)("h3",{className:"text-lg font-semibold text-white mb-4",children:"Confirm Delete"}),(0,E.jsxs)("p",{className:"text-gray-300 mb-6",children:['Are you sure you want to delete customer "',null===se||void 0===se?void 0:se.name,'"? This action cannot be undone.']}),(0,E.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,E.jsx)("button",{onClick:ve,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"Cancel"}),(0,E.jsx)("button",{onClick:async()=>{if(se)try{const{error:e}=await m.ND.from("profiles").delete().eq("id",se.id);if(e)throw e;t("Customer deleted successfully.\n\n".concat(se.name," has been removed from the system.")),await ge(),ve()}catch(e){o("Failed to delete customer. Please try again.")}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete"})]})]})}),(0,E.jsx)(i.A,{isOpen:le,onClose:()=>{ce(!1),de(null)},customerId:null===ie||void 0===ie?void 0:ie.id,customerName:null===ie||void 0===ie?void 0:ie.name,currentUser:e})]})]})}},4847:(e,t,o)=>{o.d(t,{H:()=>s});const s="https://api.brightplanetventures.com/api"},5722:(e,t,o)=>{o.d(t,{A:()=>s});const s=(0,o(3797).A)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])}}]);
//# sourceMappingURL=487.0e1de564.chunk.js.map