"use strict";(self.webpackChunkbrightplanet_ventures=self.webpackChunkbrightplanet_ventures||[]).push([[745],{3395:(e,t,a)=>{a.d(t,{A:()=>r});const r=(0,a(3797).A)("Award",[["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}],["path",{d:"M15.477 12.89 17 22l-5-3-5 3 1.523-9.11",key:"em7aur"}]])},4999:(e,t,a)=>{a.d(t,{A:()=>x});var r=a(9379),s=a(5043),l=(a(3792),a(987)),i=a(917),n=a(5897),o=a(1172),d=a(4009),c=a(579);const m=s.memo(e=>{let{onSubmit:t,onCancel:a,loading:m=!1,editingPromoter:x=null,availableParents:h=[],adminUsers:u=[]}=e;const[p,g]=(0,s.useState)({name:"",email:"",hasEmail:!1,password:"password123",confirmPassword:"password123",mobile:"",address:"",parentPromoter:""}),[v,b]=(0,s.useState)({}),[f,j]=(0,s.useState)(!1),[w,N]=(0,s.useState)(!1),[y,_]=(0,s.useState)({isValidating:!1,isValid:!1,message:""});(0,s.useEffect)(()=>{if(x){const e=x.email||"",t=e&&!e.includes("noemail+")&&!e.includes("@brightplanetventures.local");g({name:x.name||"",email:t?e:"",hasEmail:t,password:"password123",confirmPassword:"password123",mobile:x.mobile||x.phone||"",address:x.address||"",parentPromoter:x.parent_promoter_id||""}),_({isValidating:!1,isValid:!0,message:""}),b({})}},[x]);const A=(0,s.useMemo)(()=>[...(u||[]).map(e=>({id:e.id,label:"\ud83d\udc51 ".concat(e.name," (Admin)"),type:"admin"})),...(h||[]).map(e=>({id:e.id||e._id,label:e.isCurrentUser?"".concat(e.promoter_id||"CURRENT"," - ").concat(e.name," (You)"):"".concat(e.promoter_id||"N/A"," - ").concat(e.name||"Unknown"),type:"promoter"}))],[u,h]),P=(0,s.useCallback)(async(e,t)=>{let a=(0,r.A)({},v);switch(e){case"name":t&&t.trim()?t.trim().length<2?a.name="Name must be at least 2 characters":/^[a-zA-Z\s]+$/.test(t.trim())||(a.name="Name must contain only letters and spaces"):a.name="Name is required";break;case"email":if(p.hasEmail)if(t&&t.trim()){/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.trim())||(a.email="Please enter a valid email address")}else a.email="Email address is required";break;case"password":x||(t?t.length<8?a.password="Password must be at least 8 characters":/(?=.*[a-zA-Z])(?=.*\d)/.test(t)||(a.password="Password must contain both letters and numbers"):a.password="Password is required");break;case"confirmPassword":x||t===p.password||(a.confirmPassword="Passwords do not match");break;case"mobile":if(t){const e=d.A.validateMobileFormat(t);if(e.is_valid)try{const e=await d.A.validateMobileNumber(t,(null===x||void 0===x?void 0:x.id)||null,null,"promoter");e.success&&e.is_valid||(a.mobile=e.error||"Mobile number validation failed")}catch(s){a.mobile="Mobile number validation service unavailable"}else a.mobile=e.error}else a.mobile="Mobile number is required";break;case"parentPromoter":!t&&A.length>0&&(a.parentPromoter="Parent promoter selection is required")}return b(a),a},[p,v,x]),C=(0,s.useCallback)((e,t)=>{g(a=>(0,r.A)((0,r.A)({},a),{},{[e]:t}));const a=P(e,t);b(e=>(0,r.A)((0,r.A)({},e),a)),!a[e]&&v[e]&&b(t=>{const a=(0,r.A)({},t);return delete a[e],a})},[P,v]),k=(0,s.useCallback)(async e=>{if(!e)return b(e=>(0,r.A)((0,r.A)({},e),{},{mobile:"Mobile number is required"})),void _({isValidating:!1,isValid:!1,message:""});if(x)return _({isValidating:!1,isValid:!0,message:""}),void b(e=>{const t=(0,r.A)({},e);return delete t.mobile,t});const t=d.A.validateMobileFormat(e);if(!t.is_valid)return b(e=>(0,r.A)((0,r.A)({},e),{},{mobile:t.error})),void _({isValidating:!1,isValid:!1,message:""});_({isValidating:!0,isValid:!1,message:"Validating mobile number..."}),b(e=>{const t=(0,r.A)({},e);return delete t.mobile,t});try{const t=await d.A.validateMobileNumber(e,(null===x||void 0===x?void 0:x.id)||null,null,"promoter");if(t.success&&t.is_valid)b(e=>{const t=(0,r.A)({},e);return delete t.mobile,t}),_({isValidating:!1,isValid:!0,message:""});else{const e=t.error||"Mobile number validation failed";b(t=>(0,r.A)((0,r.A)({},t),{},{mobile:e})),_({isValidating:!1,isValid:!1,message:e})}}catch(a){const e="Mobile number validation service unavailable";b(t=>(0,r.A)((0,r.A)({},t),{},{mobile:e})),_({isValidating:!1,isValid:!1,message:e})}},[x]),S=((0,s.useCallback)(e=>{const t=setTimeout(()=>{k(e)},500);return()=>clearTimeout(t)},[k]),(0,s.useCallback)(()=>{const e={};return Object.keys(p).forEach(t=>{const a=P(t,p[t]);Object.assign(e,a)}),b(e),0===Object.keys(e).length},[p,P,x])),D=(0,s.useCallback)(async e=>{if(e.preventDefault(),!S())return;const a={name:p.name,email:p.hasEmail&&p.email?p.email:null,password:p.password,mobile:p.mobile,address:p.address||null,parentPromoter:p.parentPromoter||null,useNewSystem:!0};await t(a)},[p,S,t]);return(0,c.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-700 pb-4 mb-6",children:[(0,c.jsxs)("div",{children:[(0,c.jsx)("h3",{className:"text-xl font-semibold text-white",children:x?"Edit Promoter":"Create New Promoter"}),x&&(0,c.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Update promoter information and hierarchy"})]}),(0,c.jsx)("button",{type:"button",onClick:a,className:"text-gray-400 hover:text-white transition-colors",disabled:m,children:(0,c.jsx)(o.A,{className:"w-5 h-5"})})]}),(0,c.jsxs)("form",{onSubmit:D,className:"space-y-5",children:[(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Full Name",(0,c.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,c.jsx)("input",{type:"text",value:p.name,onChange:e=>C("name",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(v.name?"border-red-500":"border-gray-600"),placeholder:"Enter full name (letters and spaces only)"}),v.name&&(0,c.jsx)("p",{className:"text-red-400 text-sm mt-1",children:v.name})]}),(0,c.jsxs)("div",{className:"mb-4",children:[(0,c.jsxs)("div",{className:"flex items-center mb-2",children:[(0,c.jsx)("input",{type:"checkbox",id:"hasEmail",checked:p.hasEmail,onChange:e=>{const t=e.target.checked;g(e=>(0,r.A)((0,r.A)({},e),{},{hasEmail:t,email:t?e.email:""})),t||b(e=>{const t=(0,r.A)({},e);return delete t.email,t})},className:"mr-2 h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-600 rounded bg-gray-700"}),(0,c.jsx)("label",{htmlFor:"hasEmail",className:"text-sm font-medium text-gray-300",children:"Add Email Address"})]}),p.hasEmail&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("input",{type:"email",value:p.email,onChange:e=>C("email",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(v.email?"border-red-500":"border-gray-600"),placeholder:"Enter email address (can be shared with others)"}),v.email&&(0,c.jsx)("p",{className:"text-red-400 text-sm mt-1",children:v.email})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Mobile Number",(0,c.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,c.jsx)("p",{className:"text-xs text-gray-400 mb-2",children:"Mobile number is mandatory and must be unique. SMS will be sent to this number."}),(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)("input",{type:"tel",value:p.mobile,onChange:e=>{const t=e.target.value.replace(/\D/g,"").slice(0,10);if(g(e=>(0,r.A)((0,r.A)({},e),{},{mobile:t})),_({isValidating:!1,isValid:!1,message:""}),b(e=>{const t=(0,r.A)({},e);return delete t.mobile,t}),10===t.length){const e=setTimeout(()=>{k(t)},500);return()=>clearTimeout(e)}},className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 pr-12 ".concat(v.mobile?"border-red-500":y.isValid?"border-green-500":y.isValidating?"border-blue-500":"border-gray-600"),placeholder:"Enter 10-digit mobile number",maxLength:10}),(0,c.jsxs)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:[y.isValidating&&(0,c.jsx)(n.A,{className:"w-5 h-5 text-blue-400 animate-spin"}),y.isValid&&(0,c.jsx)(i.A,{className:"w-5 h-5 text-green-400"}),v.mobile&&(0,c.jsx)(l.A,{className:"w-5 h-5 text-red-400"})]})]}),v.mobile&&(0,c.jsx)("div",{className:"mt-2 p-2 bg-red-900 border border-red-700 rounded-lg",children:(0,c.jsxs)("p",{className:"text-red-400 text-sm flex items-center",children:[(0,c.jsx)(l.A,{className:"w-4 h-4 mr-2"}),v.mobile]})}),y.isValidating&&(0,c.jsx)("div",{className:"mt-2 p-2 bg-blue-900 border border-blue-700 rounded-lg",children:(0,c.jsxs)("p",{className:"text-blue-400 text-sm flex items-center",children:[(0,c.jsx)(n.A,{className:"w-4 h-4 mr-2 animate-spin"}),y.message]})})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Address",(0,c.jsx)("span",{className:"text-gray-500 text-xs ml-2",children:"(Optional)"})]}),(0,c.jsx)("textarea",{value:p.address,onChange:e=>C("address",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Enter full postal address (optional)",rows:3})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Parent Promoter",(0,c.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,c.jsx)("p",{className:"text-xs text-gray-400 mb-2",children:"Parent promoter is mandatory for hierarchy management."}),(0,c.jsxs)("select",{value:p.parentPromoter,onChange:e=>C("parentPromoter",e.target.value),disabled:1===A.length||x,className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(v.parentPromoter?"border-red-500":"border-gray-600"," ").concat(1===A.length||x?"opacity-75 cursor-not-allowed":""),children:[(0,c.jsx)("option",{value:"",disabled:!0,children:"Select parent promoter *"}),A.map(e=>(0,c.jsx)("option",{value:e.id,children:e.label},e.id))]}),v.parentPromoter&&(0,c.jsx)("p",{className:"text-red-400 text-sm mt-1",children:v.parentPromoter})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-700",children:[(0,c.jsx)("button",{type:"button",onClick:a,className:"px-6 py-3 text-gray-300 hover:text-white transition-colors",disabled:m,children:"Cancel"}),(0,c.jsx)("button",{type:"submit",disabled:m||Object.keys(v).length>0||!x&&(!p.mobile||10!==p.mobile.length||!p.parentPromoter||y.isValidating||10===p.mobile.length&&!y.isValid),className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:m?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.A,{className:"w-4 h-4 animate-spin"}),(0,c.jsx)("span",{children:x?"Updating...":"Creating..."})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.A,{className:"w-4 h-4"}),(0,c.jsx)("span",{children:x?"Update Promoter":"Create Promoter"})]})})]})]})]})});m.displayName="UnifiedPromoterForm";const x=m},8745:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_});var r=a(9379),s=a(5043),l=a(7950),i=a(6621),n=a(3216),o=a(3792),d=a(4999),c=a(3959),m=a(4823),x=(a(2631),a(987)),h=a(3395),u=a(917),p=a(7008),g=a(7772),v=a(9589),b=a(5680),f=a(8112),j=a(1172),w=a(45),N=a(579);const y=e=>{let{stage:t}=e;const a=(()=>{switch(t){case"promoters":return{icon:(0,N.jsx)(f.A,{className:"w-8 h-8 text-blue-400 animate-pulse"}),title:"Loading Promoters...",description:"Fetching promoter data from database"};case"hierarchy":return{icon:(0,N.jsx)(h.A,{className:"w-8 h-8 text-green-400 animate-pulse"}),title:"Building Hierarchy...",description:"Analyzing promoter network structure"};case"complete":return{icon:(0,N.jsx)(u.A,{className:"w-8 h-8 text-orange-400 animate-bounce"}),title:"Almost Done...",description:"Finalizing data loading"};case"error":return{icon:(0,N.jsx)(x.A,{className:"w-8 h-8 text-red-400"}),title:"Error Loading Data",description:"Please refresh the page and try again"};default:return{icon:(0,N.jsx)(g.A,{className:"w-8 h-8 text-orange-400 animate-spin"}),title:"Initializing...",description:"Preparing to load your data"}}})();return(0,N.jsxs)("div",{className:"flex flex-col items-center justify-center p-12 space-y-4",children:[(0,N.jsxs)("div",{className:"relative",children:[a.icon,(0,N.jsx)("div",{className:"absolute inset-0 rounded-full bg-blue-400/20 animate-ping"})]}),(0,N.jsxs)("div",{className:"text-center",children:[(0,N.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:a.title}),(0,N.jsx)("p",{className:"text-sm text-slate-400",children:a.description}),(0,N.jsxs)("div",{className:"flex items-center justify-center space-x-2 mt-4",children:[(0,N.jsx)("div",{className:"w-2 h-2 rounded-full transition-colors duration-300 ".concat("promoters"===t||"hierarchy"===t||"complete"===t?"bg-blue-400":"bg-slate-600")}),(0,N.jsx)("div",{className:"w-2 h-2 rounded-full transition-colors duration-300 ".concat("hierarchy"===t||"complete"===t?"bg-blue-400":"bg-slate-600")}),(0,N.jsx)("div",{className:"w-2 h-2 rounded-full transition-colors duration-300 ".concat("complete"===t?"bg-blue-400":"bg-slate-600")})]})]})]})};const _=function(){const{user:e}=(0,i.As)(),{showSuccess:t,showError:a}=((0,n.Zp)(),(0,m.L5)()),[x,u]=(0,s.useState)(!0),[g,_]=(0,s.useState)("initial"),[A,P]=(0,s.useState)([]),[C,k]=(0,s.useState)([]),[S,D]=(0,s.useState)(null),[E,V]=(0,s.useState)(""),[L,M]=(0,s.useState)("all"),[F,q]=(0,s.useState)("created_at"),[U,T]=(0,s.useState)(!1),z=(0,s.useRef)(null),[B,I]=(0,s.useState)({top:0,right:0}),[O,R]=(0,s.useState)(1),[X,W]=(0,s.useState)(10),[Y,H]=(0,s.useState)(null),[J,Z]=(0,s.useState)(!1),[$,Q]=(0,s.useState)(!1),[G,K]=(0,s.useState)(!1),[ee,te]=(0,s.useState)({total:0,level1:0,level2Plus:0,maxDepth:0});(0,c.r9)(),(0,s.useEffect)(()=>{ae()},[e]);const ae=async()=>{if(null!==e&&void 0!==e&&e.promoter_id)try{u(!0),_("promoters"),D("");const{data:t,error:a}=await o.ND.rpc("get_promoter_downline_tree",{p_promoter_code:e.promoter_id});if(a){_("hierarchy");const{data:t,error:a}=await o.ND.from("profiles").select("\n            id,\n            name,\n            email,\n            phone,\n            mobile,\n            promoter_id,\n            role_level,\n            status,\n            parent_promoter_id,\n            pins,\n            created_at,\n            updated_at,\n            parent_promoter:parent_promoter_id(\n              id,\n              name,\n              promoter_id,\n              role\n            )\n          ").eq("role","promoter").eq("parent_promoter_id",e.id).order("created_at",{ascending:!1});return a?void D("Failed to load promoters: ".concat(a.message||"Unknown error")):re(t||[])}if(_("hierarchy"),null!==t&&void 0!==t&&t.success&&null!==t&&void 0!==t&&t.downline_tree){const a=t.downline_tree,r=(a.map(e=>null).filter(Boolean),a.map(e=>e.code).filter(Boolean));let s={};if(r.length>0){const{data:e}=await o.ND.from("profiles").select("promoter_id, mobile, phone").in("promoter_id",r);e&&e.forEach(e=>{s[e.promoter_id]=e})}const l=a.map(t=>{var r;const l=s[t.code]||{};let i=null;if(t.path&&t.path.length>1){const r=t.path[t.path.length-2];if(r!==e.promoter_id){const e=a.find(e=>e.code===r);e&&(i={id:e.id||r,name:e.name,promoter_id:e.code,role:"promoter"})}else i={id:e.id,name:e.name,promoter_id:e.promoter_id,role:"promoter"}}else i={id:e.id,name:e.name,promoter_id:e.promoter_id,role:"promoter"};return{id:t.id||t.code,name:t.name,email:t.email,phone:l.phone||t.phone,mobile:l.mobile||t.mobile,promoter_id:t.code,role_level:t.role_level,status:t.status,parent_promoter_id:null===(r=i)||void 0===r?void 0:r.id,pins:0,created_at:t.created_at,updated_at:t.created_at,parent_promoter:i,hierarchy_level:t.level,hierarchy_path:t.path}});return re(l)}P([]),k([]),u(!1),_("complete")}catch(t){D("Failed to load promoters: "+t.message),_("error")}finally{u(!1)}},re=e=>{if(!e)return P([]),k([]),te({total:0,level1:0,level2Plus:0,maxDepth:0}),void u(!1);const t=(e||[]).map((e,t)=>({id:(null===e||void 0===e?void 0:e.id)||t+1,promoter_id:(null===e||void 0===e?void 0:e.promoter_id)||"BPVP".concat(String(t+1).padStart(2,"0")),name:(null===e||void 0===e?void 0:e.name)||"Unknown Promoter",email:(null===e||void 0===e?void 0:e.email)||"No email",phone:(null===e||void 0===e?void 0:e.phone)||(null===e||void 0===e?void 0:e.mobile)||"No phone",mobile:null===e||void 0===e?void 0:e.mobile,joinDate:null!==e&&void 0!==e&&e.created_at?new Date(e.created_at).toISOString().split("T")[0]:"2024-01-01",affiliate_level:"Affiliate"===(null===e||void 0===e?void 0:e.role_level)?1:2,can_create_promoters:!0,can_create_customers:!0,commission_rate:.05,status:(null===e||void 0===e?void 0:e.status)||"Active",pins:(null===e||void 0===e?void 0:e.pins)||0,parent_promoter:(null===e||void 0===e?void 0:e.parent_promoter)||null,level:(null===e||void 0===e?void 0:e.level)||1,hierarchy_level:(null===e||void 0===e?void 0:e.hierarchy_level)||1,hierarchy_path:(null===e||void 0===e?void 0:e.hierarchy_path)||[],originalData:e})),a={total:t.length,level1:t.filter(e=>1===e.hierarchy_level).length,level2Plus:t.filter(e=>e.hierarchy_level>=2).length,maxDepth:t.length>0?Math.max(...t.map(e=>e.hierarchy_level||1)):0};P(t),k(t),te(a),u(!1)};(0,s.useEffect)(()=>{let e=A||[];E&&(e=e.filter(e=>{const t=((null===e||void 0===e?void 0:e.name)||"").toLowerCase(),a=((null===e||void 0===e?void 0:e.email)||"").toLowerCase(),r=((null===e||void 0===e?void 0:e.promoter_id)||"").toLowerCase(),s=((null===e||void 0===e?void 0:e.phone)||"").toLowerCase(),l=(((null===e||void 0===e?void 0:e.mobile)||"").toLowerCase(),(E||"").toLowerCase());return t.includes(l)||a.includes(l)||r.includes(l)||s.includes(l)})),L&&"all"!==L&&(e=e.filter(e=>((null===e||void 0===e?void 0:e.status)||"active").toLowerCase()===L.toLowerCase())),e="promoter_id"===F?[...e].sort((e,t)=>{const a=(e.promoter_id||"").toLowerCase(),r=(t.promoter_id||"").toLowerCase();return a.localeCompare(r)}):[...e].sort((e,t)=>{const a=new Date(e.created_at||e.joinDate||0);return new Date(t.created_at||t.joinDate||0).getTime()-a.getTime()}),k(e),R(1)},[A,E,L,F]);const se=()=>{Q(!1)};return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(c.wE,{}),(0,N.jsx)(c.dQ,{children:(0,N.jsx)("div",{className:"min-h-screen pt-40 px-8 pb-8",children:(0,N.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,N.jsx)("div",{className:"flex justify-between items-center mb-8","data-animate":!0,children:(0,N.jsxs)("div",{children:[(0,N.jsx)("h1",{className:"text-2xl font-bold text-white mb-2",children:"My Promoters"}),(0,N.jsx)("p",{className:"text-gray-400",children:"Manage and track your promoter network"}),S&&(0,N.jsxs)("p",{className:"text-red-400 text-sm mt-2",children:["\u26a0\ufe0f ",S]})]})}),(0,N.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8","data-animate":!0,children:[(0,N.jsx)(c.Xg,{className:"p-6",children:(0,N.jsxs)("div",{className:"flex items-center justify-between",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:"Total Downline"}),(0,N.jsx)("p",{className:"text-3xl font-bold text-white",children:ee.total})]}),(0,N.jsx)("div",{className:"w-12 h-12 bg-blue-500/20 rounded-lg flex items-center justify-center",children:(0,N.jsx)(f.A,{className:"w-6 h-6 text-blue-400"})})]})}),(0,N.jsx)(c.Xg,{className:"p-6",children:(0,N.jsxs)("div",{className:"flex items-center justify-between",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:"Level 1 (Direct)"}),(0,N.jsx)("p",{className:"text-3xl font-bold text-white",children:ee.level1||0})]}),(0,N.jsx)("div",{className:"w-12 h-12 bg-green-500/20 rounded-lg flex items-center justify-center",children:(0,N.jsx)(h.A,{className:"w-6 h-6 text-green-400"})})]})}),(0,N.jsx)(c.Xg,{className:"p-6",children:(0,N.jsxs)("div",{className:"flex items-center justify-between",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:"Level 2+"}),(0,N.jsx)("p",{className:"text-3xl font-bold text-white",children:ee.level2Plus||0})]}),(0,N.jsx)("div",{className:"w-12 h-12 bg-purple-500/20 rounded-lg flex items-center justify-center",children:(0,N.jsx)(h.A,{className:"w-6 h-6 text-purple-400"})})]})}),(0,N.jsx)(c.Xg,{className:"p-6",children:(0,N.jsxs)("div",{className:"flex items-center justify-between",children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("p",{className:"text-sm text-gray-400 mb-1",children:"Max Depth"}),(0,N.jsx)("p",{className:"text-3xl font-bold text-white",children:ee.maxDepth||0})]}),(0,N.jsx)("div",{className:"w-12 h-12 bg-orange-500/20 rounded-lg flex items-center justify-center",children:(0,N.jsx)(h.A,{className:"w-6 h-6 text-orange-400"})})]})})]}),(0,N.jsx)(c.Xg,{className:"mb-6","data-animate":!0,style:{overflow:"visible"},children:(0,N.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,N.jsx)("div",{className:"flex-1 min-w-[300px]",children:(0,N.jsxs)("div",{className:"relative",children:[(0,N.jsx)("input",{type:"text",placeholder:"Search by name, email, promoter ID, or phone...",value:E,onChange:e=>V(e.target.value),className:"w-full h-10 px-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all text-sm"}),(0,N.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,N.jsx)("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,N.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]})}),(0,N.jsxs)("div",{className:"relative",children:[(0,N.jsxs)("select",{value:L,onChange:e=>M(e.target.value),className:"appearance-none h-10 bg-gray-700 border border-gray-600 rounded-lg text-white px-3 pr-8 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 transition-all cursor-pointer hover:bg-gray-650 text-sm",children:[(0,N.jsx)("option",{value:"all",children:"All Status"}),(0,N.jsx)("option",{value:"active",children:"Active"}),(0,N.jsx)("option",{value:"inactive",children:"Inactive"})]}),(0,N.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none",children:(0,N.jsx)("svg",{className:"w-3 h-3 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,N.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),(0,N.jsxs)("div",{className:"flex items-center gap-1 h-10 px-3 bg-gray-700/30 rounded-lg border border-gray-600/50",children:[(0,N.jsx)("button",{onClick:()=>q("created_at"),className:"px-2 py-2 text-sm rounded-md transition-all font-medium whitespace-nowrap ".concat("created_at"===F?"bg-orange-500 text-white shadow-md":"text-gray-300 bg-gray-700/50 hover:bg-gray-600/50 hover:text-white"),title:"Sort by Newest",children:"Newest"}),(0,N.jsx)("button",{onClick:()=>q("promoter_id"),className:"px-2 py-2 text-sm rounded-md transition-all font-medium whitespace-nowrap ".concat("promoter_id"===F?"bg-orange-500 text-white shadow-md":"text-gray-300 bg-gray-700/50 hover:bg-gray-600/50 hover:text-white"),title:"Sort by ID",children:"By ID"})]}),(0,N.jsxs)("div",{className:"flex items-center gap-2 h-10 px-3 bg-gray-700/30 rounded-lg border border-gray-600/50",children:[(0,N.jsx)("span",{className:"text-gray-300 text-xs font-medium whitespace-nowrap",children:"Show"}),(0,N.jsx)("div",{className:"relative",children:(0,N.jsx)("input",{type:"number",min:"1",max:"100",value:X,onChange:e=>{const t=Math.min(100,Math.max(1,parseInt(e.target.value)||10));W(t),R(1)},className:"w-12 h-6 bg-gray-600 border border-gray-500 rounded text-white text-xs pl-2 pr-1 py-1 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 hover:bg-gray-500 transition-all text-center",placeholder:"10"})}),(0,N.jsx)("span",{className:"text-gray-300 text-xs font-medium whitespace-nowrap",children:"per page"})]}),C.length>0&&(0,N.jsxs)("div",{className:"flex items-center gap-2 h-10 px-3 bg-gray-700/30 rounded-lg border border-gray-600/50",children:[(0,N.jsx)("div",{className:"w-2 h-2 bg-orange-400 rounded-full animate-pulse"}),(0,N.jsxs)("span",{className:"text-gray-300 text-sm font-medium",children:["Showing ",(0,N.jsx)("span",{className:"text-orange-300 font-bold",children:(O-1)*X+1})," to ",(0,N.jsx)("span",{className:"text-orange-300 font-bold",children:Math.min(O*X,C.length)})," of ",(0,N.jsx)("span",{className:"text-orange-300 font-bold",children:C.length})," promoters"]})]}),(0,N.jsxs)("div",{className:"relative",ref:z,children:[(0,N.jsxs)(c.Rq,{onClick:()=>{if(z.current){const e=z.current.getBoundingClientRect();I({top:e.bottom+8,right:window.innerWidth-e.right})}T(!U)},className:"flex items-center space-x-2 px-3 py-2 text-sm bg-blue-600 hover:bg-blue-500 border border-blue-500",children:[(0,N.jsx)(p.A,{className:"w-4 h-4"}),(0,N.jsx)("span",{children:"Export"})]}),U&&(0,l.createPortal)((0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("div",{className:"fixed inset-0 z-[9998]",onClick:()=>T(!1)}),(0,N.jsxs)("div",{className:"fixed w-48 bg-gray-800 border-2 border-gray-600 rounded-lg shadow-2xl z-[9999]",style:{top:"".concat(B.top,"px"),right:"".concat(B.right,"px"),minWidth:"12rem"},children:[(0,N.jsx)("button",{onClick:async()=>{try{const t=C.map(t=>(0,r.A)((0,r.A)({},t),{},{parent_promoter_name:(null===e||void 0===e?void 0:e.name)||"Current Promoter"}));await(0,w.Pq)(t,"my_promoters"),T(!1)}catch(S){a("Failed to export PDF: "+S.message)}},className:"w-full text-left px-4 py-3 text-white hover:bg-gray-700 rounded-t-lg flex items-center space-x-2 transition-colors",children:(0,N.jsx)("span",{children:"\ud83d\udcc4 PDF"})}),(0,N.jsx)("button",{onClick:()=>{try{const t=C.map(t=>(0,r.A)((0,r.A)({},t),{},{parent_promoter_name:(null===e||void 0===e?void 0:e.name)||"Current Promoter"}));(0,w.Jg)(t,"my_promoters"),T(!1)}catch(S){a("Failed to export CSV: "+S.message)}},className:"w-full text-left px-4 py-3 text-white hover:bg-gray-700 rounded-b-lg flex items-center space-x-2 transition-colors",children:(0,N.jsx)("span",{children:"\ud83d\udcca CSV"})})]})]}),document.body)]})]})}),(0,N.jsxs)(c.Xg,{className:"overflow-hidden","data-animate":!0,children:[(0,N.jsx)("div",{className:"px-6 py-4 bg-gray-700 border-b border-gray-600",children:(0,N.jsxs)("div",{className:"flex items-center justify-between",children:[(0,N.jsx)("div",{children:(0,N.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center",children:[(0,N.jsx)(f.A,{className:"w-5 h-5 mr-2 text-blue-400"}),"Complete Downline Hierarchy"]})}),(0,N.jsxs)("div",{className:"text-sm text-gray-400",children:[C.length," of ",A.length," promoters"]})]})}),x?(0,N.jsx)(y,{stage:g}):(0,N.jsx)("div",{className:"overflow-x-auto",children:(0,N.jsxs)("table",{className:"w-full",children:[(0,N.jsx)("thead",{className:"bg-gray-700",children:(0,N.jsxs)("tr",{children:[(0,N.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Promoter Details"}),(0,N.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Contact Details"}),(0,N.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Parent Promoter"}),(0,N.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Hierarchy Level"}),(0,N.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Status"}),(0,N.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Pins"})]})}),(0,N.jsx)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:0===C.length?(0,N.jsx)("tr",{children:(0,N.jsx)("td",{colSpan:"6",className:"px-6 py-12 text-center text-gray-400",children:0===A.length?"No promoters found. Start by creating your first promoter!":"No promoters match your search criteria."})}):(()=>{const t=O*X,a=t-X;return C.slice(a,t).map(t=>{var a,r,s,l;return(0,N.jsxs)("tr",{className:"hover:bg-gray-700",children:[(0,N.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,N.jsxs)("div",{className:"flex items-center",children:[(0,N.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center mr-3",children:(0,N.jsx)("span",{className:"text-white text-sm font-bold",children:((null===t||void 0===t?void 0:t.name)||"U").charAt(0)})}),(0,N.jsxs)("div",{className:"flex flex-col",children:[(0,N.jsx)("span",{className:"text-white font-medium",children:(null===t||void 0===t?void 0:t.name)||"Unknown Promoter"}),(0,N.jsx)("span",{className:"text-xs text-gray-400",children:(null===t||void 0===t?void 0:t.promoter_id)||"N/A"})]})]})}),(0,N.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,N.jsxs)("div",{className:"space-y-1",children:[(0,N.jsxs)("div",{className:"flex items-center",children:[(0,N.jsx)(v.A,{className:"w-3 h-3 mr-2 text-gray-400"}),null!==t&&void 0!==t&&t.email&&"N/A"!==t.email?t.email:"No email"]}),(0,N.jsxs)("div",{className:"flex items-center",children:[(0,N.jsx)(b.A,{className:"w-3 h-3 mr-2 text-gray-400"}),(null===t||void 0===t?void 0:t.phone)||(null===t||void 0===t?void 0:t.mobile)||"No phone"]})]})}),(0,N.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,N.jsx)("div",{className:"flex items-center",children:"admin"===(null===t||void 0===t||null===(a=t.parent_promoter)||void 0===a?void 0:a.role)?(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("span",{className:"text-yellow-400 mr-2",children:"\ud83d\udc51"}),(0,N.jsx)("span",{className:"text-white font-medium",children:(null===t||void 0===t||null===(r=t.parent_promoter)||void 0===r?void 0:r.name)||"Admin"})]}):(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(f.A,{className:"w-4 h-4 mr-2 text-blue-400"}),(0,N.jsxs)("div",{className:"flex flex-col",children:[(0,N.jsx)("span",{className:"text-white font-medium",children:(null===t||void 0===t||null===(s=t.parent_promoter)||void 0===s?void 0:s.name)||(null===e||void 0===e?void 0:e.name)||"You"}),(0,N.jsx)("span",{className:"text-xs text-gray-400",children:(null===t||void 0===t||null===(l=t.parent_promoter)||void 0===l?void 0:l.promoter_id)||"Parent"})]})]})})}),(0,N.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,N.jsx)("div",{className:"flex items-center",children:(0,N.jsxs)("div",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ".concat(1===(null===t||void 0===t?void 0:t.hierarchy_level)?"bg-green-500/10 text-green-400 border-green-500/20":2===(null===t||void 0===t?void 0:t.hierarchy_level)?"bg-blue-500/10 text-blue-400 border-blue-500/20":3===(null===t||void 0===t?void 0:t.hierarchy_level)?"bg-purple-500/10 text-purple-400 border-purple-500/20":"bg-orange-500/10 text-orange-400 border-orange-500/20"),children:[(0,N.jsx)(h.A,{className:"w-3 h-3 mr-1"}),"Level ",(null===t||void 0===t?void 0:t.hierarchy_level)||1]})})}),(0,N.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,N.jsxs)("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-xs font-medium capitalize border ".concat("active"===((null===t||void 0===t?void 0:t.status)||"active").toLowerCase()?"bg-green-500/10 text-green-400 border-green-500/20":"bg-red-500/10 text-red-400 border-red-500/20"),children:[(0,N.jsx)("span",{className:"w-1.5 h-1.5 rounded-full mr-2 ".concat("active"===((null===t||void 0===t?void 0:t.status)||"active").toLowerCase()?"bg-green-400":"bg-red-400")}),(null===t||void 0===t?void 0:t.status)||"active"]})}),(0,N.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,N.jsxs)("span",{className:"text-sm font-medium text-white",children:["\ud83d\udccc ",(null===t||void 0===t?void 0:t.pins)||0]})})]},t.id)})})()})]})})]}),J&&Y&&(0,N.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,N.jsxs)("div",{className:"bg-slate-800 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,N.jsx)("div",{className:"p-6 border-b border-slate-700",children:(0,N.jsxs)("div",{className:"flex items-center justify-between",children:[(0,N.jsx)("h3",{className:"text-xl font-bold text-white",children:"Promoter Details"}),(0,N.jsx)("button",{onClick:()=>{Z(!1),H(null)},className:"text-gray-400 hover:text-white transition-colors",children:(0,N.jsx)(j.A,{className:"w-6 h-6"})})]})}),(0,N.jsxs)("div",{className:"p-6",children:[(0,N.jsxs)("div",{className:"flex items-center space-x-4 mb-6",children:[(0,N.jsx)("div",{className:"w-16 h-16 bg-gradient-to-r from-blue-400 to-purple-500 rounded-full flex items-center justify-center",children:(0,N.jsx)("span",{className:"text-white text-xl font-bold",children:((null===Y||void 0===Y?void 0:Y.name)||"U").charAt(0)})}),(0,N.jsxs)("div",{children:[(0,N.jsx)("h4",{className:"text-xl font-bold text-white",children:(null===Y||void 0===Y?void 0:Y.name)||"Unknown Promoter"}),(0,N.jsx)("p",{className:"text-gray-400",children:null===Y||void 0===Y?void 0:Y.promoter_id}),(0,N.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium mt-2 bg-green-100 text-green-800",children:"Active"})]})]}),(0,N.jsxs)("div",{children:[(0,N.jsx)("h5",{className:"text-lg font-bold text-white mb-4",children:"Promoter Information"}),(0,N.jsxs)("div",{className:"space-y-4",children:[(0,N.jsxs)("div",{className:"flex justify-between",children:[(0,N.jsx)("span",{className:"text-gray-400",children:"Email"}),(0,N.jsx)("span",{className:"text-white font-medium",children:(null===Y||void 0===Y?void 0:Y.email)||"No email"})]}),(0,N.jsxs)("div",{className:"flex justify-between",children:[(0,N.jsx)("span",{className:"text-gray-400",children:"Phone"}),(0,N.jsx)("span",{className:"text-white font-medium",children:(null===Y||void 0===Y?void 0:Y.phone)||"No phone"})]}),(0,N.jsxs)("div",{className:"flex justify-between",children:[(0,N.jsx)("span",{className:"text-gray-400",children:"Join Date"}),(0,N.jsx)("span",{className:"text-white font-medium",children:null!==Y&&void 0!==Y&&Y.joinDate?new Date(Y.joinDate).toLocaleDateString():"N/A"})]}),(0,N.jsxs)("div",{className:"flex justify-between",children:[(0,N.jsx)("span",{className:"text-gray-400",children:"Affiliate Level"}),(0,N.jsx)("span",{className:"text-white font-medium",children:(null===Y||void 0===Y?void 0:Y.level)>0?"Downline Level ".concat(null===Y||void 0===Y?void 0:Y.level):"Level ".concat((null===Y||void 0===Y?void 0:Y.affiliate_level)||1)})]}),(0,N.jsxs)("div",{className:"flex justify-between",children:[(0,N.jsx)("span",{className:"text-gray-400",children:"Commission Rate"}),(0,N.jsxs)("span",{className:"text-white font-medium",children:[(100*((null===Y||void 0===Y?void 0:Y.commission_rate)||.05)).toFixed(1),"%"]})]}),(0,N.jsxs)("div",{className:"flex justify-between",children:[(0,N.jsx)("span",{className:"text-gray-400",children:"Can Create Promoters"}),(0,N.jsx)("span",{className:"font-medium ".concat(null!==Y&&void 0!==Y&&Y.can_create_promoters?"text-green-400":"text-red-400"),children:null!==Y&&void 0!==Y&&Y.can_create_promoters?"Yes":"No"})]}),(0,N.jsxs)("div",{className:"flex justify-between",children:[(0,N.jsx)("span",{className:"text-gray-400",children:"Can Create Customers"}),(0,N.jsx)("span",{className:"font-medium ".concat(null!==Y&&void 0!==Y&&Y.can_create_customers?"text-green-400":"text-red-400"),children:null!==Y&&void 0!==Y&&Y.can_create_customers?"Yes":"No"})]})]}),(0,N.jsxs)("div",{className:"mt-6 space-y-2",children:[(0,N.jsxs)(c.Rq,{className:"w-full flex items-center justify-center space-x-2",children:[(0,N.jsx)(v.A,{className:"w-4 h-4"}),(0,N.jsx)("span",{children:"Contact Promoter"})]}),(0,N.jsx)("button",{className:"w-full px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition-colors",children:"View Performance"})]})]})]})]})}),$&&(0,N.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,N.jsxs)("div",{className:"bg-slate-800 rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,N.jsx)("div",{className:"p-6 border-b border-slate-700",children:(0,N.jsxs)("div",{className:"flex items-center justify-between",children:[(0,N.jsx)("h3",{className:"text-xl font-bold text-white",children:"Create New Promoter"}),(0,N.jsx)("button",{onClick:se,className:"text-gray-400 hover:text-white transition-colors",children:(0,N.jsx)(j.A,{className:"w-6 h-6"})})]})}),(0,N.jsx)("div",{className:"p-6",children:(0,N.jsx)(d.A,{onSubmit:async r=>{try{if(!r.name||""===r.name.trim())throw new Error("Name is required for promoter creation.");if(!r.password||""===r.password.trim())throw new Error("Password is required for promoter creation.");if(!r.phone||""===r.phone.trim())throw new Error("Phone number is required for promoter creation.");const a=Date.now(),i=Math.floor(1e6*Math.random());let n,d,c="promo".concat(a).concat(i,"@brightplanet.com");try{const e="https://api.brightplanetventures.com/api",t=await fetch("".concat(e,"/create-promoter-auth"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:c,password:r.password,userData:{role:"promoter",name:r.name,phone:r.phone}})});if(!t.ok)throw new Error("Backend service not available");n={user:(await t.json()).user}}catch(l){throw new Error("Backend service not available. Please ensure the backend API is running to safely create promoter auth without changing your session.")}if(d){var s;if(null!==(s=d.message)&&void 0!==s&&s.includes("already registered"))throw new Error("Email ".concat(c," is already registered. Please try again."));throw new Error("Failed to create auth user: "+d.message)}if(!n.user)throw new Error("Failed to create auth user: No user data returned");const{error:m}=await o.ND.rpc("confirm_promoter_email",{p_user_id:n.user.id}),{data:x,error:h}=await o.ND.rpc("create_promoter_with_auth_id",{p_name:r.name.trim(),p_user_id:n.user.id,p_auth_email:c,p_password:r.password.trim(),p_phone:r.phone.trim(),p_email:r.email&&r.email.trim()?r.email.trim():null,p_address:r.address&&r.address.trim()?r.address.trim():null,p_parent_promoter_id:e.id,p_role_level:"Affiliate",p_status:"Active"});if(h)throw h;if(!x||!x.success)throw new Error((null===x||void 0===x?void 0:x.error)||"Failed to create promoter profile");await ae(),se(),t("Promoter Created Successfully!\n\nPromoter ID: ".concat(x.promoter_id,"\nName: ").concat(x.name,"\nLogin: Use Promoter ID + Password"))}catch(S){a("Failed to create promoter: ".concat(S.message))}},onCancel:se,hideParentPromoter:!0,submitButtonText:"Create Promoter"})})]})})]})})})]})}}}]);
//# sourceMappingURL=745.aa6d343b.chunk.js.map