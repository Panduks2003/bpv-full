"use strict";(self.webpackChunkbrightplanet_ventures=self.webpackChunkbrightplanet_ventures||[]).push([[581],{2380:(e,t,s)=>{s.d(t,{A:()=>r});const r=(0,s(3797).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},2699:(e,t,s)=>{s.d(t,{A:()=>r});const r=(0,s(3797).A)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]])},4999:(e,t,s)=>{s.d(t,{A:()=>m});var r=s(2555),a=s(5043),n=(s(6127),s(917)),o=s(5923),l=s(8775),i=s(5897),c=s(579);const d=a.memo(e=>{let{onSubmit:t,onCancel:s,loading:d=!1,editingPromoter:m=null,availableParents:u=[],adminUsers:x=[]}=e;const[h,p]=(0,a.useState)({name:"",email:"",hasEmail:!1,password:"",confirmPassword:"",phone:"",address:"",parentPromoter:""}),[g,f]=(0,a.useState)({}),[y,b]=(0,a.useState)(!1),[w,v]=(0,a.useState)(!1);(0,a.useEffect)(()=>{if(m){const e=m.email||"",t=e&&!e.includes("noemail+")&&!e.includes("@brightplanetventures.local");p({name:m.name||"",email:t?e:"",hasEmail:t,password:"",confirmPassword:"",phone:m.phone||"",address:m.address||"",parentPromoter:m.parent_promoter_id||""})}},[m]);const j=(0,a.useMemo)(()=>[...(x||[]).map(e=>({id:e.id,label:"\ud83d\udc51 ".concat(e.name," (Admin)"),type:"admin"})),...(u||[]).map(e=>({id:e.id||e._id,label:e.isCurrentUser?"".concat(e.promoter_id||"CURRENT"," - ").concat(e.name," (You)"):"".concat(e.promoter_id||"N/A"," - ").concat(e.name||"Unknown"),type:"promoter"}))],[x,u]),N=(0,a.useCallback)((e,t)=>{const s={};switch(e){case"name":t&&t.trim()?/^[a-zA-Z\s]+$/.test(t.trim())?t.trim().length<2&&(s.name="Name must be at least 2 characters"):s.name="Name must contain only letters and spaces":s.name="Name is required";break;case"email":if(h.hasEmail)if(t&&t.trim()){/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.trim())||(s.email="Please enter a valid email address")}else s.email="Email address is required";break;case"password":m||(t?t.length<8?s.password="Password must be at least 8 characters":/(?=.*[a-zA-Z])(?=.*\d)/.test(t)||(s.password="Password must contain both letters and numbers"):s.password="Password is required");break;case"confirmPassword":m||t===h.password||(s.confirmPassword="Passwords do not match");break;case"phone":t?/^[6-9]\d{9}$/.test(t)||(s.phone="Enter a valid 10-digit Indian mobile number (starting with 6-9)"):s.phone="Phone number is required";break;case"parentPromoter":!t&&j.length>1&&(s.parentPromoter="Parent promoter selection is required")}return s},[h.hasEmail,h.password,m,j]),A=(0,a.useCallback)((e,t)=>{p(s=>(0,r.A)((0,r.A)({},s),{},{[e]:t}));const s=N(e,t);f(e=>(0,r.A)((0,r.A)({},e),s)),!s[e]&&g[e]&&f(t=>{const s=(0,r.A)({},t);return delete s[e],s})},[N,g]),P=(0,a.useCallback)(()=>{const e={};return Object.keys(h).forEach(t=>{const s=N(t,h[t]);Object.assign(e,s)}),f(e),0===Object.keys(e).length},[h,N,m]);(0,a.useEffect)(()=>{1!==j.length||h.parentPromoter||p(e=>(0,r.A)((0,r.A)({},e),{},{parentPromoter:j[0].id}))},[j,h.parentPromoter]);const k=(0,a.useCallback)(async e=>{if(e.preventDefault(),!P())return;const s={name:h.name,email:h.hasEmail&&h.email?h.email:null,password:h.password,phone:h.phone,address:h.address||null,parentPromoter:h.parentPromoter||null,useNewSystem:!0};await t(s)},[h,P,t]);return(0,c.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,c.jsx)("div",{className:"flex justify-between items-center mb-6",children:(0,c.jsxs)("div",{children:[(0,c.jsx)("h3",{className:"text-xl font-semibold text-white mb-1",children:m?"Edit Promoter":"Create New Promoter"}),(0,c.jsx)("p",{className:"text-gray-400 text-sm",children:m?"Update promoter information and hierarchy":"Add a new promoter to the system. Promoter ID (BPVP format) will be auto-generated."}),!m&&(0,c.jsx)("div",{className:"mt-2 p-3 bg-orange-900/30 border border-orange-500/30 rounded-lg",children:(0,c.jsxs)("p",{className:"text-orange-300 text-xs",children:["\ud83c\udfaf ",(0,c.jsx)("strong",{children:"New System:"})," Promoters will login using their auto-generated Promoter ID (e.g., BPVP01) + password. Email is optional and used for notifications only."]})})]})}),(0,c.jsxs)("form",{onSubmit:k,className:"space-y-5",children:[(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Full Name",(0,c.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,c.jsx)("input",{type:"text",value:h.name,onChange:e=>A("name",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(g.name?"border-red-500":"border-gray-600"),placeholder:"Enter full name (letters and spaces only)"}),g.name&&(0,c.jsx)("p",{className:"text-red-400 text-sm mt-1",children:g.name})]}),(0,c.jsxs)("div",{className:"mb-4",children:[(0,c.jsxs)("div",{className:"flex items-center mb-2",children:[(0,c.jsx)("input",{type:"checkbox",id:"hasEmail",checked:h.hasEmail,onChange:e=>{const t=e.target.checked;p(e=>(0,r.A)((0,r.A)({},e),{},{hasEmail:t,email:t?e.email:""})),t||f(e=>{const t=(0,r.A)({},e);return delete t.email,t})},className:"mr-2 h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-600 rounded bg-gray-700"}),(0,c.jsxs)("label",{htmlFor:"hasEmail",className:"text-sm font-medium text-gray-300",children:["Add Email Address",(0,c.jsx)("span",{className:"text-gray-500 text-xs ml-2",children:"(Optional - for notifications only)"})]})]}),h.hasEmail&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("input",{type:"email",value:h.email,onChange:e=>A("email",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(g.email?"border-red-500":"border-gray-600"),placeholder:"Enter email address (can be shared with others)"}),g.email&&(0,c.jsx)("p",{className:"text-red-400 text-sm mt-1",children:g.email}),(0,c.jsx)("p",{className:"text-gray-500 text-xs mt-1",children:"\ud83d\udca1 Multiple promoters can share the same email address. Used for notifications only."})]}),!h.hasEmail&&(0,c.jsx)("p",{className:"text-gray-400 text-xs mt-1",children:"\u2139\ufe0f Email is optional. Promoter will login using their Promoter ID only."})]}),!m&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Password",(0,c.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)("input",{type:y?"text":"password",value:h.password,onChange:e=>A("password",e.target.value),className:"w-full px-4 py-3 pr-12 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(g.password?"border-red-500":"border-gray-600"),placeholder:"Enter secure password (min 8 chars, letters + numbers)"}),(0,c.jsx)("button",{type:"button",onClick:()=>b(!y),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white",children:y?(0,c.jsx)(o.A,{className:"w-5 h-5"}):(0,c.jsx)(l.A,{className:"w-5 h-5"})})]}),g.password&&(0,c.jsx)("p",{className:"text-red-400 text-sm mt-1",children:g.password})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Confirm Password",(0,c.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,c.jsxs)("div",{className:"relative",children:[(0,c.jsx)("input",{type:w?"text":"password",value:h.confirmPassword,onChange:e=>A("confirmPassword",e.target.value),className:"w-full px-4 py-3 pr-12 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(g.confirmPassword?"border-red-500":"border-gray-600"),placeholder:"Confirm your password"}),(0,c.jsx)("button",{type:"button",onClick:()=>v(!w),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white",children:w?(0,c.jsx)(o.A,{className:"w-5 h-5"}):(0,c.jsx)(l.A,{className:"w-5 h-5"})})]}),g.confirmPassword&&(0,c.jsx)("p",{className:"text-red-400 text-sm mt-1",children:g.confirmPassword})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Phone Number",(0,c.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,c.jsx)("input",{type:"tel",value:h.phone,onChange:e=>A("phone",e.target.value.replace(/\D/g,"").slice(0,10)),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(g.phone?"border-red-500":"border-gray-600"),placeholder:"Enter 10-digit mobile number",maxLength:10}),g.phone&&(0,c.jsx)("p",{className:"text-red-400 text-sm mt-1",children:g.phone})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Address",(0,c.jsx)("span",{className:"text-gray-500 text-xs ml-2",children:"(Optional)"})]}),(0,c.jsx)("textarea",{value:h.address,onChange:e=>A("address",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Enter full postal address (optional)",rows:3})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Parent Promoter",(0,c.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,c.jsxs)("select",{value:h.parentPromoter,onChange:e=>A("parentPromoter",e.target.value),disabled:1===j.length,className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(g.parentPromoter?"border-red-500":"border-gray-600"," ").concat(1===j.length?"opacity-75 cursor-not-allowed":""),children:[0===j.length&&(0,c.jsx)("option",{value:"",children:"Select parent promoter"}),j.map(e=>(0,c.jsx)("option",{value:e.id,children:e.label},e.id))]}),1===j.length&&(0,c.jsx)("p",{className:"text-gray-400 text-xs mt-1",children:"\ud83d\udca1 Automatically set as your downline promoter"}),g.parentPromoter&&(0,c.jsx)("p",{className:"text-red-400 text-sm mt-1",children:g.parentPromoter})]}),(0,c.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-700",children:[(0,c.jsx)("button",{type:"button",onClick:s,className:"px-6 py-3 text-gray-300 hover:text-white transition-colors",disabled:d,children:"Cancel"}),(0,c.jsx)("button",{type:"submit",disabled:d||Object.keys(g).length>0,className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:d?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(i.A,{className:"w-4 h-4 animate-spin"}),(0,c.jsx)("span",{children:m?"Updating...":"Creating..."})]}):(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.A,{className:"w-4 h-4"}),(0,c.jsx)("span",{children:m?"Update Promoter":"Create Promoter"})]})})]})]})]})});d.displayName="UnifiedPromoterForm";const m=d},5680:(e,t,s)=>{s.d(t,{A:()=>r});const r=(0,s(3797).A)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},6339:(e,t,s)=>{s.d(t,{A:()=>r});const r=(0,s(3797).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},6787:(e,t,s)=>{s.d(t,{A:()=>r});const r=(0,s(3797).A)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},7581:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var r=s(2555),a=s(5043),n=s(6621),o=s(1460),l=s(4999),i=s(3959),c=s(6127),d=s(5897),m=s(9589),u=s(6787),x=s(5680),h=s(2380),p=s(2699),g=s(6339),f=s(8112),y=s(1172),b=s(1754),w=(s(7662),s(9363)),v=s(3203),j=s(579);const N=function(){const{user:e}=(0,n.As)(),{showSuccess:t,showError:s,showWarning:N,handleApiError:A}=(0,w.dj)();(0,i.r9)();const[P,k]=(0,a.useState)([]),[C,_]=(0,a.useState)([]),[E,S]=(0,a.useState)([]),[D,M]=(0,a.useState)(""),[I,F]=(0,a.useState)(""),[q,L]=(0,a.useState)(!1),[O,U]=(0,a.useState)(!1),[T,V]=(0,a.useState)(null),[R,z]=(0,a.useState)(null),[B,H]=(0,a.useState)(!0),[X,Z]=(0,a.useState)(!1),[$,J]=(0,a.useState)(!1),[Q,W]=(0,a.useState)(null),[Y,G]=(0,a.useState)({amount:"",notes:""});(0,a.useEffect)(()=>{K(),ee()},[]),(0,a.useEffect)(()=>{let e=P||[];D&&(e=e.filter(e=>{const t=((null===e||void 0===e?void 0:e.name)||"").toLowerCase(),s=((null===e||void 0===e?void 0:e.email)||"").toLowerCase(),r=((null===e||void 0===e?void 0:e.promoter_id)||"").toLowerCase(),a=((null===e||void 0===e?void 0:e.phone)||"").toLowerCase(),n=(D||"").toLowerCase();return t.includes(n)||s.includes(n)||r.includes(n)||a.includes(n)})),I&&(e=e.filter(e=>((null===e||void 0===e?void 0:e.status)||"active").toLowerCase()===I.toLowerCase())),S(e)},[P,D,I]);const K=async()=>{try{H(!0);const{data:e,error:t}=await c.ND.from("profiles").select("*").eq("role","promoter").order("created_at",{ascending:!1});if(t)throw t;k(e||[])}catch(e){console.error("Error loading promoters:",e),k([])}finally{H(!1)}},ee=async()=>{try{const{data:e,error:t}=await c.ND.from("profiles").select("id, name, email, role").eq("role","admin").order("created_at",{ascending:!1});if(t)throw console.error("\u274c Admin users query error:",t),t;_(e||[])}catch(e){console.error("\u274c Error loading admin users:",e),_([])}},te=()=>{L(!1),V(null)},se=()=>{U(!1),z(null)},re=()=>{J(!1),W(null),G({amount:"",notes:""})};return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(i.wE,{}),(0,j.jsx)(o.A,{}),(0,j.jsxs)(i.dQ,{children:[(0,j.jsx)("div",{className:"min-h-screen p-8",children:(0,j.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,j.jsxs)("div",{className:"flex justify-between items-center mb-8","data-animate":!0,children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("h1",{className:"text-4xl font-bold text-white mb-2",children:"Promoter Management"}),(0,j.jsx)("p",{className:"text-gray-400",children:"Manage promoters, hierarchies, and performance"})]}),(0,j.jsxs)(i.Rq,{onClick:()=>{V(null),L(!0)},className:"flex items-center space-x-2",children:[(0,j.jsx)(h.A,{className:"w-5 h-5"}),(0,j.jsx)("span",{children:"Create Promoter"})]})]}),(0,j.jsx)(i.Xg,{className:"mb-6","data-animate":!0,children:(0,j.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[(0,j.jsx)("div",{className:"flex-1",children:(0,j.jsx)("input",{type:"text",placeholder:"Search by name, email, ID, or phone...",value:D,onChange:e=>M(e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500"})}),(0,j.jsx)("div",{className:"flex gap-4",children:(0,j.jsxs)("select",{value:I,onChange:e=>F(e.target.value),className:"px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500",children:[(0,j.jsx)("option",{value:"",children:"All Status"}),(0,j.jsx)("option",{value:"active",children:"Active"}),(0,j.jsx)("option",{value:"inactive",children:"Inactive"})]})})]})}),(0,j.jsx)(i.Xg,{className:"overflow-hidden","data-animate":!0,children:B?(0,j.jsx)(b.cU,{rows:8,columns:6}):(0,j.jsx)("div",{className:"overflow-x-auto",children:(0,j.jsxs)("table",{className:"w-full",children:[(0,j.jsx)("thead",{className:"bg-gray-700",children:(0,j.jsxs)("tr",{children:[(0,j.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Promoter ID"}),(0,j.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Name"}),(0,j.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Contact Details"}),(0,j.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Parent Promoter"}),(0,j.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Status"}),(0,j.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Pins"}),(0,j.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,j.jsx)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:0===E.length?(0,j.jsx)("tr",{children:(0,j.jsx)("td",{colSpan:"7",className:"px-6 py-12 text-center text-gray-400",children:"No promoters found"})}):E.map(e=>{const s=null===e||void 0===e?void 0:e.id,r=(null===e||void 0===e?void 0:e.name)||"Unknown",a=(null===e||void 0===e?void 0:e.email)||"N/A",n=(null===e||void 0===e?void 0:e.phone)||"N/A",o=(null===e||void 0===e?void 0:e.promoter_id)||"N/A",l=((null===e||void 0===e?void 0:e.status)||"Active").toLowerCase();return(0,j.jsxs)("tr",{className:"hover:bg-gray-700",children:[(0,j.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,j.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:o})}),(0,j.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,j.jsxs)("div",{className:"flex items-center",children:[(0,j.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-400 to-yellow-500 rounded-full flex items-center justify-center mr-3",children:(0,j.jsx)(f.A,{className:"w-4 h-4 text-white"})}),(0,j.jsx)("div",{className:"text-sm font-medium text-white",children:r})]})}),(0,j.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,j.jsxs)("div",{className:"space-y-1",children:[(0,j.jsxs)("div",{className:"flex items-center",children:[(0,j.jsx)(m.A,{className:"w-3 h-3 mr-2 text-gray-400"}),"N/A"===a?"No email":a]}),(0,j.jsxs)("div",{className:"flex items-center",children:[(0,j.jsx)(x.A,{className:"w-3 h-3 mr-2 text-gray-400"}),n||"No phone"]})]})}),(0,j.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(()=>{const t=(e=>{const t=null===e||void 0===e?void 0:e.parent_promoter_id;if(!t)return null;const s=(C||[]).find(e=>e.id===t);if(s)return{name:s.name||"Admin",id:"Admin",isAdmin:!0};const r=(P||[]).find(e=>(null===e||void 0===e?void 0:e.id)===t);return r?{name:r.name||"Unknown",id:r.promoter_id||"N/A",isAdmin:!1}:{name:"Unknown Parent",id:"N/A",isAdmin:!1}})(e);return t?(0,j.jsx)("div",{className:"flex items-center",children:t.isAdmin?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("span",{className:"text-yellow-400 mr-2",children:"\ud83d\udc51"}),(0,j.jsx)("span",{className:"text-white font-medium",children:t.name})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(f.A,{className:"w-4 h-4 mr-2 text-blue-400"}),(0,j.jsxs)("div",{className:"flex flex-col",children:[(0,j.jsx)("span",{className:"text-white font-medium",children:t.name}),(0,j.jsx)("span",{className:"text-xs text-gray-400",children:t.id})]})]})}):"-"})()}),(0,j.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,j.jsx)("button",{onClick:()=>(async e=>{try{var s;const r=null===(s=e.status)||void 0===s?void 0:s.toLowerCase(),a="active"===r?"Inactive":"Active",{error:n}=await c.ND.from("profiles").update({status:a}).eq("id",e.id);if(n)throw console.error("\u274c Status update error:",n),n;await K(),t(v.ES.status(v.nF.PROMOTER,r,a,e.name))}catch(r){console.error("Error updating promoter status:",r),A(r,"Failed to update promoter status")}})(e),className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium transition-colors hover:opacity-80 cursor-pointer ".concat("active"===l?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"),title:"Click to toggle status",children:"active"===l?"\u2705 Active":"\u274c Inactive"})}),(0,j.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,j.jsxs)("span",{className:"text-sm font-medium text-white",children:["\ud83d\udccc ",(null===e||void 0===e?void 0:e.pins)||0]})}),(0,j.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,j.jsxs)("div",{className:"flex space-x-2",children:[(0,j.jsx)("button",{onClick:()=>(e=>{V(e),L(!0)})(e),className:"text-orange-400 hover:text-orange-300 transition-colors",children:(0,j.jsx)(u.A,{className:"w-4 h-4"})}),(0,j.jsx)("button",{onClick:()=>(e=>{z(e),U(!0)})(e),className:"text-red-400 hover:text-red-300 transition-colors",children:(0,j.jsx)(g.A,{className:"w-4 h-4"})})]})})]},s)})})]})})})]})}),q&&(0,j.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,j.jsx)(l.A,{onSubmit:async e=>{Z(!0);try{if(T){const{data:s,error:r}=await c.ND.rpc("update_promoter_profile",{p_promoter_id:T.promoter_id,p_name:e.name,p_email:e.email,p_phone:e.phone,p_address:e.address,p_status:e.status,p_parent_promoter_id:e.parentPromoter||null});if(r)throw r;if(!s.success)throw new Error(s.error||"Failed to update promoter");t(v.ES.success(v.kl.UPDATE,v.nF.PROMOTER))}else{if(console.log("\ud83d\ude80 Creating promoter with new Promoter ID system..."),!e.name||""===e.name.trim())throw new Error("Name is required for promoter creation.");if(!e.password||""===e.password.trim())throw new Error("Password is required for promoter creation.");if(!e.phone||""===e.phone.trim())throw new Error("Phone number is required for promoter creation.");const s=Date.now(),r=Math.floor(1e6*Math.random()),a="promo".concat(s).concat(r,"@brightplanet.com");console.log("\ud83d\udce7 Creating Supabase auth user...");const{data:n,error:o}=await c.ND.auth.signUp({email:a,password:e.password,options:{emailRedirectTo:void 0,data:{role:"promoter",name:e.name,phone:e.phone}}});if(o)throw console.error("\u274c Auth creation error:",o),new Error("Failed to create auth user: "+o.message);if(!n.user)throw new Error("Failed to create auth user: No user data returned");console.log("\u2705 Auth user created:",n.user.id);const{error:l}=await c.ND.rpc("confirm_promoter_email",{p_user_id:n.user.id});l?console.warn("\u26a0\ufe0f Could not auto-confirm email:",l.message):console.log("\u2705 Email confirmed automatically");const{data:i,error:d}=await c.ND.rpc("create_promoter_with_auth_id",{p_name:e.name.trim(),p_user_id:n.user.id,p_auth_email:a,p_password:e.password.trim(),p_phone:e.phone.trim(),p_email:e.email&&e.email.trim()?e.email.trim():null,p_address:e.address&&e.address.trim()?e.address.trim():null,p_parent_promoter_id:e.parentPromoter||null,p_role_level:"Affiliate",p_status:"Active"});if(d)throw console.error("\u274c Promoter profile creation error:",d),d;if(!i||!i.success)throw new Error((null===i||void 0===i?void 0:i.error)||"Failed to create promoter profile");console.log("\u2705 Promoter created successfully:",i),t("\ud83c\udf89 Promoter created successfully!\n\ud83c\udfa9 Promoter ID: ".concat(i.promoter_id,"\n\ud83d\udcdd Name: ").concat(i.name,"\n\ud83d\udd11 Login: Use Promoter ID + Password"))}await K(),te()}catch(s){console.error("Error saving promoter:",s),A(s,"Failed to save promoter")}finally{Z(!1)}},onCancel:te,loading:X,editingPromoter:T,availableParents:(()=>{const e=P||[],t=[...e];if(!T)return t;const s=(e,t)=>{const r=[];return t.filter(t=>(null===t||void 0===t?void 0:t.parent_promoter_id)===e).forEach(e=>{const a=null===e||void 0===e?void 0:e.id;a&&(r.push(a),r.push(...s(a,t)))}),r},r=null===T||void 0===T?void 0:T.id;if(!r)return t;const a=[r,...s(r,e)];return t.filter(e=>{const t=null===e||void 0===e?void 0:e.id;return t&&((null===e||void 0===e?void 0:e.isAdmin)||!a.includes(t))})})(),adminUsers:C})}),O&&R&&(0,j.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,j.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4",children:[(0,j.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,j.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Confirm Delete"}),(0,j.jsx)("button",{onClick:se,className:"text-gray-400 hover:text-white transition-colors",children:(0,j.jsx)(y.A,{className:"w-5 h-5"})})]}),(0,j.jsxs)("div",{className:"mb-6",children:[(0,j.jsxs)("p",{className:"text-gray-300",children:["Are you sure you want to delete promoter ",(0,j.jsx)("strong",{children:R.name}),"?"]}),(0,j.jsx)("p",{className:"text-red-400 text-sm mt-2",children:"This action cannot be undone."})]}),(0,j.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,j.jsx)("button",{onClick:se,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"Cancel"}),(0,j.jsx)("button",{onClick:async()=>{if(R)try{const{error:e}=await c.ND.from("profiles").delete().eq("id",R.id);if(e)throw e;await K(),se()}catch(e){console.error("Error deleting promoter:",e),A(e,"Failed to delete promoter")}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete"})]})]})}),$&&Q&&(0,j.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,j.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md border border-gray-700",children:[(0,j.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,j.jsx)("h3",{className:"text-xl font-semibold text-white",children:"Allocate Pins"}),(0,j.jsx)("button",{onClick:re,className:"text-gray-400 hover:text-white transition-colors",children:(0,j.jsx)(y.A,{className:"w-5 h-5"})})]}),(0,j.jsxs)("div",{className:"space-y-4",children:[(0,j.jsxs)("div",{children:[(0,j.jsxs)("p",{className:"text-gray-300 mb-2",children:["Promoter: ",(0,j.jsx)("span",{className:"font-semibold text-white",children:Q.name})]}),(0,j.jsxs)("p",{className:"text-gray-300 mb-4",children:["Current Pins: ",(0,j.jsx)("span",{className:"font-bold ".concat(((null===Q||void 0===Q?void 0:Q.pins)||0)>0?"text-green-400":"text-red-400"),children:(null===Q||void 0===Q?void 0:Q.pins)||0})]})]}),(0,j.jsxs)("div",{children:[(0,j.jsxs)("label",{className:"block text-gray-300 text-sm mb-2",children:["Number of Pins to Allocate ",(0,j.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,j.jsx)("input",{type:"number",min:"1",max:"1000",value:Y.amount,onChange:e=>G(t=>(0,r.A)((0,r.A)({},t),{},{amount:e.target.value})),placeholder:"Enter number of pins",className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20"})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("label",{className:"block text-gray-300 text-sm mb-2",children:"Notes (Optional)"}),(0,j.jsx)("textarea",{value:Y.notes,onChange:e=>G(t=>(0,r.A)((0,r.A)({},t),{},{notes:e.target.value})),placeholder:"Add notes about this allocation...",rows:"3",className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20"})]}),(0,j.jsx)("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:(0,j.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,j.jsx)(p.A,{className:"w-5 h-5 text-blue-400 mt-0.5"}),(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{className:"text-blue-300 text-sm font-medium",children:"Pin Allocation Info"}),(0,j.jsx)("p",{className:"text-gray-300 text-sm mt-1",children:"Each customer creation requires 1 pin. Allocate pins to enable promoters to create customers."})]})]})})]}),(0,j.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,j.jsx)("button",{onClick:re,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",disabled:X,children:"Cancel"}),(0,j.jsx)("button",{onClick:async()=>{if(!Q||!Y.amount)return void N("Please enter a valid pin amount");const e=parseInt(Y.amount);if(e<=0)N("Pin amount must be greater than 0");else try{Z(!0);const{data:s,error:r}=await c.ND.rpc("add_promoter_pins",{p_promoter_id:Q.id,p_pins_to_add:e});if(r)throw new Error(r.message);await c.ND.from("pin_usage_log").insert({promoter_id:Q.id,pins_used:-e,action_type:"admin_allocation",notes:Y.notes||"Admin allocated ".concat(e," pins")}),t(v.ES.success(v.kl.ALLOCATE,v.nF.PIN),"".concat(e," pins allocated to ").concat(Q.name)),await K(),re()}catch(s){console.error("Error allocating pins:",s),A(s,"Failed to allocate pins")}finally{Z(!1)}},disabled:X||!Y.amount,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:X?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(d.A,{className:"w-4 h-4 animate-spin"}),(0,j.jsx)("span",{children:"Allocating..."})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(p.A,{className:"w-4 h-4"}),(0,j.jsx)("span",{children:"Allocate Pins"})]})})]})]})})]})]})}},7662:(e,t,s)=>{s.d(t,{Aq:()=>c,Bx:()=>i,X3:()=>l,pA:()=>o});var r=s(2555),a=s(5043);new Map;class n{constructor(){this.subscriptions=new Map,this.syncIntervals=new Map,this.isVisible=!0,this.setupVisibilityListener()}setupVisibilityListener(){document.addEventListener("visibilitychange",()=>{this.isVisible=!document.hidden,this.isVisible?this.resumeAllSyncs():this.pauseAllSyncs()})}subscribe(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3e4;if(this.subscriptions.set(e,t),this.isVisible){const r=setInterval(async()=>{if(this.isVisible)try{await t()}catch(s){console.error("Background sync failed for ".concat(e,":"),s)}},s);this.syncIntervals.set(e,r)}}unsubscribe(e){const t=this.syncIntervals.get(e);t&&(clearInterval(t),this.syncIntervals.delete(e)),this.subscriptions.delete(e)}pauseAllSyncs(){this.syncIntervals.forEach(e=>{clearInterval(e)}),this.syncIntervals.clear()}resumeAllSyncs(){this.subscriptions.forEach((e,t)=>{const s=setInterval(async()=>{if(this.isVisible)try{await e()}catch(s){console.error("Background sync failed for ".concat(t,":"),s)}},3e4);this.syncIntervals.set(t,s)})}destroy(){this.pauseAllSyncs(),this.subscriptions.clear()}}new n;const o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[s,r]=a.useState(e),n=(0,a.useRef)(e);return[s,(0,a.useCallback)(e=>{const s="function"===typeof e?e(n.current):e;(t?!t(n.current,s):JSON.stringify(n.current)!==JSON.stringify(s))&&(n.current=s,r(s))},[t])]},l=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300;const[r,n]=a.useState(""),[o,l]=a.useState(e),i=(0,a.useCallback)(((e,t)=>{let s;return function(){for(var r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];clearTimeout(s),s=setTimeout(()=>{clearTimeout(s),e(...a)},t)}})((e,s)=>{if(!e.trim())return void l(s);const r=s.filter(s=>t.some(t=>{const r=t.split(".").reduce((e,t)=>null===e||void 0===e?void 0:e[t],s);return null===r||void 0===r?void 0:r.toString().toLowerCase().includes(e.toLowerCase())}));l(r)},s),[t,s]);return(0,a.useEffect)(()=>{i(r,e||[])},[r,e,i]),{searchTerm:r,setSearchTerm:n,filteredData:o}},i=e=>{const t=(0,a.useRef)(0),s=(0,a.useRef)(Date.now());return(0,a.useEffect)(()=>{t.current+=1}),(0,a.useEffect)(()=>{const r=Date.now()-s.current;return console.log("\ud83c\udfaf ".concat(e," loaded in ").concat(r,"ms")),()=>{console.log("\ud83d\udcca ".concat(e," rendered ").concat(t.current," times"))}},[e]),{renderCount:t.current}},c=()=>{const[e,t]=a.useState({});return{openModal:(0,a.useCallback)(function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;t(t=>(0,r.A)((0,r.A)({},t),{},{[e]:{isOpen:!0,data:s}}))},[]),closeModal:(0,a.useCallback)(e=>{t(t=>(0,r.A)((0,r.A)({},t),{},{[e]:{isOpen:!1,data:null}}))},[]),isModalOpen:(0,a.useCallback)(t=>{var s;return(null===(s=e[t])||void 0===s?void 0:s.isOpen)||!1},[e]),getModalData:(0,a.useCallback)(t=>{var s;return(null===(s=e[t])||void 0===s?void 0:s.data)||null},[e])}}},8112:(e,t,s)=>{s.d(t,{A:()=>r});const r=(0,s(3797).A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])}}]);
//# sourceMappingURL=581.691666ed.chunk.js.map