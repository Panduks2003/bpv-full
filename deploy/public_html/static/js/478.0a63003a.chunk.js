"use strict";(self.webpackChunkbrightplanet_ventures=self.webpackChunkbrightplanet_ventures||[]).push([[478],{98:(e,t,r)=>{r.d(t,{A:()=>s});const s=(0,r(3797).A)("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]])},254:(e,t,r)=>{r.d(t,{Ay:()=>u});var s=r(2555),a=r(6127),n=r(5229);const o={PENDING:"pending",APPROVED:"approved",REJECTED:"rejected"},i={[o.PENDING]:{emoji:"\ud83d\udfe1",label:"Pending",color:"yellow",description:"Waiting for admin approval"},[o.APPROVED]:{emoji:"\ud83d\udfe2",label:"Approved",color:"green",description:"PINs allocated successfully"},[o.REJECTED]:{emoji:"\ud83d\udd34",label:"Rejected",color:"red",description:"Request declined by admin"}},c=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;try{const{data:o,error:c}=await a.ND.from("pin_requests").select("id").limit(1);if(c&&("42P01"===c.code||"42703"===c.code||"PGRST106"===c.code||"PGRST301"===c.code))return console.warn("PIN requests table not found or RLS policies blocking access. Please run the database setup script."),[];const{data:l,error:d}=await a.ND.rpc("get_pin_requests",{p_promoter_id:e,p_status:t,p_limit:r});if(d){var n;if("42883"===d.code||"PGRST202"===d.code){console.warn("get_pin_requests function not found. Using direct table query."),console.warn("Using simple query without joins to avoid relationship issues.");let n=a.ND.from("pin_requests").select("*").order("created_at",{ascending:!1}).limit(r);e&&(n=n.eq("promoter_id",e)),t&&(n=n.eq("status",t));const{data:o,error:c}=await n;if(c){if("42P01"===c.code||"PGRST200"===c.code||"PGRST301"===c.code)return console.warn("pin_requests table not found, relationships missing, or RLS blocking access. Returning empty array."),[];throw c}return o.map(e=>(0,s.A)((0,s.A)({},e),{},{requested_pins:e.quantity,request_number:e.request_id,approved_by:e.processed_by,approved_at:e.response_date,promoter_name:"Promoter",promoter_email:"promoter@example.com",admin_name:null,statusConfig:i[e.status]||{emoji:"\u2753",label:"Unknown",color:"gray",description:"Unknown status"},formattedRequestNumber:e.formatted_request_id||"REQ-".concat(String(e.request_id||e.request_number).padStart(3,"0")),formattedDate:new Date(e.created_at).toLocaleDateString(),formattedTime:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}))}if(null!==(n=d.message)&&void 0!==n&&n.includes("does not exist")||"42703"===d.code)return console.warn("PIN requests table/function not found. Returning empty array."),[];throw d}return l.map(e=>(0,s.A)((0,s.A)({},e),{},{statusConfig:i[e.status]||{emoji:"\u2753",label:"Unknown",color:"gray",description:"Unknown status"},formattedRequestNumber:e.formatted_request_id||"REQ-".concat(String(e.request_number).padStart(3,"0")),formattedDate:new Date(e.created_at).toLocaleDateString(),formattedTime:new Date(e.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}))}catch(o){throw console.error("\u274c Failed to get PIN requests:",o),o}},l=async(e,t,r)=>{const{data:s,error:o}=await a.ND.from("pin_requests").select("*").eq("id",e).eq("status","pending").single();if(o||!s)throw new Error("Request not found or already processed");console.log("\ud83d\udccb Request data for approval:",s);const i=await n.Ay.adminAllocatePins(s.promoter_id,s.quantity||s.requested_pins,t);if(!i.success)throw new Error("Failed to allocate PINs: ".concat(i.error));const{error:c}=await a.ND.from("pin_requests").update({status:"approved",processed_by:t,admin_notes:r,response_date:(new Date).toISOString()}).eq("id",e);if(c)throw new Error("Failed to update request status: ".concat(c.message));return{success:!0,request_id:e,promoter_id:s.promoter_id,allocated_pins:s.requested_pins,new_balance:i.balance_after,message:"PIN request approved and PINs allocated successfully"}},d=async(e,t,r)=>{const{data:s,error:n}=await a.ND.from("pin_requests").select("*").eq("id",e).eq("status","pending").single();if(n||!s)throw new Error("Request not found or already processed");const{error:o}=await a.ND.from("pin_requests").update({status:"rejected",processed_by:t,admin_notes:r||"Request rejected by admin",response_date:(new Date).toISOString()}).eq("id",e);if(o)throw new Error("Failed to update request status: ".concat(o.message));return{success:!0,request_id:e,promoter_id:s.promoter_id,message:"PIN request rejected"}},u={submitPinRequest:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{console.log("\ud83d\udd04 Submitting PIN request:",{promoterId:e,requestedPins:t,reason:r});const{data:n,error:o}=await a.ND.rpc("submit_pin_request",{p_promoter_id:e,p_requested_pins:t,p_reason:r});if(o){var s;if("42883"===o.code||"PGRST202"===o.code){if(console.warn("submit_pin_request function not found. Using direct table insert."),!t||t<=0||t>1e3)throw new Error("Requested PINs must be between 1 and 1000");const{data:s}=await a.ND.from("pin_requests").select("id").eq("promoter_id",e).eq("status","pending");if(s&&s.length>0)throw new Error("You already have a pending PIN request. Please wait for admin approval.");const{data:n,error:o}=await a.ND.from("pin_requests").insert({promoter_id:e,quantity:t,reason:r||"PIN request submitted",category:"standard",urgency:"normal"}).select("*").single();if(o)throw o;return{success:!0,request_id:n.id,request_number:n.request_id,message:"PIN request submitted successfully"}}if(null!==(s=o.message)&&void 0!==s&&s.includes("does not exist"))throw new Error("PIN request system is not set up. Please contact administrator to run the database setup.");throw console.error("\u274c PIN request submission failed:",o),o}if(!n.success)throw console.error("\u274c PIN request returned error:",n.error),new Error(n.error||"PIN request submission failed");return console.log("\u2705 PIN request submitted successfully:",n),n}catch(n){throw console.error("\u274c PIN request service error:",n),n}},getPinRequests:c,approvePinRequest:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{console.log("\ud83d\udd04 Approving PIN request:",{requestId:e,adminId:t,adminNotes:r});const{data:s,error:n}=await a.ND.rpc("approve_pin_request",{p_request_id:e,p_admin_id:t,p_admin_notes:r});if(n){if("42883"===n.code||"PGRST202"===n.code)return console.warn("approve_pin_request function not found. Using manual approval process."),await l(e,t,r);throw console.error("\u274c PIN request approval failed:",n),n}if(!s.success)throw console.error("\u274c PIN request approval returned error:",s.error),new Error(s.error||"PIN request approval failed");return console.log("\u2705 PIN request approved successfully:",s),s}catch(s){throw console.error("\u274c PIN request approval service error:",s),s}},rejectPinRequest:async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{console.log("\ud83d\udd04 Rejecting PIN request:",{requestId:e,adminId:t,adminNotes:r});const{data:s,error:n}=await a.ND.rpc("reject_pin_request",{p_request_id:e,p_admin_id:t,p_admin_notes:r});if(n){if("42883"===n.code||"PGRST202"===n.code)return console.warn("reject_pin_request function not found. Using manual rejection process."),await d(e,t,r);throw console.error("\u274c PIN request rejection failed:",n),n}if(!s.success)throw console.error("\u274c PIN request rejection returned error:",s.error),new Error(s.error||"PIN request rejection failed");return console.log("\u2705 PIN request rejected successfully:",s),s}catch(s){throw console.error("\u274c PIN request rejection service error:",s),s}},getPinRequestStats:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{const t=await c(e);return{totalRequests:t.length,pendingRequests:t.filter(e=>e.status===o.PENDING).length,approvedRequests:t.filter(e=>e.status===o.APPROVED).length,rejectedRequests:t.filter(e=>e.status===o.REJECTED).length,totalPinsRequested:t.reduce((e,t)=>e+t.requested_pins,0),totalPinsApproved:t.filter(e=>e.status===o.APPROVED).reduce((e,t)=>e+t.requested_pins,0)}}catch(t){return console.error("\u274c Failed to get PIN request stats:",t),{totalRequests:0,pendingRequests:0,approvedRequests:0,rejectedRequests:0,totalPinsRequested:0,totalPinsApproved:0}}},hasPendingRequests:async e=>{try{return(await c(e,o.PENDING,1)).length>0}catch(t){return console.error("\u274c Failed to check pending requests:",t),!1}},subscribeToPinRequests:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r="";t&&(r="promoter_id=eq.".concat(t));return a.ND.channel("pin-requests-changes").on("postgres_changes",{event:"*",schema:"public",table:"pin_requests",filter:r},t=>{console.log("\ud83d\udce1 PIN requests change detected:",t),e(t)}).subscribe()},formatPinRequest:e=>(0,s.A)((0,s.A)({},e),{},{displayTitle:"".concat(e.formattedRequestNumber," - ").concat(e.requested_pins," PIN").concat(e.requested_pins>1?"s":""),displayStatus:"".concat(e.statusConfig.emoji," ").concat(e.statusConfig.label),displayDate:"".concat(e.formattedDate," at ").concat(e.formattedTime),displayReason:e.reason||"No reason provided"}),validatePinRequest:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";const r=[];return(!e||e<=0)&&r.push("Requested PINs must be greater than 0"),e>1e3&&r.push("Cannot request more than 1000 PINs at once"),t&&t.length>500&&r.push("Reason must be less than 500 characters"),{isValid:0===r.length,errors:r}},PIN_REQUEST_STATUS:o,PIN_REQUEST_CONFIG:i}},430:(e,t,r)=>{r.d(t,{A:()=>s});const s=(0,r(3797).A)("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]])},1065:(e,t,r)=>{r.d(t,{A:()=>s});const s=(0,r(3797).A)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},1537:(e,t,r)=>{r.d(t,{A:()=>p});var s=r(5043),a=r(2938),n=r(917),o=r(3458),i=r(98),c=r(2817),l=r(1065),d=r(579);const u=(0,s.memo)(e=>{let{requests:t,loading:r=!1,showPromoter:s=!1,emptyMessage:u="No PIN requests found",onApprove:p=null,onReject:m=null,showActions:g=!1}=e;const x=e=>{switch(e){case"pending":return(0,d.jsx)(o.A,{className:"w-4 h-4 text-yellow-400"});case"approved":return(0,d.jsx)(n.A,{className:"w-4 h-4 text-green-400"});case"rejected":return(0,d.jsx)(l.A,{className:"w-4 h-4 text-red-400"});default:return(0,d.jsx)(i.A,{className:"w-4 h-4 text-gray-400"})}},h=e=>{const t=e.statusConfig;return(0,d.jsxs)("span",{className:"inline-flex items-center space-x-1 px-2.5 py-1 rounded-full text-xs font-medium border ".concat({yellow:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30",green:"bg-green-500/20 text-green-400 border-green-500/30",red:"bg-red-500/20 text-red-400 border-red-500/30",gray:"bg-gray-500/20 text-gray-400 border-gray-500/30"}[t.color]),children:[x(e.status),(0,d.jsxs)("span",{children:[t.emoji," ",t.label]})]})};return r?(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full",children:[(0,d.jsx)("thead",{className:"bg-gray-800/50",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Request ID"}),s&&(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Promoter"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"PINs"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Status"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Date"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Reason"}),g&&(0,d.jsx)("th",{className:"px-6 py-3 text-center text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,d.jsx)("tbody",{className:"divide-y divide-gray-700/50",children:[1,2,3,4,5].map(e=>(0,d.jsxs)("tr",{className:"animate-pulse",children:[(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("div",{className:"h-4 bg-gray-700 rounded w-20"})}),s&&(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("div",{className:"h-4 bg-gray-700 rounded w-32"})}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("div",{className:"h-4 bg-gray-700 rounded w-12"})}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("div",{className:"h-4 bg-gray-700 rounded w-24"})}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("div",{className:"h-4 bg-gray-700 rounded w-20"})}),(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("div",{className:"h-4 bg-gray-700 rounded w-40"})}),g&&(0,d.jsx)("td",{className:"px-6 py-4",children:(0,d.jsx)("div",{className:"h-4 bg-gray-700 rounded w-24"})})]},e))})]})}):0===t.length?(0,d.jsxs)("div",{className:"text-center py-12",children:[(0,d.jsx)(i.A,{className:"w-16 h-16 text-gray-600 mb-4 mx-auto"}),(0,d.jsx)("p",{className:"text-gray-300 text-lg mb-2",children:u}),(0,d.jsx)("p",{className:"text-gray-400 text-sm",children:"PIN requests will appear here when submitted."})]}):(0,d.jsx)("div",{className:"overflow-x-auto",children:(0,d.jsxs)("table",{className:"w-full",children:[(0,d.jsx)("thead",{className:"bg-gray-800/50",children:(0,d.jsxs)("tr",{children:[(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Request ID"}),s&&(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Promoter"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"PINs"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Status"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Date"}),(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Reason"}),s&&(0,d.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Admin Response"})]})}),(0,d.jsx)("tbody",{className:"divide-y divide-gray-700/50",children:t.map(e=>(0,d.jsxs)("tr",{className:"hover:bg-gray-800/30 transition-colors",children:[(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:e.formattedRequestNumber})}),s&&(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(c.A,{className:"w-4 h-4 text-gray-400"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm font-medium text-white",children:e.promoter_name||"Promoter"}),(0,d.jsx)("div",{className:"text-xs text-gray-400",children:e.promoter_email||"Email not available"})]})]})}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)("div",{className:"w-8 h-8 bg-orange-500/20 rounded-lg flex items-center justify-center",children:(0,d.jsx)("span",{className:"text-orange-400 text-sm font-bold",children:e.requested_pins})}),(0,d.jsxs)("span",{className:"text-gray-300 text-sm",children:["PIN",e.requested_pins>1?"s":""]})]})}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:h(e)}),(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,d.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,d.jsx)(a.A,{className:"w-4 h-4 text-gray-400"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-white",children:e.formattedDate}),(0,d.jsx)("div",{className:"text-xs text-gray-400",children:e.formattedTime})]})]})}),(0,d.jsx)("td",{className:"px-6 py-4 text-sm text-gray-300 max-w-xs",children:(0,d.jsx)("div",{className:"truncate",title:e.reason||"No reason provided",children:e.reason||(0,d.jsx)("span",{className:"text-gray-500 italic",children:"No reason provided"})})}),s&&(0,d.jsx)("td",{className:"px-6 py-4 text-sm text-gray-300 max-w-xs",children:e.admin_notes?(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"truncate",title:e.admin_notes,children:e.admin_notes}),e.admin_name&&(0,d.jsxs)("div",{className:"text-xs text-gray-500 mt-1",children:["by ",e.admin_name]})]}):(0,d.jsx)("span",{className:"text-gray-500 italic",children:"pending"===e.status?"Awaiting review":"No notes"})}),g&&(0,d.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-center",children:"pending"===e.status?(0,d.jsxs)("div",{className:"flex items-center justify-center space-x-2",children:[(0,d.jsxs)("button",{onClick:()=>p&&p(e),className:"inline-flex items-center px-3 py-1.5 bg-green-600 hover:bg-green-700 text-white text-xs font-medium rounded-lg transition-colors",title:"Approve and allocate PINs",children:[(0,d.jsx)(n.A,{className:"w-3 h-3 mr-1"}),"Approve"]}),(0,d.jsxs)("button",{onClick:()=>m&&m(e),className:"inline-flex items-center px-3 py-1.5 bg-red-600 hover:bg-red-700 text-white text-xs font-medium rounded-lg transition-colors",title:"Reject request",children:[(0,d.jsx)(l.A,{className:"w-3 h-3 mr-1"}),"Reject"]})]}):(0,d.jsx)("span",{className:"text-gray-500 text-xs italic",children:"approved"===e.status?"Approved":"Rejected"})})]},e.id))})]})})});u.displayName="PinRequestTable";const p=u},2380:(e,t,r)=>{r.d(t,{A:()=>s});const s=(0,r(3797).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},2817:(e,t,r)=>{r.d(t,{A:()=>s});const s=(0,r(3797).A)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},2938:(e,t,r)=>{r.d(t,{A:()=>s});const s=(0,r(3797).A)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},5229:(e,t,r)=>{r.d(t,{Ay:()=>d,D7:()=>c,Lh:()=>l,getUserPinBalance:()=>i,hO:()=>n});var s=r(2555),a=r(6127);const n={CUSTOMER_CREATION:"customer_creation",ADMIN_ALLOCATION:"admin_allocation",ADMIN_DEDUCTION:"admin_deduction"},o={[n.CUSTOMER_CREATION]:{emoji:"\u274c",label:"Customer Creation",color:"red",sign:"-"},[n.ADMIN_ALLOCATION]:{emoji:"\u2705",label:"Admin Allocation",color:"green",sign:"+"},[n.ADMIN_DEDUCTION]:{emoji:"\u274c",label:"Admin Deduction",color:"red",sign:"-"}},i=async e=>{try{const{data:t,error:r}=await a.ND.from("profiles").select("pins").eq("id",e).single();if(r)throw r;return t.pins||0}catch(t){throw console.error("\u274c Failed to get user PIN balance:",t),t}},c=(e,t)=>{if(!o[e])return t.toString();const r=Math.abs(t);return e===n.ADMIN_ALLOCATION?"+".concat(r):"-".concat(r)},l=e=>o[e]||{emoji:"\u2753",label:"Unknown",color:"gray",sign:""},d={executePinTransaction:async e=>{let{userId:t,actionType:r,pinChangeValue:s,createdBy:n=null,relatedEntityId:o=null,relatedEntityName:i=null}=e;try{console.log("\ud83d\udd04 Executing PIN transaction:",{userId:t,actionType:r,pinChangeValue:s,createdBy:n,relatedEntityId:o,relatedEntityName:i});const{data:e,error:c}=await a.ND.rpc("execute_pin_transaction",{p_user_id:t,p_action_type:r,p_pin_change_value:s,p_created_by:n,p_related_entity_id:o,p_related_entity_name:i});if(c)throw console.error("\u274c PIN transaction failed:",c),c;if(!e.success)throw console.error("\u274c PIN transaction returned error:",e.error),new Error(e.error||"PIN transaction failed");return console.log("\u2705 PIN transaction successful:",e),e}catch(c){throw console.error("\u274c PIN transaction service error:",c),c}},deductPinForCustomerCreation:async(e,t,r)=>{try{console.log("\ud83d\udd04 Deducting PIN for customer creation:",{promoterId:e,customerId:t,customerName:r});const{data:s,error:n}=await a.ND.rpc("deduct_pin_for_customer_creation",{p_promoter_id:e,p_customer_id:t,p_customer_name:r});if(n)throw n;if(!s.success)throw new Error(s.error||"Customer creation PIN deduction failed");return console.log("\u2705 Customer creation PIN deduction successful:",s),s}catch(s){throw console.error("\u274c Customer creation PIN deduction failed:",s),s}},adminAllocatePins:async(e,t,r)=>{try{console.log("\ud83d\udd04 Admin allocating PINs:",{targetUserId:e,pinAmount:t,adminId:r});const{data:s,error:n}=await a.ND.rpc("admin_allocate_pins",{p_target_user_id:e,p_pin_amount:Math.abs(t),p_admin_id:r});if(n)throw n;if(!s.success)throw new Error(s.error||"Admin PIN allocation failed");return console.log("\u2705 Admin PIN allocation successful:",s),s}catch(s){throw console.error("\u274c Admin PIN allocation failed:",s),s}},adminDeductPins:async(e,t,r)=>{try{console.log("\ud83d\udd04 Admin deducting PINs:",{targetUserId:e,pinAmount:t,adminId:r});const{data:s,error:n}=await a.ND.rpc("admin_deduct_pins",{p_target_user_id:e,p_pin_amount:Math.abs(t),p_admin_id:r});if(n)throw n;if(!s.success)throw new Error(s.error||"Admin PIN deduction failed");return console.log("\u2705 Admin PIN deduction successful:",s),s}catch(s){throw console.error("\u274c Admin PIN deduction failed:",s),s}},getUserPinTransactions:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;try{const{data:r,error:n}=await a.ND.from("pin_transactions").select("\n        id,\n        transaction_id,\n        action_type,\n        pin_change_value,\n        balance_before,\n        balance_after,\n        note,\n        created_at,\n        created_by,\n        related_entity_id,\n        creator:profiles!created_by(name, email)\n      ").eq("user_id",e).order("created_at",{ascending:!1}).limit(t);if(n)throw n;return r.map(e=>{var t;return(0,s.A)((0,s.A)({},e),{},{displayConfig:o[e.action_type]||{emoji:"\u2753",label:"Unknown",color:"gray",sign:""},formattedAmount:c(e.action_type,e.pin_change_value),creatorName:(null===(t=e.creator)||void 0===t?void 0:t.name)||"System"})})}catch(r){throw console.error("\u274c Failed to get user PIN transactions:",r),r}},getAllPinTransactions:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;try{let r=a.ND.from("pin_transactions").select("\n        id,\n        transaction_id,\n        user_id,\n        action_type,\n        pin_change_value,\n        balance_before,\n        balance_after,\n        note,\n        created_at,\n        created_by,\n        related_entity_id,\n        user:profiles!user_id(name, email, role),\n        creator:profiles!created_by(name, email)\n      ").order("created_at",{ascending:!1}).limit(t);e.actionType&&"all"!==e.actionType&&(r=r.eq("action_type",e.actionType)),e.userId&&(r=r.eq("user_id",e.userId)),e.dateFrom&&(r=r.gte("created_at",e.dateFrom)),e.dateTo&&(r=r.lte("created_at",e.dateTo));const{data:n,error:i}=await r;if(i)throw i;return n.map(e=>{var t,r,a,n;return(0,s.A)((0,s.A)({},e),{},{displayConfig:o[e.action_type]||{emoji:"\u2753",label:"Unknown",color:"gray",sign:""},formattedAmount:c(e.action_type,e.pin_change_value),userName:(null===(t=e.user)||void 0===t?void 0:t.name)||"Unknown User",userEmail:(null===(r=e.user)||void 0===r?void 0:r.email)||"Unknown",userRole:(null===(a=e.user)||void 0===a?void 0:a.role)||"unknown",creatorName:(null===(n=e.creator)||void 0===n?void 0:n.name)||"System"})})}catch(r){throw console.error("\u274c Failed to get all PIN transactions:",r),r}},getUserPinBalance:i,getPinTransactionStats:async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;try{let t=a.ND.from("pin_transactions").select("action_type, pin_change_value");e&&(t=t.eq("user_id",e));const{data:r,error:s}=await t;if(s)throw s;return{totalTransactions:r.length,customerCreations:r.filter(e=>e.action_type===n.CUSTOMER_CREATION).length,adminAllocations:r.filter(e=>e.action_type===n.ADMIN_ALLOCATION).length,adminDeductions:r.filter(e=>e.action_type===n.ADMIN_DEDUCTION).length,totalPinsAllocated:r.filter(e=>e.action_type===n.ADMIN_ALLOCATION).reduce((e,t)=>e+Math.abs(t.pin_change_value),0),totalPinsDeducted:r.filter(e=>e.action_type!==n.ADMIN_ALLOCATION).reduce((e,t)=>e+Math.abs(t.pin_change_value),0)}}catch(t){throw console.error("\u274c Failed to get PIN transaction stats:",t),t}},formatPinAmount:c,getActionTypeDisplay:l,validatePinTransaction:(e,t,r)=>{const s=[];return Object.values(n).includes(e)||s.push("Invalid action type"),(!t||t<=0)&&s.push("PIN amount must be greater than 0"),r||s.push("User ID is required"),{isValid:0===s.length,errors:s}},subscribeToPinBalance:(e,t)=>a.ND.channel("pin-balance-changes").on("postgres_changes",{event:"*",schema:"public",table:"pin_transactions",filter:"user_id=eq.".concat(e)},e=>{console.log("\ud83d\udce1 PIN transaction change detected:",e),t(e)}).subscribe(),subscribeToPinTransactions:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r="";t&&(r="user_id=eq.".concat(t));return a.ND.channel("pin-transactions-changes").on("postgres_changes",{event:"*",schema:"public",table:"pin_transactions",filter:r},t=>{console.log("\ud83d\udce1 PIN transactions change detected:",t),e(t)}).subscribe()},PIN_ACTION_TYPES:n,PIN_DISPLAY_CONFIG:o}},5275:(e,t,r)=>{r.d(t,{A:()=>s});const s=(0,r(3797).A)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},8268:(e,t,r)=>{r.d(t,{GJ:()=>p,VC:()=>u,Wx:()=>m});var s=r(5043),a=(r(9213),r(5275));const n=(0,r(3797).A)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);var o=r(3458),i=r(1065),c=r(917),l=(r(987),r(5229)),d=r(579);const u=(0,s.memo)(e=>{let{actionType:t,amount:r,size:s="medium",showIcon:o=!0}=e;const i=(0,l.Lh)(t),c=(0,l.D7)(t,r),u="+"===i.sign?a.A:n;return(0,d.jsxs)("div",{className:"\n      inline-flex items-center space-x-1 rounded-full border font-medium\n      ".concat({small:"text-sm px-2 py-1",medium:"text-base px-3 py-1.5",large:"text-lg px-4 py-2"}[s]," \n      ").concat({green:"bg-green-500/20 text-green-400 border-green-500/30",red:"bg-red-500/20 text-red-400 border-red-500/30",gray:"bg-gray-500/20 text-gray-400 border-gray-500/30"}[i.color],"\n    "),children:[o&&(0,d.jsx)(u,{className:{small:"w-3 h-3",medium:"w-4 h-4",large:"w-5 h-5"}[s]}),(0,d.jsx)("span",{children:c})]})}),p=(0,s.memo)(e=>{let{actionType:t,size:r="medium",showEmoji:s=!0}=e;const a=(0,l.Lh)(t),n=(e=>{switch(e){case l.hO.ADMIN_ALLOCATION:return"green";case l.hO.CUSTOMER_CREATION:case l.hO.ADMIN_DEDUCTION:return"red";default:return"gray"}})(t);return(0,d.jsxs)("span",{className:"\n      inline-flex items-center space-x-1 rounded-full font-medium\n      ".concat({small:"text-xs px-2 py-1",medium:"text-sm px-2.5 py-1",large:"text-base px-3 py-1.5"}[r],"\n      ").concat({green:"bg-green-100 text-green-800",red:"bg-red-100 text-red-800",blue:"bg-blue-100 text-blue-800",gray:"bg-gray-100 text-gray-800"}[n],"\n    "),children:[s&&(0,d.jsx)("span",{children:a.emoji}),(0,d.jsx)("span",{children:a.label})]})}),m=(0,s.memo)(e=>{let{stats:t,loading:r=!1}=e;if(r)return(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[1,2,3,4].map(e=>(0,d.jsxs)("div",{className:"bg-gray-800/50 rounded-lg p-6 animate-pulse",children:[(0,d.jsx)("div",{className:"h-4 bg-gray-700 rounded mb-2"}),(0,d.jsx)("div",{className:"h-8 bg-gray-700 rounded mb-4"}),(0,d.jsx)("div",{className:"h-3 bg-gray-700 rounded w-2/3"})]},e))});const s=[{title:"Total Transactions",value:t.totalTransactions,icon:o.A,color:"purple",gradient:"from-purple-500 to-pink-600"},{title:"Customer Creations",value:t.customerCreations,icon:i.A,color:"red",gradient:"from-red-500 to-pink-600"},{title:"Admin Allocations",value:t.adminAllocations,icon:c.A,color:"green",gradient:"from-green-500 to-emerald-600"},{title:"Total PINs Allocated",value:t.totalPinsAllocated,icon:a.A,color:"blue",gradient:"from-blue-500 to-indigo-600"}];return(0,d.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:s.map((e,t)=>{const r=e.icon;return(0,d.jsx)("div",{className:"bg-gray-800/50 backdrop-blur-sm rounded-lg p-6 border border-gray-700/50 hover:border-gray-600/50 transition-all duration-300",children:(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[(0,d.jsx)("p",{className:"text-gray-300 text-sm font-medium",children:e.title}),(0,d.jsx)("p",{className:"text-3xl font-bold text-white mt-1",children:e.value})]}),(0,d.jsx)("div",{className:"w-14 h-14 bg-gradient-to-r ".concat(e.gradient," rounded-xl flex items-center justify-center shadow-lg"),children:(0,d.jsx)(r,{className:"w-7 h-7 text-white"})})]})},t)})})})},9213:(e,t,r)=>{r.d(t,{A:()=>s});const s=(0,r(3797).A)("Pin",[["line",{x1:"12",x2:"12",y1:"17",y2:"22",key:"1jrz49"}],["path",{d:"M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z",key:"13yl11"}]])},9256:(e,t,r)=>{r.d(t,{A:()=>s});const s=(0,r(3797).A)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])}}]);
//# sourceMappingURL=478.0a63003a.chunk.js.map