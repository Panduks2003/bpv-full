"use strict";(self.webpackChunkbrightplanet_ventures=self.webpackChunkbrightplanet_ventures||[]).push([[692],{2380:(e,r,t)=>{t.d(r,{A:()=>a});const a=(0,t(3797).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},4999:(e,r,t)=>{t.d(r,{A:()=>c});var a=t(2555),s=t(5043),o=(t(6127),t(917)),n=t(5897),l=t(1172),i=t(579);const d=s.memo(e=>{let{onSubmit:r,onCancel:t,loading:d=!1,editingPromoter:c=null,availableParents:m=[],adminUsers:u=[]}=e;const[p,h]=(0,s.useState)({name:"",email:"",hasEmail:!1,password:"password123",confirmPassword:"password123",phone:"",address:"",parentPromoter:""}),[x,g]=(0,s.useState)({}),[b,v]=(0,s.useState)(!1),[w,f]=(0,s.useState)(!1);(0,s.useEffect)(()=>{if(c){const e=c.email||"",r=e&&!e.includes("noemail+")&&!e.includes("@brightplanetventures.local");h({name:c.name||"",email:r?e:"",hasEmail:r,password:"password123",confirmPassword:"password123",phone:c.phone||"",address:c.address||"",parentPromoter:c.parent_promoter_id||""})}},[c]);const y=(0,s.useMemo)(()=>[...(u||[]).map(e=>({id:e.id,label:"\ud83d\udc51 ".concat(e.name," (Admin)"),type:"admin"})),...(m||[]).map(e=>({id:e.id||e._id,label:e.isCurrentUser?"".concat(e.promoter_id||"CURRENT"," - ").concat(e.name," (You)"):"".concat(e.promoter_id||"N/A"," - ").concat(e.name||"Unknown"),type:"promoter"}))],[u,m]),j=(0,s.useCallback)((e,r)=>{const t={};switch(e){case"name":r&&r.trim()?/^[a-zA-Z\s]+$/.test(r.trim())?r.trim().length<2&&(t.name="Name must be at least 2 characters"):t.name="Name must contain only letters and spaces":t.name="Name is required";break;case"email":if(p.hasEmail)if(r&&r.trim()){/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(r.trim())||(t.email="Please enter a valid email address")}else t.email="Email address is required";break;case"password":c||(r?r.length<8?t.password="Password must be at least 8 characters":/(?=.*[a-zA-Z])(?=.*\d)/.test(r)||(t.password="Password must contain both letters and numbers"):t.password="Password is required");break;case"confirmPassword":c||r===p.password||(t.confirmPassword="Passwords do not match");break;case"phone":r?/^[6-9]\d{9}$/.test(r)||(t.phone="Enter a valid 10-digit Indian mobile number (starting with 6-9)"):t.phone="Phone number is required";break;case"parentPromoter":!r&&y.length>1&&(t.parentPromoter="Parent promoter selection is required")}return t},[p.hasEmail,p.password,c,y]),N=(0,s.useCallback)((e,r)=>{h(t=>(0,a.A)((0,a.A)({},t),{},{[e]:r}));const t=j(e,r);g(e=>(0,a.A)((0,a.A)({},e),t)),!t[e]&&x[e]&&g(r=>{const t=(0,a.A)({},r);return delete t[e],t})},[j,x]),P=(0,s.useCallback)(()=>{const e={};return Object.keys(p).forEach(r=>{const t=j(r,p[r]);Object.assign(e,t)}),g(e),0===Object.keys(e).length},[p,j,c]);(0,s.useEffect)(()=>{1!==y.length||p.parentPromoter||h(e=>(0,a.A)((0,a.A)({},e),{},{parentPromoter:y[0].id}))},[y,p.parentPromoter]);const _=(0,s.useCallback)(async e=>{if(e.preventDefault(),!P())return;const t={name:p.name,email:p.hasEmail&&p.email?p.email:null,password:p.password,phone:p.phone,address:p.address||null,parentPromoter:p.parentPromoter||null,useNewSystem:!0};await r(t)},[p,P,r]);return(0,i.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,i.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-700 pb-4 mb-6",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-xl font-semibold text-white",children:c?"Edit Promoter":"Create New Promoter"}),c&&(0,i.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Update promoter information and hierarchy"})]}),(0,i.jsx)("button",{type:"button",onClick:t,className:"text-gray-400 hover:text-white transition-colors",disabled:d,children:(0,i.jsx)(l.A,{className:"w-5 h-5"})})]}),(0,i.jsxs)("form",{onSubmit:_,className:"space-y-5",children:[(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Full Name",(0,i.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,i.jsx)("input",{type:"text",value:p.name,onChange:e=>N("name",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(x.name?"border-red-500":"border-gray-600"),placeholder:"Enter full name (letters and spaces only)"}),x.name&&(0,i.jsx)("p",{className:"text-red-400 text-sm mt-1",children:x.name})]}),(0,i.jsxs)("div",{className:"mb-4",children:[(0,i.jsxs)("div",{className:"flex items-center mb-2",children:[(0,i.jsx)("input",{type:"checkbox",id:"hasEmail",checked:p.hasEmail,onChange:e=>{const r=e.target.checked;h(e=>(0,a.A)((0,a.A)({},e),{},{hasEmail:r,email:r?e.email:""})),r||g(e=>{const r=(0,a.A)({},e);return delete r.email,r})},className:"mr-2 h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-600 rounded bg-gray-700"}),(0,i.jsx)("label",{htmlFor:"hasEmail",className:"text-sm font-medium text-gray-300",children:"Add Email Address"})]}),p.hasEmail&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("input",{type:"email",value:p.email,onChange:e=>N("email",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(x.email?"border-red-500":"border-gray-600"),placeholder:"Enter email address (can be shared with others)"}),x.email&&(0,i.jsx)("p",{className:"text-red-400 text-sm mt-1",children:x.email})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Phone Number",(0,i.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,i.jsx)("input",{type:"tel",value:p.phone,onChange:e=>N("phone",e.target.value.replace(/\D/g,"").slice(0,10)),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(x.phone?"border-red-500":"border-gray-600"),placeholder:"Enter 10-digit mobile number",maxLength:10}),x.phone&&(0,i.jsx)("p",{className:"text-red-400 text-sm mt-1",children:x.phone})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Address",(0,i.jsx)("span",{className:"text-gray-500 text-xs ml-2",children:"(Optional)"})]}),(0,i.jsx)("textarea",{value:p.address,onChange:e=>N("address",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Enter full postal address (optional)",rows:3})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Parent Promoter",(0,i.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,i.jsxs)("select",{value:p.parentPromoter,onChange:e=>N("parentPromoter",e.target.value),disabled:1===y.length||c,className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(x.parentPromoter?"border-red-500":"border-gray-600"," ").concat(1===y.length||c?"opacity-75 cursor-not-allowed":""),children:[0===y.length&&(0,i.jsx)("option",{value:"",children:"Select parent promoter"}),y.map(e=>(0,i.jsx)("option",{value:e.id,children:e.label},e.id))]}),1===y.length&&!c&&(0,i.jsx)("p",{className:"text-gray-400 text-xs mt-1",children:"\ud83d\udca1 Automatically set as your downline promoter"}),x.parentPromoter&&(0,i.jsx)("p",{className:"text-red-400 text-sm mt-1",children:x.parentPromoter})]}),(0,i.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-700",children:[(0,i.jsx)("button",{type:"button",onClick:t,className:"px-6 py-3 text-gray-300 hover:text-white transition-colors",disabled:d,children:"Cancel"}),(0,i.jsx)("button",{type:"submit",disabled:d||Object.keys(x).length>0,className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:d?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.A,{className:"w-4 h-4 animate-spin"}),(0,i.jsx)("span",{children:c?"Updating...":"Creating..."})]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.A,{className:"w-4 h-4"}),(0,i.jsx)("span",{children:c?"Update Promoter":"Create Promoter"})]})})]})]})]})});d.displayName="UnifiedPromoterForm";const c=d},5722:(e,r,t)=>{t.d(r,{A:()=>a});const a=(0,t(3797).A)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])},8112:(e,r,t)=>{t.d(r,{A:()=>a});const a=(0,t(3797).A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},9692:(e,r,t)=>{t.r(r),t.d(r,{default:()=>j});var a=t(5043),s=t(3216),o=t(6621),n=t(1921),l=t(5559),i=t(4999),d=t(1761),c=t(3959),m=t(2631),u=t(6127),p=t(3848),h=(t(3489),t(8112)),x=t(3395),g=t(6950),b=t(4068);const v=(0,t(3797).A)("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var w=t(2380),f=t(5722),y=t(579);const j=function(){const{user:e,logout:r}=(0,o.As)(),{showSuccess:t,showError:j}=(0,n.L5)(),N=(0,s.Zp)();(0,c.r9)();const[P,_]=(0,a.useState)({totalCustomers:0,totalPromoters:0,currentLevel:"Bronze",availablePins:0}),[k,A]=(0,a.useState)(!1),[C,E]=(0,a.useState)(!1),[D,q]=(0,a.useState)(0),[S,U]=(0,a.useState)(!0);(0,c.r9)();const M=(0,a.useCallback)(async()=>{const r=performance.now();try{var t,a,s;p.Ay.info("Loading dashboard data",{userId:null===e||void 0===e?void 0:e.id});const[o,n,l]=await Promise.all([u.ND.from("profiles").select("id, name, customer_id, parent_promoter_id, created_at").eq("role","customer"),u.ND.from("profiles").select("*").eq("id",null===e||void 0===e?void 0:e.id).eq("role","promoter").single(),u.ND.from("profiles").select("*").eq("role","promoter").eq("parent_promoter_id",null===e||void 0===e?void 0:e.id)]);p.Ay.debug("Dashboard data loaded",{userId:null===e||void 0===e?void 0:e.id,customersCount:(null===o||void 0===o||null===(t=o.data)||void 0===t?void 0:t.length)||0,promotersCount:(null===l||void 0===l||null===(a=l.data)||void 0===a?void 0:a.length)||0,hasPromoterData:!(null===n||void 0===n||!n.data)}),o.error&&p.Ay.error("Error loading customers",{error:o.error,userId:null===e||void 0===e?void 0:e.id}),n.error&&p.Ay.error("Error loading promoter data",{error:n.error,userId:null===e||void 0===e?void 0:e.id});const i=(o.data||[]).filter(r=>(null===r||void 0===r?void 0:r.parent_promoter_id)===(null===e||void 0===e?void 0:e.id)).length,d=(null===(s=l.data)||void 0===s?void 0:s.length)||0,c=n.data,m=(null===c||void 0===c?void 0:c.business_category)||"Bronze",h=(null===c||void 0===c?void 0:c.pins)||0;_({totalCustomers:i,totalPromoters:d,currentLevel:m,availablePins:h}),q(h);const x=performance.now();p.Ay.performance("Dashboard data load",x-r),p.Ay.dataLoad("Dashboard",i+d,x-r)}catch(o){p.Ay.error("Error loading dashboard data",{error:o.message,userId:null===e||void 0===e?void 0:e.id}),j("Failed to load dashboard data. Please refresh the page.")}finally{U(!1)}},[null===e||void 0===e?void 0:e.id]);(0,a.useEffect)(()=>{null!==e&&void 0!==e&&e.id&&M()},[e,M]);const F=[{title:"Total Customers",value:P.totalCustomers,description:"Active customers",icon:h.A,color:"from-blue-500 to-blue-600",route:"/promoter/my-customers"},{title:"My Promoters",value:P.totalPromoters,description:"Direct promoters",icon:x.A,color:"from-purple-500 to-purple-600",route:"/promoter/my-promoters"},{title:"Available Pins",value:D,description:S?"Loading...":0===D?"No pins available":"Ready to use",icon:g.A,color:D>0?"from-orange-500 to-orange-600":"from-red-500 to-red-600",route:"/promoter/pin-management"}];return S?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(c.wE,{}),(0,y.jsx)(l.A,{}),(0,y.jsx)(c.dQ,{children:(0,y.jsx)(m.YB,{type:"dashboard"})})]}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(c.wE,{}),(0,y.jsx)(l.A,{}),(0,y.jsxs)(c.dQ,{children:[(0,y.jsx)("div",{children:(0,y.jsxs)("div",{className:"relative",children:[(0,y.jsx)("div",{className:"absolute inset-0 bg-gradient-to-br from-orange-500/5 via-transparent to-yellow-500/5"}),(0,y.jsxs)("div",{className:"relative max-w-6xl mx-auto px-6 pt-40 pb-12",children:[(0,y.jsxs)("div",{className:"text-center mb-6","data-animate":!0,children:[(0,y.jsxs)("div",{className:"flex items-center justify-center gap-4 mb-2",children:[(0,y.jsxs)("h1",{className:"text-3xl md:text-4xl font-bold text-white",children:["Welcome, ",(0,y.jsx)("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-orange-400 to-yellow-400",children:(null===e||void 0===e?void 0:e.name)||"Promoter"})]}),(0,y.jsx)("button",{onClick:M,className:"p-2 bg-orange-500/20 hover:bg-orange-500/30 rounded-lg transition-colors",title:"Refresh dashboard data",children:(0,y.jsx)(b.A,{className:"w-5 h-5 text-orange-400"})})]}),(0,y.jsx)("p",{className:"text-gray-300 mb-6",children:"Manage your network and grow your business"}),(0,y.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-center gap-4",children:[(0,y.jsxs)("button",{onClick:()=>{A(!0)},className:"w-full sm:w-auto inline-flex items-center justify-center px-6 py-3 bg-gradient-to-r from-orange-500 to-yellow-500 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 hover:scale-105",children:[(0,y.jsx)(v,{className:"w-5 h-5 mr-2"}),"Create Promoter"]}),(0,y.jsxs)("button",{onClick:()=>{E(!0)},disabled:D<=0,className:"w-full sm:w-auto inline-flex items-center justify-center px-6 py-3 text-white font-semibold rounded-lg shadow-lg transition-all duration-300 ".concat(D<=0?"bg-gray-500 cursor-not-allowed opacity-50":"bg-gradient-to-r from-green-500 to-green-600 hover:shadow-xl hover:scale-105"),title:D<=0?"No pins available - Request pins from admin":"Create New Customer (".concat(D," pins available)"),children:[(0,y.jsx)(w.A,{className:"w-5 h-5 mr-2"}),"Create Customer",D>0&&(0,y.jsxs)("span",{className:"ml-2 bg-white/20 px-2 py-1 rounded-full text-xs",children:[D," pins"]})]})]})]}),(0,y.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:F.map((e,r)=>{const t=e.icon;return(0,y.jsx)(c.Xg,{className:"group relative overflow-hidden p-6 cursor-pointer hover:scale-[1.02] transition-all duration-300 border border-slate-700/50 hover:border-orange-400/50 bg-gradient-to-br from-slate-800/90 to-slate-900/90",onClick:()=>{return r=e.route,void N(r);var r},children:(0,y.jsxs)("div",{className:"relative flex items-center space-x-4",children:[(0,y.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r ".concat(e.color," rounded-lg flex items-center justify-center shadow-lg"),children:(0,y.jsx)(t,{className:"w-6 h-6 text-white"})}),(0,y.jsxs)("div",{className:"flex-1",children:[(0,y.jsx)("h3",{className:"text-lg font-semibold text-white mb-1",children:e.title}),(0,y.jsx)("p",{className:"text-2xl font-bold text-white",children:e.value}),(0,y.jsx)("p",{className:"text-slate-400 text-sm",children:e.description})]})]})},r)})}),(0,y.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,y.jsx)("div",{className:"group cursor-pointer hover:scale-105 transition-all duration-300 border border-slate-700/50 hover:border-blue-400/50 bg-gradient-to-br from-slate-800/90 to-slate-900/90 p-4 rounded-xl",onClick:()=>N("/promoter/my-customers"),children:(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg flex items-center justify-center mx-auto mb-3",children:(0,y.jsx)(h.A,{className:"w-6 h-6 text-white"})}),(0,y.jsx)("h3",{className:"text-sm font-semibold text-white mb-1",children:"My Customers"}),(0,y.jsx)("p",{className:"text-slate-400 text-xs",children:"Manage customers"})]})}),(0,y.jsx)("div",{className:"group cursor-pointer hover:scale-105 transition-all duration-300 border border-slate-700/50 hover:border-purple-400/50 bg-gradient-to-br from-slate-800/90 to-slate-900/90 p-4 rounded-xl",onClick:()=>N("/promoter/my-promoters"),children:(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-purple-500 to-purple-600 rounded-lg flex items-center justify-center mx-auto mb-3",children:(0,y.jsx)(x.A,{className:"w-6 h-6 text-white"})}),(0,y.jsx)("h3",{className:"text-sm font-semibold text-white mb-1",children:"My Promoters"}),(0,y.jsx)("p",{className:"text-slate-400 text-xs",children:"View network"})]})}),(0,y.jsx)("div",{className:"group cursor-pointer hover:scale-105 transition-all duration-300 border border-slate-700/50 hover:border-orange-400/50 bg-gradient-to-br from-slate-800/90 to-slate-900/90 p-4 rounded-xl",onClick:()=>N("/promoter/pin-management"),children:(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r ".concat(D>0?"from-orange-500 to-orange-600":"from-red-500 to-red-600"," rounded-lg flex items-center justify-center mx-auto mb-3"),children:(0,y.jsx)(g.A,{className:"w-6 h-6 text-white"})}),(0,y.jsx)("h3",{className:"text-sm font-semibold text-white mb-1",children:"Pin Management"}),(0,y.jsx)("p",{className:"text-slate-400 text-xs",children:"Manage pins"})]})}),(0,y.jsx)("div",{className:"group cursor-pointer hover:scale-105 transition-all duration-300 border border-slate-700/50 hover:border-green-400/50 bg-gradient-to-br from-slate-800/90 to-slate-900/90 p-4 rounded-xl",onClick:()=>N("/promoter/withdrawal-request"),children:(0,y.jsxs)("div",{className:"text-center",children:[(0,y.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-green-500 to-green-600 rounded-lg flex items-center justify-center mx-auto mb-3",children:(0,y.jsx)(f.A,{className:"w-6 h-6 text-white"})}),(0,y.jsx)("h3",{className:"text-sm font-semibold text-white mb-1",children:"Withdrawals"}),(0,y.jsx)("p",{className:"text-slate-400 text-xs",children:"Request withdrawal"})]})})]})]})]})}),k&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:(0,y.jsx)(i.A,{isOpen:k,onClose:()=>A(!1),onSubmit:async r=>{try{if(!r.name||""===r.name.trim())throw new Error("Name is required for promoter creation.");if(!r.password||""===r.password.trim())throw new Error("Password is required for promoter creation.");if(!r.phone||""===r.phone.trim())throw new Error("Phone number is required for promoter creation.");const o=Date.now(),n=Math.floor(1e6*Math.random());let l,i,d="promo".concat(o).concat(n,"@brightplanet.com");try{const e=await fetch("http://localhost:5001/api/create-promoter-auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:d,password:r.password,userData:{role:"promoter",name:r.name,phone:r.phone}})});if(!e.ok)throw new Error("Backend service not available");l={user:(await e.json()).user}}catch(s){const e=await u.ND.auth.signUp({email:d,password:r.password,options:{emailRedirectTo:void 0,data:{role:"promoter",name:r.name,phone:r.phone}}});l=e.data,i=e.error}if(i){var a;if(console.error("\u274c Auth creation error:",i),null!==(a=i.message)&&void 0!==a&&a.includes("already registered"))throw new Error("Email ".concat(d," is already registered. Please try again."));throw new Error("Failed to create auth user: "+i.message)}if(!l.user)throw new Error("Failed to create auth user: No user data returned");const{error:c}=await u.ND.rpc("confirm_promoter_email",{p_user_id:l.user.id}),{data:m,error:p}=await u.ND.rpc("create_promoter_with_auth_id",{p_name:r.name.trim(),p_user_id:l.user.id,p_auth_email:d,p_password:r.password.trim(),p_phone:r.phone.trim(),p_email:r.email&&r.email.trim()?r.email.trim():null,p_address:r.address&&r.address.trim()?r.address.trim():null,p_parent_promoter_id:e.id,p_role_level:"Affiliate",p_status:"Active"});if(p)throw p;if(!m||!m.success)throw new Error((null===m||void 0===m?void 0:m.error)||"Failed to create promoter profile");t("Promoter created successfully and is ready to use.\n\nPromoter ID: ".concat(m.promoter_id,"\nName: ").concat(m.name,"\nLogin: Use Promoter ID + Password")),await M(),A(!1)}catch(o){j("Failed to create promoter: ".concat(o.message))}},promoters:[{id:e.id,name:e.name||"Current Promoter",promoter_id:e.promoter_id||"CURRENT",isCurrentUser:!0}],adminUsers:[]})}),(0,y.jsx)(d.A,{isOpen:C,onClose:()=>E(!1),onSubmit:async r=>{try{if(D<1)throw new Error("Insufficient pins to create customer. You need 1 pin but only have ".concat(D," pins available. Please request more pins from admin."));const{data:a,error:s}=await u.ND.rpc("create_customer_final",{p_name:r.name,p_mobile:r.mobile,p_state:r.state,p_city:r.city,p_pincode:r.pincode,p_address:r.address,p_customer_id:r.cardNo,p_password:r.password,p_parent_promoter_id:null===e||void 0===e?void 0:e.id,p_email:r.email||null});if(s||null===a||void 0===a||!a.success)throw new Error((null===a||void 0===a?void 0:a.error)||(null===s||void 0===s?void 0:s.message)||"Failed to create customer");t("Customer created successfully and is ready to use.\n\nCustomer ID: ".concat(r.cardNo,"\nName: ").concat(r.name,"\nLogin: Use Customer ID + Password")),q(e=>e-1),await M(),setTimeout(async()=>{await M()},1e3),E(!1)}catch(a){j("Failed to create customer: ".concat(a.message))}},promoters:[{id:null===e||void 0===e?void 0:e.id,name:(null===e||void 0===e?void 0:e.name)||"Current Promoter",promoter_id:(null===e||void 0===e?void 0:e.promoter_id)||"CURRENT",role:"promoter"}],isEditing:!1,initialData:{parentPromoter:null===e||void 0===e?void 0:e.id}})]})]})}}}]);
//# sourceMappingURL=692.b3f55734.chunk.js.map