"use strict";(self.webpackChunkbrightplanet_ventures=self.webpackChunkbrightplanet_ventures||[]).push([[581],{1754:(e,s,t)=>{t.d(s,{YB:()=>p,bT:()=>c,cU:()=>d,xk:()=>m});t(5043);var a=t(579);const r="rgba(247, 147, 30, 0.1)",n="rgba(255, 255, 255, 0.05)",i="\n  @keyframes bp-skeleton-shimmer {\n    0% {\n      background-position: -200px 0;\n    }\n    100% {\n      background-position: calc(200px + 100%) 0;\n    }\n  }\n  \n  .bp-skeleton-shimmer {\n    background: linear-gradient(\n      90deg,\n      ".concat(n," 25%,\n      ").concat(r," 50%,\n      ").concat(n," 75%\n    );\n    background-size: 200px 100%;\n    animation: bp-skeleton-shimmer 1.5s infinite linear;\n  }\n");if("undefined"!==typeof document&&!document.getElementById("bp-skeleton-styles")){const e=document.createElement("style");e.id="bp-skeleton-styles",e.textContent=i,document.head.appendChild(e)}const l=e=>{let{width:s="100%",height:t="1rem",className:r="",rounded:i="rounded-lg",animate:l=!0}=e;return(0,a.jsx)("div",{className:"".concat(i," border border-white/10 ").concat(l?"bp-skeleton-shimmer":""," ").concat(r),style:{width:s,height:t,background:l?void 0:n}})},o=e=>{let{className:s=""}=e;return(0,a.jsxs)("div",{className:"bg-white/5 backdrop-blur-sm border border-slate-200/10 rounded-xl p-4 h-full ".concat(s),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,a.jsx)(l,{width:"3rem",height:"3rem",rounded:"rounded-xl"}),(0,a.jsx)(l,{width:"3rem",height:"2rem"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l,{width:"70%",height:"1rem"}),(0,a.jsx)(l,{width:"90%",height:"0.75rem"})]})]})},d=e=>{let{rows:s=5,columns:t=4,className:r=""}=e;return(0,a.jsxs)("div",{className:"bg-white/5 backdrop-blur-sm border border-slate-200/10 rounded-xl overflow-hidden ".concat(r),children:[(0,a.jsx)("div",{className:"bg-white/5 p-4 border-b border-white/10",children:(0,a.jsx)("div",{className:"grid gap-4",style:{gridTemplateColumns:"repeat(".concat(t,", 1fr)")},children:Array.from({length:t}).map((e,s)=>(0,a.jsx)(l,{width:"80%",height:"1rem"},s))})}),(0,a.jsx)("div",{className:"divide-y divide-white/10",children:Array.from({length:s}).map((e,s)=>(0,a.jsx)("div",{className:"p-4",children:(0,a.jsx)("div",{className:"grid gap-4",style:{gridTemplateColumns:"repeat(".concat(t,", 1fr)")},children:Array.from({length:t}).map((e,s)=>(0,a.jsx)(l,{width:0===s?"90%":"70%",height:"1rem"},s))})},s))})]})},c=e=>{let{count:s=2,className:t=""}=e;return(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 ".concat(t),children:Array.from({length:s}).map((e,s)=>(0,a.jsx)(o,{},s))})},m=e=>{let{count:s=4,className:t=""}=e;return(0,a.jsx)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 ".concat(t),children:Array.from({length:s}).map((e,s)=>(0,a.jsx)("div",{className:"bg-white/5 backdrop-blur-sm border border-slate-200/10 rounded-xl p-5 h-full",children:(0,a.jsxs)("div",{className:"text-center space-y-4",children:[(0,a.jsx)(l,{width:"3.5rem",height:"3.5rem",rounded:"rounded-xl",className:"mx-auto"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l,{width:"70%",height:"1rem",className:"mx-auto"}),(0,a.jsx)(l,{width:"90%",height:"0.75rem",className:"mx-auto"})]})]})},s))})},h=e=>{let{className:s=""}=e;return(0,a.jsxs)("div",{className:"text-center mb-6 ".concat(s),children:[(0,a.jsx)(l,{width:"4rem",height:"4rem",rounded:"rounded-2xl",className:"mx-auto mb-4"}),(0,a.jsx)(l,{width:"15rem",height:"2rem",className:"mx-auto mb-2"}),(0,a.jsx)(l,{width:"20rem",height:"1rem",className:"mx-auto"})]})},x=e=>{let{className:s=""}=e;return(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6 ".concat(s),children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(l,{width:"100%",height:"2.5rem",rounded:"rounded-lg"})}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(l,{width:"8rem",height:"2.5rem",rounded:"rounded-lg"}),(0,a.jsx)(l,{width:"6rem",height:"2.5rem",rounded:"rounded-lg"})]})]})},u=e=>{let{className:s=""}=e;return(0,a.jsxs)("div",{className:"bg-white/5 backdrop-blur-sm border border-slate-200/10 rounded-xl p-6 ".concat(s),children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(l,{width:"8rem",height:"1rem"}),(0,a.jsx)(l,{width:"6rem",height:"0.75rem"})]}),(0,a.jsx)(l,{width:"4rem",height:"1.5rem",rounded:"rounded-full"})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(l,{width:"4rem",height:"0.75rem"}),(0,a.jsx)(l,{width:"6rem",height:"0.75rem"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)(l,{width:"5rem",height:"0.75rem"}),(0,a.jsx)(l,{width:"7rem",height:"0.75rem"})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-2 mt-4 pt-4 border-t border-white/10",children:[(0,a.jsx)(l,{width:"4rem",height:"2rem",rounded:"rounded-lg"}),(0,a.jsx)(l,{width:"4rem",height:"2rem",rounded:"rounded-lg"})]})]})},p=e=>{let{type:s="dashboard"}=e;switch(s){case"dashboard":return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-6",children:[(0,a.jsx)(h,{}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(l,{width:"10rem",height:"1.5rem",className:"mb-4"}),(0,a.jsx)(c,{})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(l,{width:"12rem",height:"1.5rem",className:"mb-4"}),(0,a.jsx)(m,{})]})]})]})});case"table":return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-6",children:[(0,a.jsx)(h,{}),(0,a.jsx)(x,{}),(0,a.jsx)(d,{rows:8,columns:5})]})});case"cards":return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-6",children:[(0,a.jsx)(h,{}),(0,a.jsx)(x,{}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.from({length:6}).map((e,s)=>(0,a.jsx)(u,{},s))})]})});default:return(0,a.jsx)(p,{type:"dashboard"})}}},2380:(e,s,t)=>{t.d(s,{A:()=>a});const a=(0,t(3797).A)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},2699:(e,s,t)=>{t.d(s,{A:()=>a});const a=(0,t(3797).A)("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",key:"3xmgem"}]])},4999:(e,s,t)=>{t.d(s,{A:()=>c});var a=t(2555),r=t(5043),n=(t(6127),t(917)),i=t(5897),l=t(1172),o=t(579);const d=r.memo(e=>{let{onSubmit:s,onCancel:t,loading:d=!1,editingPromoter:c=null,availableParents:m=[],adminUsers:h=[]}=e;const[x,u]=(0,r.useState)({name:"",email:"",hasEmail:!1,password:"password123",confirmPassword:"password123",phone:"",address:"",parentPromoter:""}),[p,g]=(0,r.useState)({}),[j,b]=(0,r.useState)(!1),[f,w]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(c){const e=c.email||"",s=e&&!e.includes("noemail+")&&!e.includes("@brightplanetventures.local");u({name:c.name||"",email:s?e:"",hasEmail:s,password:"password123",confirmPassword:"password123",phone:c.phone||"",address:c.address||"",parentPromoter:c.parent_promoter_id||""})}},[c]);const v=(0,r.useMemo)(()=>[...(h||[]).map(e=>({id:e.id,label:"\ud83d\udc51 ".concat(e.name," (Admin)"),type:"admin"})),...(m||[]).map(e=>({id:e.id||e._id,label:e.isCurrentUser?"".concat(e.promoter_id||"CURRENT"," - ").concat(e.name," (You)"):"".concat(e.promoter_id||"N/A"," - ").concat(e.name||"Unknown"),type:"promoter"}))],[h,m]),y=(0,r.useCallback)((e,s)=>{const t={};switch(e){case"name":s&&s.trim()?/^[a-zA-Z\s]+$/.test(s.trim())?s.trim().length<2&&(t.name="Name must be at least 2 characters"):t.name="Name must contain only letters and spaces":t.name="Name is required";break;case"email":if(x.hasEmail)if(s&&s.trim()){/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(s.trim())||(t.email="Please enter a valid email address")}else t.email="Email address is required";break;case"password":c||(s?s.length<8?t.password="Password must be at least 8 characters":/(?=.*[a-zA-Z])(?=.*\d)/.test(s)||(t.password="Password must contain both letters and numbers"):t.password="Password is required");break;case"confirmPassword":c||s===x.password||(t.confirmPassword="Passwords do not match");break;case"phone":s?/^[6-9]\d{9}$/.test(s)||(t.phone="Enter a valid 10-digit Indian mobile number (starting with 6-9)"):t.phone="Phone number is required";break;case"parentPromoter":!s&&v.length>1&&(t.parentPromoter="Parent promoter selection is required")}return t},[x.hasEmail,x.password,c,v]),N=(0,r.useCallback)((e,s)=>{u(t=>(0,a.A)((0,a.A)({},t),{},{[e]:s}));const t=y(e,s);g(e=>(0,a.A)((0,a.A)({},e),t)),!t[e]&&p[e]&&g(s=>{const t=(0,a.A)({},s);return delete t[e],t})},[y,p]),A=(0,r.useCallback)(()=>{const e={};return Object.keys(x).forEach(s=>{const t=y(s,x[s]);Object.assign(e,t)}),g(e),0===Object.keys(e).length},[x,y,c]);(0,r.useEffect)(()=>{1!==v.length||x.parentPromoter||u(e=>(0,a.A)((0,a.A)({},e),{},{parentPromoter:v[0].id}))},[v,x.parentPromoter]);const k=(0,r.useCallback)(async e=>{if(e.preventDefault(),!A())return;const t={name:x.name,email:x.hasEmail&&x.email?x.email:null,password:x.password,phone:x.phone,address:x.address||null,parentPromoter:x.parentPromoter||null,useNewSystem:!0};await s(t)},[x,A,s]);return(0,o.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,o.jsxs)("div",{className:"flex items-center justify-between border-b border-gray-700 pb-4 mb-6",children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-xl font-semibold text-white",children:c?"Edit Promoter":"Create New Promoter"}),c&&(0,o.jsx)("p",{className:"text-gray-400 text-sm mt-1",children:"Update promoter information and hierarchy"})]}),(0,o.jsx)("button",{type:"button",onClick:t,className:"text-gray-400 hover:text-white transition-colors",disabled:d,children:(0,o.jsx)(l.A,{className:"w-5 h-5"})})]}),(0,o.jsxs)("form",{onSubmit:k,className:"space-y-5",children:[(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Full Name",(0,o.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,o.jsx)("input",{type:"text",value:x.name,onChange:e=>N("name",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(p.name?"border-red-500":"border-gray-600"),placeholder:"Enter full name (letters and spaces only)"}),p.name&&(0,o.jsx)("p",{className:"text-red-400 text-sm mt-1",children:p.name})]}),(0,o.jsxs)("div",{className:"mb-4",children:[(0,o.jsxs)("div",{className:"flex items-center mb-2",children:[(0,o.jsx)("input",{type:"checkbox",id:"hasEmail",checked:x.hasEmail,onChange:e=>{const s=e.target.checked;u(e=>(0,a.A)((0,a.A)({},e),{},{hasEmail:s,email:s?e.email:""})),s||g(e=>{const s=(0,a.A)({},e);return delete s.email,s})},className:"mr-2 h-4 w-4 text-orange-600 focus:ring-orange-500 border-gray-600 rounded bg-gray-700"}),(0,o.jsx)("label",{htmlFor:"hasEmail",className:"text-sm font-medium text-gray-300",children:"Add Email Address"})]}),x.hasEmail&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("input",{type:"email",value:x.email,onChange:e=>N("email",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(p.email?"border-red-500":"border-gray-600"),placeholder:"Enter email address (can be shared with others)"}),p.email&&(0,o.jsx)("p",{className:"text-red-400 text-sm mt-1",children:p.email})]})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Phone Number",(0,o.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,o.jsx)("input",{type:"tel",value:x.phone,onChange:e=>N("phone",e.target.value.replace(/\D/g,"").slice(0,10)),className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(p.phone?"border-red-500":"border-gray-600"),placeholder:"Enter 10-digit mobile number",maxLength:10}),p.phone&&(0,o.jsx)("p",{className:"text-red-400 text-sm mt-1",children:p.phone})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Address",(0,o.jsx)("span",{className:"text-gray-500 text-xs ml-2",children:"(Optional)"})]}),(0,o.jsx)("textarea",{value:x.address,onChange:e=>N("address",e.target.value),className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500",placeholder:"Enter full postal address (optional)",rows:3})]}),(0,o.jsxs)("div",{children:[(0,o.jsxs)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:["Parent Promoter",(0,o.jsx)("span",{className:"text-orange-400 ml-1",children:"*"})]}),(0,o.jsxs)("select",{value:x.parentPromoter,onChange:e=>N("parentPromoter",e.target.value),disabled:1===v.length||c,className:"w-full px-4 py-3 bg-gray-700 border rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500 ".concat(p.parentPromoter?"border-red-500":"border-gray-600"," ").concat(1===v.length||c?"opacity-75 cursor-not-allowed":""),children:[0===v.length&&(0,o.jsx)("option",{value:"",children:"Select parent promoter"}),v.map(e=>(0,o.jsx)("option",{value:e.id,children:e.label},e.id))]}),1===v.length&&!c&&(0,o.jsx)("p",{className:"text-gray-400 text-xs mt-1",children:"\ud83d\udca1 Automatically set as your downline promoter"}),p.parentPromoter&&(0,o.jsx)("p",{className:"text-red-400 text-sm mt-1",children:p.parentPromoter})]}),(0,o.jsxs)("div",{className:"flex justify-end space-x-4 pt-6 border-t border-gray-700",children:[(0,o.jsx)("button",{type:"button",onClick:t,className:"px-6 py-3 text-gray-300 hover:text-white transition-colors",disabled:d,children:"Cancel"}),(0,o.jsx)("button",{type:"submit",disabled:d||Object.keys(p).length>0,className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:d?(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(i.A,{className:"w-4 h-4 animate-spin"}),(0,o.jsx)("span",{children:c?"Updating...":"Creating..."})]}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.A,{className:"w-4 h-4"}),(0,o.jsx)("span",{children:c?"Update Promoter":"Create Promoter"})]})})]})]})]})});d.displayName="UnifiedPromoterForm";const c=d},5680:(e,s,t)=>{t.d(s,{A:()=>a});const a=(0,t(3797).A)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]])},6339:(e,s,t)=>{t.d(s,{A:()=>a});const a=(0,t(3797).A)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]])},6787:(e,s,t)=>{t.d(s,{A:()=>a});const a=(0,t(3797).A)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},7581:(e,s,t)=>{t.r(s),t.d(s,{default:()=>N});var a=t(2555),r=t(5043),n=t(6621),i=t(1460),l=t(4999),o=t(2129),d=t(3959),c=t(6127),m=t(5897),h=t(9589),x=t(6787),u=t(5680),p=t(2380),g=t(2699),j=t(6339),b=t(8112),f=t(1172),w=t(1754),v=t(8279),y=t(579);const N=function(){const{user:e}=(0,n.As)(),{showSuccess:s,showError:t,showWarning:N,handleApiError:A}=(0,v.dj)();(0,d.r9)();const[k,P]=(0,r.useState)([]),[_,C]=(0,r.useState)([]),[E,S]=(0,r.useState)(""),[D,F]=(0,r.useState)(""),[U,q]=(0,r.useState)(!1),[M,L]=(0,r.useState)(!1),[I,T]=(0,r.useState)(null),[O,z]=(0,r.useState)(null),[R,H]=(0,r.useState)(!0),[B,V]=(0,r.useState)(!1),[Z,$]=(0,r.useState)(!1),[W,X]=(0,r.useState)(null),[Y,J]=(0,r.useState)(!1),[Q,G]=(0,r.useState)(null),[K,ee]=(0,r.useState)({amount:"",notes:""}),[se]=(0,r.useState)([]);(0,r.useEffect)(()=>{te()},[]),(0,r.useEffect)(()=>{let e=k||[];E&&(e=e.filter(e=>{const s=((null===e||void 0===e?void 0:e.name)||"").toLowerCase(),t=((null===e||void 0===e?void 0:e.email)||"").toLowerCase(),a=((null===e||void 0===e?void 0:e.promoter_id)||"").toLowerCase(),r=((null===e||void 0===e?void 0:e.phone)||"").toLowerCase(),n=(E||"").toLowerCase();return s.includes(n)||t.includes(n)||a.includes(n)||r.includes(n)})),D&&(e=e.filter(e=>((null===e||void 0===e?void 0:e.status)||"active").toLowerCase()===D.toLowerCase())),C(e)},[k,E,D]);const te=async()=>{try{H(!0);const{data:e,error:s}=await c.ND.from("profiles").select("*").eq("role","promoter").order("created_at",{ascending:!1});if(s)throw s;P(e||[])}catch(e){P([])}finally{H(!1)}},ae=()=>{q(!1),T(null)},re=()=>{L(!1),z(null)},ne=()=>{J(!1),G(null),ee({amount:"",notes:""})};return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(d.wE,{}),(0,y.jsx)(i.A,{}),(0,y.jsxs)(d.dQ,{children:[(0,y.jsx)("div",{className:"min-h-screen pt-40 px-8 pb-8",children:(0,y.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,y.jsxs)("div",{className:"flex justify-between items-center mb-8","data-animate":!0,children:[(0,y.jsxs)("div",{children:[(0,y.jsx)("h1",{className:"text-4xl font-bold text-white mb-2",children:"Promoter Management"}),(0,y.jsx)("p",{className:"text-gray-400",children:"Manage promoters, hierarchies, and performance"})]}),(0,y.jsxs)(d.Rq,{onClick:()=>{T(null),q(!0)},className:"flex items-center space-x-2",children:[(0,y.jsx)(p.A,{className:"w-5 h-5"}),(0,y.jsx)("span",{children:"Create Promoter"})]})]}),(0,y.jsx)(d.Xg,{className:"mb-6","data-animate":!0,children:(0,y.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4 items-start sm:items-center justify-between",children:[(0,y.jsx)("div",{className:"flex-1",children:(0,y.jsx)("input",{type:"text",placeholder:"Search by name, email, ID, or phone...",value:E,onChange:e=>S(e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500"})}),(0,y.jsx)("div",{className:"flex gap-4",children:(0,y.jsxs)("select",{value:D,onChange:e=>F(e.target.value),className:"px-4 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500",children:[(0,y.jsx)("option",{value:"",children:"All Status"}),(0,y.jsx)("option",{value:"active",children:"Active"}),(0,y.jsx)("option",{value:"inactive",children:"Inactive"})]})})]})}),(0,y.jsx)(d.Xg,{className:"overflow-hidden","data-animate":!0,children:R?(0,y.jsx)(w.cU,{rows:8,columns:6}):(0,y.jsx)("div",{className:"overflow-x-auto",children:(0,y.jsxs)("table",{className:"w-full",children:[(0,y.jsx)("thead",{className:"bg-gray-700",children:(0,y.jsxs)("tr",{children:[(0,y.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Promoter Details"}),(0,y.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Contact Details"}),(0,y.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Parent Promoter"}),(0,y.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Status"}),(0,y.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Pins"}),(0,y.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,y.jsx)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:0===_.length?(0,y.jsx)("tr",{children:(0,y.jsx)("td",{colSpan:"6",className:"px-6 py-12 text-center text-gray-400",children:"No promoters found"})}):_.map(e=>{const t=null===e||void 0===e?void 0:e.id,a=(null===e||void 0===e?void 0:e.name)||"Unknown",r=(null===e||void 0===e?void 0:e.email)||"N/A",n=(null===e||void 0===e?void 0:e.phone)||"N/A",i=(null===e||void 0===e?void 0:e.promoter_id)||"N/A",l=((null===e||void 0===e?void 0:e.status)||"Active").toLowerCase();return(0,y.jsxs)("tr",{className:"hover:bg-gray-700",children:[(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-orange-400 to-yellow-500 rounded-full flex items-center justify-center mr-3",children:(0,y.jsx)(b.A,{className:"w-4 h-4 text-white"})}),(0,y.jsxs)("div",{className:"flex flex-col",children:[(0,y.jsx)("span",{className:"text-white font-medium",children:a}),(0,y.jsx)("span",{className:"text-xs text-gray-400",children:i})]})]})}),(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,y.jsxs)("div",{className:"space-y-1",children:[(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)(h.A,{className:"w-3 h-3 mr-2 text-gray-400"}),"N/A"===r?"No email":r]}),(0,y.jsxs)("div",{className:"flex items-center",children:[(0,y.jsx)(u.A,{className:"w-3 h-3 mr-2 text-gray-400"}),n||"No phone"]})]})}),(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(()=>{const s=(e=>{const s=null===e||void 0===e?void 0:e.parent_promoter_id;if(!s)return null;const t=(se||[]).find(e=>e.id===s);if(t)return{name:t.name||"Admin",id:"Admin",isAdmin:!0};const a=(k||[]).find(e=>(null===e||void 0===e?void 0:e.id)===s);return a?{name:a.name||"Unknown",id:a.promoter_id||"N/A",isAdmin:!1}:{name:"Unknown Parent",id:"N/A",isAdmin:!1}})(e);return s?(0,y.jsx)("div",{className:"flex items-center",children:s.isAdmin?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("span",{className:"text-yellow-400 mr-2",children:"\ud83d\udc51"}),(0,y.jsx)("span",{className:"text-white font-medium",children:s.name})]}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(b.A,{className:"w-4 h-4 mr-2 text-blue-400"}),(0,y.jsxs)("div",{className:"flex flex-col",children:[(0,y.jsx)("span",{className:"text-white font-medium",children:s.name}),(0,y.jsx)("span",{className:"text-xs text-gray-400",children:s.id})]})]})}):"-"})()}),(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,y.jsx)("button",{onClick:()=>(async e=>{try{var t;const a=null===(t=e.status)||void 0===t?void 0:t.toLowerCase(),r="active"===a?"Inactive":"Active",{error:n}=await c.ND.from("profiles").update({status:r}).eq("id",e.id);if(n)throw n;await te(),s("Promoter status updated from ".concat(a," to ").concat(r))}catch(a){A(a,"Failed to update promoter status")}})(e),className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium transition-colors hover:opacity-80 cursor-pointer ".concat("active"===l?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"),title:"Click to toggle status",children:"active"===l?"\u2705 Active":"\u274c Inactive"})}),(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-300",children:(0,y.jsxs)("span",{className:"text-sm font-medium text-white",children:["\ud83d\udccc ",(null===e||void 0===e?void 0:e.pins)||0]})}),(0,y.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,y.jsxs)("div",{className:"flex space-x-2",children:[(0,y.jsx)("button",{onClick:()=>(e=>{T(e),q(!0)})(e),className:"text-orange-400 hover:text-orange-300 transition-colors",children:(0,y.jsx)(x.A,{className:"w-4 h-4"})}),(0,y.jsx)("button",{onClick:()=>(e=>{z(e),L(!0)})(e),className:"text-red-400 hover:text-red-300 transition-colors",children:(0,y.jsx)(j.A,{className:"w-4 h-4"})})]})})]},t)})})]})})})]})}),U&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,y.jsx)(l.A,{onSubmit:async e=>{var t;V(!0);const a=await c.ND.auth.getSession(),r=null===(t=a.data.session)||void 0===t?void 0:t.user;try{if(I){const{data:t,error:a}=await c.ND.rpc("update_promoter_profile",{p_promoter_id:I.promoter_id,p_name:e.name,p_email:e.email,p_phone:e.phone,p_address:e.address,p_status:e.status,p_parent_promoter_id:I.parent_promoter_id});if(a)throw a;if(!t.success)throw new Error(t.error||"Failed to update promoter");s("Promoter updated successfully")}else{if(!e.name||""===e.name.trim())throw new Error("Name is required for promoter creation.");if(!e.password||""===e.password.trim())throw new Error("Password is required for promoter creation.");if(!e.phone||""===e.phone.trim())throw new Error("Phone number is required for promoter creation.");const s=Date.now(),t=Math.floor(1e6*Math.random()),m="promo".concat(s).concat(t,"@brightplanet.com");let h,x;try{const s=await fetch("http://localhost:5001/api/create-promoter-auth",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:m,password:e.password,userData:{role:"promoter",name:e.name,phone:e.phone}})});if(!s.ok)throw new Error("Backend service not available");h={user:(await s.json()).user}}catch(l){const s=await c.ND.auth.signUp({email:m,password:e.password,options:{emailRedirectTo:void 0,data:{role:"promoter",name:e.name,phone:e.phone}}});h=s.data,x=s.error,r&&a.data.session&&await c.ND.auth.setSession(a.data.session)}if(x){var n;if(null!==(n=x.message)&&void 0!==n&&n.includes("already registered"))throw new Error("Email ".concat(m," is already registered. Please try again."));throw new Error("Failed to create auth user: "+x.message)}if(!h.user)throw new Error("Failed to create auth user: No user data returned");const{error:u}=await c.ND.rpc("confirm_promoter_email",{p_user_id:h.user.id}),{data:p,error:g}=await c.ND.rpc("create_promoter_with_auth_id",{p_name:e.name.trim(),p_user_id:h.user.id,p_auth_email:m,p_password:e.password.trim(),p_phone:e.phone.trim(),p_email:e.email&&e.email.trim()?e.email.trim():null,p_address:e.address&&e.address.trim()?e.address.trim():null,p_parent_promoter_id:e.parentPromoter||null,p_role_level:"Affiliate",p_status:"Active"});if(g){var i;try{try{await c.ND.auth.admin.deleteUser(h.user.id)}catch(o){}}catch(d){}if(null!==(i=g.message)&&void 0!==i&&i.includes("UPDATE requires a WHERE clause"))throw new Error("Database configuration error. Please run the database fix script first.");throw new Error(g.message||"Failed to create promoter profile")}if(!p||!p.success){try{try{await c.ND.auth.admin.deleteUser(h.user.id)}catch(o){}}catch(d){}throw new Error((null===p||void 0===p?void 0:p.error)||"Failed to create promoter profile")}X({title:"Success!",message:"Promoter created successfully and is ready to use.",details:"Promoter ID: ".concat(p.promoter_id,"\nName: ").concat(p.name,"\nLogin: Use Promoter ID + Password")}),$(!0),r&&a.data.session}await te(),ae()}catch(m){A(m,"Failed to save promoter")}finally{V(!1)}},onCancel:ae,loading:B,editingPromoter:I,availableParents:(()=>{const e=k||[],s=[...e];if(!I)return s;const t=(e,s)=>{const a=[];return s.filter(s=>(null===s||void 0===s?void 0:s.parent_promoter_id)===e).forEach(e=>{const r=null===e||void 0===e?void 0:e.id;r&&(a.push(r),a.push(...t(r,s)))}),a},a=null===I||void 0===I?void 0:I.id;if(!a)return s;const r=[a,...t(a,e)];return s.filter(e=>{const s=null===e||void 0===e?void 0:e.id;return s&&((null===e||void 0===e?void 0:e.isAdmin)||!r.includes(s))})})(),adminUsers:se})}),M&&O&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,y.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-md mx-4",children:[(0,y.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,y.jsx)("h3",{className:"text-lg font-semibold text-white",children:"Confirm Delete"}),(0,y.jsx)("button",{onClick:re,className:"text-gray-400 hover:text-white transition-colors",children:(0,y.jsx)(f.A,{className:"w-5 h-5"})})]}),(0,y.jsxs)("div",{className:"mb-6",children:[(0,y.jsxs)("p",{className:"text-gray-300",children:["Are you sure you want to delete promoter ",(0,y.jsx)("strong",{children:O.name}),"?"]}),(0,y.jsx)("p",{className:"text-red-400 text-sm mt-2",children:"This action cannot be undone."})]}),(0,y.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,y.jsx)("button",{onClick:re,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",children:"Cancel"}),(0,y.jsx)("button",{onClick:async()=>{if(O)try{const{error:e}=await c.ND.from("profiles").delete().eq("id",O.id);if(e)throw e;await te(),re()}catch(e){A(e,"Failed to delete promoter")}},className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors",children:"Delete"})]})]})}),Y&&Q&&(0,y.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50",children:(0,y.jsxs)("div",{className:"bg-gray-800 rounded-xl p-6 w-full max-w-md border border-gray-700",children:[(0,y.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,y.jsx)("h3",{className:"text-xl font-semibold text-white",children:"Allocate Pins"}),(0,y.jsx)("button",{onClick:ne,className:"text-gray-400 hover:text-white transition-colors",children:(0,y.jsx)(f.A,{className:"w-5 h-5"})})]}),(0,y.jsxs)("div",{className:"space-y-4",children:[(0,y.jsxs)("div",{children:[(0,y.jsxs)("p",{className:"text-gray-300 mb-2",children:["Promoter: ",(0,y.jsx)("span",{className:"font-semibold text-white",children:Q.name})]}),(0,y.jsxs)("p",{className:"text-gray-300 mb-4",children:["Current Pins: ",(0,y.jsx)("span",{className:"font-bold ".concat(((null===Q||void 0===Q?void 0:Q.pins)||0)>0?"text-green-400":"text-red-400"),children:(null===Q||void 0===Q?void 0:Q.pins)||0})]})]}),(0,y.jsxs)("div",{children:[(0,y.jsxs)("label",{className:"block text-gray-300 text-sm mb-2",children:["Number of Pins to Allocate ",(0,y.jsx)("span",{className:"text-red-400",children:"*"})]}),(0,y.jsx)("input",{type:"number",min:"1",max:"1000",value:K.amount,onChange:e=>ee(s=>(0,a.A)((0,a.A)({},s),{},{amount:e.target.value})),placeholder:"Enter number of pins",className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20"})]}),(0,y.jsxs)("div",{children:[(0,y.jsx)("label",{className:"block text-gray-300 text-sm mb-2",children:"Notes (Optional)"}),(0,y.jsx)("textarea",{value:K.notes,onChange:e=>ee(s=>(0,a.A)((0,a.A)({},s),{},{notes:e.target.value})),placeholder:"Add notes about this allocation...",rows:"3",className:"w-full px-4 py-3 bg-gray-700 border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:border-orange-500 focus:ring-2 focus:ring-orange-500/20"})]}),(0,y.jsx)("div",{className:"bg-blue-500/10 border border-blue-500/30 rounded-lg p-4",children:(0,y.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,y.jsx)(g.A,{className:"w-5 h-5 text-blue-400 mt-0.5"}),(0,y.jsxs)("div",{children:[(0,y.jsx)("p",{className:"text-blue-300 text-sm font-medium",children:"Pin Allocation Info"}),(0,y.jsx)("p",{className:"text-gray-300 text-sm mt-1",children:"Each customer creation requires 1 pin. Allocate pins to enable promoters to create customers."})]})]})})]}),(0,y.jsxs)("div",{className:"flex justify-end space-x-3 mt-6",children:[(0,y.jsx)("button",{onClick:ne,className:"px-4 py-2 text-gray-300 hover:text-white transition-colors",disabled:B,children:"Cancel"}),(0,y.jsx)("button",{onClick:async()=>{if(!Q||!K.amount)return void N("Please enter a valid pin amount");const e=parseInt(K.amount);if(e<=0)N("Pin amount must be greater than 0");else try{V(!0);const{data:t,error:a}=await c.ND.rpc("add_promoter_pins",{p_promoter_id:Q.id,p_pins_to_add:e});if(a)throw new Error(a.message);await c.ND.from("pin_usage_log").insert({promoter_id:Q.id,pins_used:-e,action_type:"admin_allocation",notes:K.notes||"Admin allocated ".concat(e," pins")}),s("".concat(e," pins allocated to ").concat(Q.name," successfully")),await te(),ne()}catch(t){A(t,"Failed to allocate pins")}finally{V(!1)}},disabled:B||!K.amount,className:"px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:B?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(m.A,{className:"w-4 h-4 animate-spin"}),(0,y.jsx)("span",{children:"Allocating..."})]}):(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(g.A,{className:"w-4 h-4"}),(0,y.jsx)("span",{children:"Allocate Pins"})]})})]})]})}),(0,y.jsx)(o.A,{isOpen:Z,onClose:()=>{$(!1),X(null)},title:null===W||void 0===W?void 0:W.title,message:null===W||void 0===W?void 0:W.message,details:null===W||void 0===W?void 0:W.details})]})]})}},8112:(e,s,t)=>{t.d(s,{A:()=>a});const a=(0,t(3797).A)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])}}]);
//# sourceMappingURL=581.2bb797b6.chunk.js.map